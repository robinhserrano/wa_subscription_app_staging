import{s as Z}from"./index-CWCLOLff.js";import{d as Ce,s as ee,a as m,b as le,c as G,e as D,f as $e,g as Fe,h as qe,i as Ie,j as Ue,k as te,l as Ve}from"./primeicons-J1JNrsQH.js";import{s as xe}from"./index-ABDUfVYr.js";import{p as Ae,q as Pe,d as n,s as Te,x as ie,y as $,z as Ne,A as se,B as je,o as r,e as v,a,g as p,t as u,f,b as s,w as d,u as i,F as A,h as P,c as _,l as F,C as ae,D as re}from"./app-BqipoHyu.js";const Re={class:"card"},Le={class:"m-4 my-4"},Oe={key:0},Ee=a("i",{class:"pi pi-calendar"},null,-1),Be={key:1},Me=a("i",{class:"pi pi-map-marker"},null,-1),Ge=a("i",{class:"pi pi-user"},null,-1),Je=a("i",{class:"pi pi-map-marker mt-2"},null,-1),Ke=a("p",{class:"mt-6"}," Order Lines:",-1),Qe={key:0},ze=a("p",{class:"mt-6 mb-2"}," Other Address:",-1),He=a("i",{class:"pi pi-building-columns"},null,-1),We=a("p",{class:"mt-6 mb-2"}," Other Address:",-1),Xe=a("i",{class:"pi pi-building"},null,-1),Ye=a("p",{class:"mb-2 text-xl font-bold"},"States",-1),Ze=["for"],el=a("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),ll=["for"],tl=a("p",{class:"mt-4 mb-2 text-xl font-bold"},"Require Delivery Type",-1),il=["for"],sl={class:"font-bold"},al={class:"flex justify-between"},rl=a("i",{class:"pi pi-search"},null,-1),nl={style:{display:"flex","align-items":"center"}},ol=["onClick"],dl=["onClick"],ul={class:"flex items-center"},cl={key:0},ml={key:1,class:"pi pi-truck ml-2"},vl=["src"],yl={style:{display:"flex","align-items":"center"}},pl={key:0,class:"flex align-items-center"},fl={key:0},_l={key:1},hl={key:1},bl={class:"flex align-items-center"},gl=["src"],Cl={__name:"ConfirmDeliveryRequirementDataTable",props:{currentUser:Object,deliverSubIds:Object,filterSubs:Object,stateIds:Object,users:Object,filters:Object},setup(h){const ne=Ae(),b=Pe(),T=n(1),q=n([]),J=n([]),w=n(),N=n(!0),oe=n(),I=n([]),K=n([]),Q=n(),de=n([]),z=n(),U=n([]),j=n(100),V=n(),R=n(),H=n(),g=n([]),y=n([]),x=n([]),L=n(0),O=n(!1),E=n(!1),W=n(),ue=n([{id:null,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),ce=n([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),me=n([{name:"Confirmed",value:"Confirm"},{name:"Denied",value:"Deny"},{name:"Pending",value:"Pending"}]);let S=h;Te(()=>{N.value=!1,L.value=S.filterSubs.total,oe.value=S.salesQuotations,x.value=S.stateIds});const X=()=>{w.value={start_date:{operator:ae.AND,constraints:[{value:null,matchMode:re.DATE_IS}]},due_date:{operator:ae.AND,constraints:[{value:null,matchMode:re.DATE_IS}]}}};X(),ie([()=>q.value,()=>g.value,()=>I.value,()=>U.value,()=>K.value,()=>w.value],()=>{k()}),ie(R,async l=>{if(l)try{const t=await $.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:l}});J.value=t.data.map(c=>({name:c,value:c})),J.value.push({name:"- Unselect -",value:null})}catch(t){console.error("Error fetching dropdown options:",t)}});const ve=()=>{X()},ye=async()=>{var l=y.value.map(c=>c.id);console.log(l);const t=JSON.stringify({deliverSubIds:l,required_delivery_updated_by_id:S.currentUser.id});await $.post("/api/bulkConfirmDeliverSubs",t,{headers:{"Content-Type":"application/json"}}),b.add({severity:"success",summary:`Successfully confirmed ${l.length} filter subs`,detail:"",life:3e3}),k(),y.value=[]},pe=async()=>{var l=y.value.map(c=>c.id);console.log(l);const t=JSON.stringify({deliverSubIds:l,required_delivery_updated_by_id:S.currentUser.id});await $.post("/api/bulkDenyDeliverSubs",t,{headers:{"Content-Type":"application/json"}}),b.add({severity:"success",summary:`Successfully denied ${l.length} filter subs`,detail:"",life:3e3}),k(),y.value=[]},k=async()=>{try{console.log("fetch data page"),console.log(T.value);var l=route().current("confirmDeliveryFilterSubscription")?"/confirmDeliveryFilterSubscription":"/confirmDeliveryRequirement";const t=Ne.get(l,{page:T.value,search:W.value,dates:q.value,stateId:g.value,activitySummary:I.value,categories:K.value,perPage:j.value,filters:JSON.stringify(w.value),requireDeliveryTypes:U.value},{preserveState:!0,replace:!1,onSuccess:c=>{console.log(c),console.log(c.props.filterSubs.total),L.value=c.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{N.value=!1}},fe=Ce(k,300),_e=l=>{O.value=!0,R.value=l.sales_order_no,H.value=l.order_line,z.value=l.customer_name,Q.value=l.address,de.value=l.contact_address,V.value=l},he=l=>{j.value=l.rows,T.value=l.page+1,k()},be=l=>{W.value=l.target.value,fe()},ge=async l=>{try{console.log(l.required_delivery.value);const t=await $.put(`/api/updateRequiredDeliveryInDeliverSubs/${l.id}`,{required_delivery:l.required_delivery.value,required_delivery_updated_by_id:S.currentUser.id});l.required_delivery.value=="Confirm"?b.add({severity:"success",summary:`Successfully confirmed #${l.sales_order_no} for delivery`,detail:"",life:3e3}):l.required_delivery.value=="Deny"?b.add({severity:"info",summary:`Successfully denied #${l.sales_order_no}`,detail:"",life:3e3}):b.add({severity:"info",summary:`Updated #${l.sales_order_no}'s require delivery value`,detail:"",life:3e3})}catch(t){console.error("Failed to update required_delivery:",t),b.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}},Se=(l,t,c)=>{ne.require({message:`Do you want to unlink #${t} from #${l}?`,header:"Unlink Sales Order",icon:"pi pi-info-circle",rejectLabel:"Cancel",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Unlink",severity:"danger"},accept:async()=>{await $.delete(`/api/deliverSub/${c}`),k(),b.add({severity:"info",summary:"Unlinked Successfully",detail:`Unlinked #${t} from #${l}`,life:3e3})},reject:()=>{}})},B=l=>l?new Date(l).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,ke=l=>{if(!l||l.length===0)return"";const t=new Date(l[0]),c=l[1]?new Date(l[1]):t;return`${t.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${c.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},De=l=>l.map(t=>{var c;return(c=x.value[t-1])==null?void 0:c.code}).join(", "),we=async l=>{y.value=l};return(l,t)=>{const c=se("Toast"),M=se("font-awesome-icon"),C=je("tooltip");return r(),v("div",Re,[a("div",null,[a("div",Le,[q.value.length?(r(),v("div",Oe,[Ee,p(" "+u(ke(q.value)),1)])):f("",!0),g.value.length?(r(),v("div",Be,[Me,p(" "+u(De(g.value)),1)])):f("",!0)])]),s(c),s(i(le),{visible:O.value,"onUpdate:visible":t[0]||(t[0]=e=>O.value=e),header:R.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:d(()=>[a("p",null,[Ge,p(" "+u(z.value),1)]),a("p",null,[Je,p(" "+u(Q.value),1)]),Ke,s(i(ee),{value:H.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:d(()=>[s(i(m),{field:"product",header:"Product",style:{"min-width":"10rem"}}),s(i(m),{field:"description",header:"Description",style:{"min-width":"10rem"}}),s(i(m),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),a("div",null,[V.value.contact_address[0].parent?(r(),v("p",Qe,[ze,He,p(" "+u(V.value.contact_address[0].parent.complete_address),1)])):f("",!0)]),a("div",null,[(r(!0),v(A,null,P(V.value.contact_address[0].children,(e,o)=>(r(),v("p",{key:o},[We,Xe,p(" "+u(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),s(i(le),{visible:E.value,"onUpdate:visible":t[4]||(t[4]=e=>E.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:d(()=>[Ye,(r(!0),v(A,null,P(x.value,e=>(r(),v("div",{key:e.id,class:"flex items-center mb-2"},[s(i(G),{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=o=>g.value=o),inputId:e.state_id,name:"stateIds",value:e.state_id},null,8,["modelValue","inputId","value"]),a("label",{for:e.id,class:"ml-2"},u(e.name),9,Ze)]))),128)),el,(r(!0),v(A,null,P(ue.value,e=>(r(),v("div",{key:e.id,class:"flex items-center mb-2"},[s(i(G),{modelValue:I.value,"onUpdate:modelValue":t[2]||(t[2]=o=>I.value=o),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),a("label",{for:e.id,class:"ml-2"},u(e.name),9,ll)]))),128)),tl,(r(!0),v(A,null,P(me.value,e=>(r(),v("div",{key:e.id,class:"flex items-center mb-2"},[s(i(G),{modelValue:U.value,"onUpdate:modelValue":t[3]||(t[3]=o=>U.value=o),inputId:e.name,name:"category",value:e.value},null,8,["modelValue","inputId","value"]),a("label",{for:e.id,class:"ml-2"},u(e.name),9,il)]))),128))]),_:1},8,["visible"]),y.value.length?(r(),_(i(D),{key:0,class:"ml-4",outlined:""},{default:d(()=>[a("p",sl,u(y.value.length),1),p("selected "),y.value.length<h.filterSubs.total?(r(),_(i(D),{key:0,label:`Select all ${h.deliverSubIds.length}`,onClick:t[5]||(t[5]=e=>we(h.deliverSubIds)),icon:"pi pi-arrow-right",class:"ml-4",severity:"info"},null,8,["label"])):f("",!0)]),_:1})):f("",!0),y.value.length?(r(),_(i(D),{key:1,label:`Confirm All (${y.value.length})`,onClick:ye,icon:"pi pi-verified",class:"ml-4"},null,8,["label"])):f("",!0),y.value.length?(r(),_(i(D),{key:2,label:`Deny All (${y.value.length})`,onClick:pe,icon:"pi pi-times-circle",class:"ml-4"},null,8,["label"])):f("",!0),s(i($e),{rows:j.value,totalRecords:L.value,rowsPerPageOptions:[10,25,50,100],onPage:he},{start:d(e=>[p(u(h.filterSubs.from)+"-"+u(h.filterSubs.to)+" / "+u(h.filterSubs.total),1)]),_:1},8,["rows","totalRecords"]),s(i(ee),{selection:y.value,"onUpdate:selection":t[8]||(t[8]=e=>y.value=e),value:h.filterSubs.data,lazy:"",loading:N.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu",filters:w.value,"onUpdate:filters":t[9]||(t[9]=e=>w.value=e)},{header:d(()=>[a("div",al,[s(i(D),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:t[6]||(t[6]=e=>ve())}),s(i(Fe),null,{default:d(()=>[s(i(qe),null,{default:d(()=>[rl]),_:1}),a("div",null,[s(i(D),{onClick:t[7]||(t[7]=e=>E.value=!0),label:"Filter",class:"mr-4"}),s(i(Ie),{placeholder:"Keyword Search",onInput:be})])]),_:1})])]),empty:d(()=>[p(" No filterSubs found. ")]),loading:d(()=>[p(" Loading filterSubs data. Please wait. ")]),default:d(()=>[s(i(m),{selectionMode:"multiple",headerStyle:"width: 3rem"}),s(i(m),{field:"root_sales_order.sales_order_no",header:"Root Sales Order #",style:{"min-width":"10rem"}},{body:d(({data:e})=>[a("div",nl,[a("span",null,u(e.root_sales_order.sales_order_no),1),s(i(xe)),a("div",{onClick:o=>Se(e.root_sales_order.sales_order_no,e.sales_order_no,e.id),style:{cursor:"pointer","margin-left":"8px"}},[s(M,{icon:["fas","link-slash"],style:{color:"#800000"}})],8,ol)])]),_:1}),s(i(m),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:d(({data:e})=>[a("span",{onClick:o=>_e(e),class:"cursor-pointer hover:underline"},u(e.sales_order_no),9,dl),a("div",ul,[l.route().current("confirmDeliveryFilterSubscription")?(r(),v("div",cl,[e.hasCallOutService?F((r(),_(M,{key:0,icon:["fas","toolbox"]},null,512)),[[C,"Filter Sub (Filter + Call Out Service)"]]):F((r(),_(M,{key:1,icon:["fas","faucet"]},null,512)),[[C,"Filter Sub (Filter Only)"]])])):f("",!0),e.delivered_or_delivery_booked&&e.delivered_or_delivery_booked.value!==null?F((r(),v("i",ml,null,512)),[[C,"Delivery Booked"]]):f("",!0),e.odoo_created_by_id?F((r(),_(i(Z),{key:2,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:d(()=>[a("img",{src:e.odoo_created_by.profile_photo_url,alt:"User Initials"},null,8,vl)]),_:2},1024)),[[C,`Last updated by:
${e.odoo_created_by.name}`]]):f("",!0)])]),_:1}),l.route().current("confirmDeliveryRequirement")||l.route().current("confirmDeliveryFilterSubscription")?(r(),_(i(m),{key:0,field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:d(({data:e})=>[a("div",yl,[s(i(Ue),{modelValue:e.required_delivery,"onUpdate:modelValue":o=>e.required_delivery=o,options:ce.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:o=>ge(e)},{value:d(o=>{var Y;return[o.value?(r(),v("div",pl,[e.required_delivery&&e.required_delivery.value!==null?(r(),v("div",fl,u(((Y=e.required_delivery)==null?void 0:Y.name)||e.required_delivery),1)):(r(),v("div",_l,u(o.placeholder),1))])):(r(),v("span",hl,u(o.placeholder),1))]}),option:d(o=>[a("div",bl,[a("div",null,u(o.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),e.required_delivery_updated_by_id?F((r(),_(i(Z),{key:0,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:d(()=>[a("img",{src:e.required_delivery_updated_by.profile_photo_url,alt:"User Initials"},null,8,gl)]),_:2},1024)),[[C,`Last updated by:
${e.required_delivery_updated_by.name}`]]):f("",!0)])]),_:1})):f("",!0),s(i(m),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),s(i(m),{field:"address",header:"Address",style:{"min-width":"10rem"}}),s(i(m),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),s(i(m),{field:"start_date",header:"Start Date",style:{"min-width":"10rem"},filterField:"start_date",dataType:"date"},{body:d(({data:e})=>[p(u(B(e.start_date)),1)]),filter:d(({filterModel:e})=>[s(i(te),{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,dateFormat:"dd/mm/yy",placeholder:"dd/mm/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(i(m),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"},filterField:"due_date",dataType:"date"},{body:d(({data:e})=>[p(u(B(e.due_date)),1)]),filter:d(({filterModel:e})=>[s(i(te),{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,dateFormat:"dd/mm/yy",placeholder:"dd/mm/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(i(m),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),s(i(m),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:d(({data:e})=>[p(u(B(e.invoice_date)),1)]),_:1}),s(i(m),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:d(({data:e})=>{var o;return[p(u((o=x.value[e.state_id-1])==null?void 0:o.name),1)]}),_:1}),s(i(m),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),s(i(m),{field:"email",header:"Email",style:{"min-width":"10rem"}}),s(i(m),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:d(({data:e})=>[e.payment_status==="paid"?(r(),_(i(Ve),{key:0,severity:"success",value:"Paid"})):f("",!0)]),_:1})]),_:1},8,["selection","value","loading","filters"])])}}};export{Cl as _};
