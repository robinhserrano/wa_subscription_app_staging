import{_ as we}from"./AppLayout-BsYwGUg1.js";import{d as ke,s as Y,a as m,b as Z,c as G,e as Ce,f as K,g as xe,h as De,i as Ie,j as $e,k as Fe,l as Ve}from"./primeicons-BXeiMZlh.js";import{q as Oe,d as r,s as Ue,x as Pe,y as ee,z as U,A as te,B as Ae,o as i,e as v,a as o,g as p,t as d,f as k,b as l,w as c,u as s,F as E,h as B,c as H,Q as je}from"./app-L6f9-XHl.js";import{u as z,w as Ne}from"./xlsx-YQvpTstd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ee={class:"card"},Be={class:"m-4 my-4"},Le={key:0},Re=o("i",{class:"pi pi-calendar"},null,-1),Te={key:1},Me=o("i",{class:"pi pi-map-marker"},null,-1),Qe=o("i",{class:"pi pi-user"},null,-1),qe=o("i",{class:"pi pi-map-marker mt-2"},null,-1),Ge=o("p",{class:"mt-6"}," Order Lines:",-1),Ke={key:0},ze=o("p",{class:"mt-6 mb-2"}," Other Address:",-1),He=o("i",{class:"pi pi-building-columns"},null,-1),We=o("p",{class:"mt-6 mb-2"}," Other Address:",-1),Je=o("i",{class:"pi pi-building"},null,-1),Xe=o("p",{class:"mb-2 text-xl font-bold"},"States",-1),Ye=["for"],Ze=o("p",{class:"mt-4 mb-2 text-xl font-bold"},"Category",-1),et=["for"],tt=o("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),at=["for"],st=o("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),lt={class:"flex justify-between"},ot=o("i",{class:"pi pi-search"},null,-1),nt=["onClick"],rt={key:0,class:"pi pi-truck ml-2"},dt={key:0,class:"flex align-items-center"},it={key:0},ct={key:1},ut={key:1},mt={class:"flex align-items-center"},vt={__name:"SubsToEnterDataTable",props:{currentUser:Object,filterSubs:Object,filterSubIds:Object,stateIds:Object},setup(_){Oe();let S=_;const C=r([]),x=r(!0),w=r(1),D=r(0),L=r(),R=r(!1),T=r(!1),ae=r(),M=r([]),Q=Ue(),I=r([]),P=r(),W=r(),J=r(),X=r(),se=r([]),le=r([{id:1,name:"Subscription"}]),oe=r([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]);r([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]);const y=r([]),A=r(),b=r([]),$=r([]),F=r([]),j=r(100);Pe(()=>{x.value=!1,D.value=S.filterSubs.total,ae.value=S.salesQuotations,I.value=S.stateIds});const ne=t=>{j.value=t.rows,w.value=t.page+1,console.log("page change"),console.log(w.value),V()},re=t=>{L.value=t.target.value,console.log(t.target.value),de()},V=async()=>{try{console.log("fetch data page"),console.log(w.value);const t=ee.get("/dashboard",{page:w.value,search:L.value,dates:y.value,stateId:b.value,activitySummary:$.value,categories:F.value,perPage:j.value},{preserveState:!0,replace:!1,onSuccess:a=>{console.log(a),console.log(a.props.filterSubs.total),D.value=a.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{x.value=!1}},de=ke(async()=>{try{console.log("fetch data page"),console.log(w.value);const t=await ee.get("/dashboard",{page:w.value,search:L.value,dates:y.value,stateId:b.value,activitySummary:$.value,categories:F.value,perPage:j.value},{preserveState:!0,replace:!1,onSuccess:a=>{console.log(a),console.log(a.props.filterSubs.total),D.value=a.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{x.value=!1}},300),q=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,ie=t=>{if(!t||t.length===0)return"";const a=new Date(t[0]),u=t[1]?new Date(t[1]):a;return`${a.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${u.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},ce=t=>t.map(a=>{var u;return(u=I.value[a-1])==null?void 0:u.code}).join(", "),ue=()=>{initFilters()},me=t=>{R.value=!0,P.value=t.sales_order_no,W.value=t.order_line,J.value=t.customer_name,X.value=t.address,se.value=t.contact_address,A.value=t},ve=t=>{P.value=t.sales_order_no},pe=async t=>{var a;try{if((a=t.created_on_odoo)!=null&&a.value){console.log(t);const u=await te.post("/api/createDeliverSub",{filter_sub_id:t.id,created_on_odoo:t.created_on_odoo.value,odoo_created_by_id:S.currentUser.id,due_date:t.due_date.value});Q.add({severity:"success",summary:`Moved #${t.sales_order_no} to Confirm Delivery Requirement`,detail:"",life:3e3})}}catch(u){console.error("Failed to update created_on_odoo:",u),u.response.data.error?Q.add({severity:"error",summary:u.response.data.error,detail:"",life:3e3}):Q.add({severity:"error",summary:"Failed to update created on odoo",detail:"",life:3e3})}};U(P,async t=>{if(t)try{const a=await te.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:t}});M.value=a.data.map(u=>({name:u,value:u})),M.value.push({name:"- Unselect -",value:null})}catch(a){console.error("Error fetching dropdown options:",a)}}),U(b,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),V())}),U($,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),V())}),U(y,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),V())}),U(F,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),V())});const _e=t=>t,he=t=>{const a={"Invoice Number":"invoice_number","Sales Order":"sales_order_no","Customer Name":"customer_name","Invoice Date":"invoice_date","Payment Status":"payment_status",Address:"address",State:"state_id","Activity Summary":"activity_summary","Phone Number":"phone",Email:"email","Due Date":"due_date","Created on Odoo":"created_on_odoo"},e=C.value.map(h=>{var f;h.state_id=(f=t[h.state_id-1])==null?void 0:f.name;let g={};for(const[ge,Se]of Object.entries(a))g[ge]=h[Se];return g}).reduce((h,g)=>{const f=g.State;return h[f]||(h[f]=[]),h[f].push(g),h},{}),n=z.book_new();for(const[h,g]of Object.entries(e)){const f=z.json_to_sheet(g);z.book_append_sheet(n,f,h)}const N=Ne(n,{bookType:"xlsx",type:"binary"}),ye=new Blob([fe(N)],{type:"application/octet-stream"}),be=URL.createObjectURL(ye),O=document.createElement("a");O.href=be,O.setAttribute("download","subs_to_enter.xlsx"),document.body.appendChild(O),O.click(),document.body.removeChild(O)};function fe(t){const a=new ArrayBuffer(t.length),u=new Uint8Array(a);for(let e=0;e<t.length;e++)u[e]=t.charCodeAt(e)&255;return a}return(t,a)=>{const u=Ae("Toast");return i(),v("div",Ee,[o("div",null,[o("div",Be,[y.value.length?(i(),v("div",Le,[Re,p(" "+d(ie(y.value)),1)])):k("",!0),b.value.length?(i(),v("div",Te,[Me,p(" "+d(ce(b.value)),1)])):k("",!0)])]),l(u),l(s(Z),{visible:R.value,"onUpdate:visible":a[0]||(a[0]=e=>R.value=e),header:P.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[o("p",null,[Qe,p(" "+d(J.value),1)]),o("p",null,[qe,p(" "+d(X.value),1)]),Ge,l(s(Y),{value:W.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:c(()=>[l(s(m),{field:"product",header:"Product",style:{"min-width":"10rem"}}),l(s(m),{field:"description",header:"Description",style:{"min-width":"10rem"}}),l(s(m),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),o("div",null,[A.value.contact_address[0].parent?(i(),v("p",Ke,[ze,He,p(" "+d(A.value.contact_address[0].parent.complete_address),1)])):k("",!0)]),o("div",null,[(i(!0),v(E,null,B(A.value.contact_address[0].children,(e,n)=>(i(),v("p",{key:n},[We,Je,p(" "+d(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),l(s(Z),{visible:T.value,"onUpdate:visible":a[5]||(a[5]=e=>T.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[Xe,(i(!0),v(E,null,B(I.value,e=>(i(),v("div",{key:e.id,class:"flex items-center mb-2"},[l(s(G),{modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=n=>b.value=n),inputId:e.state_id,name:"stateIds",value:e.state_id},null,8,["modelValue","inputId","value"]),o("label",{for:e.id,class:"ml-2"},d(e.name),9,Ye)]))),128)),Ze,(i(!0),v(E,null,B(le.value,e=>(i(),v("div",{key:e.id,class:"flex items-center mb-2"},[l(s(G),{modelValue:F.value,"onUpdate:modelValue":a[2]||(a[2]=n=>F.value=n),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),o("label",{for:e.id,class:"ml-2"},d(e.name),9,et)]))),128)),tt,(i(!0),v(E,null,B(oe.value,e=>(i(),v("div",{key:e.id,class:"flex items-center mb-2"},[l(s(G),{modelValue:$.value,"onUpdate:modelValue":a[3]||(a[3]=n=>$.value=n),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),o("label",{for:e.id,class:"ml-2"},d(e.name),9,at)]))),128)),st,l(s(Ce),{modelValue:y.value,"onUpdate:modelValue":a[4]||(a[4]=e=>y.value=e),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),C.value.length?(i(),H(s(K),{key:0,label:"Export as Excel",onClick:a[6]||(a[6]=e=>he(I.value)),class:"ml-4"})):k("",!0),l(s(xe),{rows:j.value,totalRecords:D.value,rowsPerPageOptions:[10,25,50,100,D.value].sort((e,n)=>e-n),onPage:ne},{start:c(e=>[p(d(_.filterSubs.from)+"-"+d(_.filterSubs.to)+" / "+d(_.filterSubs.total),1)]),_:1},8,["rows","totalRecords","rowsPerPageOptions"]),l(s(Y),{selection:C.value,"onUpdate:selection":a[9]||(a[9]=e=>C.value=e),value:_e(_.filterSubs.data),lazy:"",loading:x.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:c(()=>[o("div",lt,[l(s(K),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:a[7]||(a[7]=e=>ue())}),l(s(De),null,{default:c(()=>[l(s(Ie),null,{default:c(()=>[ot]),_:1}),o("div",null,[l(s(K),{onClick:a[8]||(a[8]=e=>T.value=!0),label:"Filter",class:"mr-4"}),l(s($e),{placeholder:"Keyword Search",onInput:re})])]),_:1})])]),empty:c(()=>[p(" No filterSubs found. ")]),loading:c(()=>[p(" Loading filterSubs data. Please wait. ")]),default:c(()=>[l(s(m),{selectionMode:"multiple",headerStyle:"width: 3rem"}),l(s(m),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:c(({data:e})=>[o("span",{onClick:n=>me(e),class:"cursor-pointer hover:underline"},d(e.sales_order_no),9,nt),e.delivered_or_delivery_booked&&e.delivered_or_delivery_booked.value!==null?(i(),v("i",rt)):k("",!0)]),_:1}),l(s(m),{field:"",header:"Created on Odoo",style:{"min-width":"10rem"}},{body:c(({data:e})=>[l(s(Fe),{modelValue:e.created_on_odoo,"onUpdate:modelValue":n=>e.created_on_odoo=n,options:M.value,filter:"",optionLabel:"name",placeholder:"Select Sales Order #",class:"w-full md:w-14rem",onClick:n=>ve(e),onChange:n=>pe(e)},{value:c(n=>{var N;return[n.value?(i(),v("div",dt,[e.created_on_odoo&&e.created_on_odoo.value!==null?(i(),v("div",it,d(((N=e.created_on_odoo)==null?void 0:N.name)||e.created_on_odoo),1)):(i(),v("div",ct,d(n.placeholder),1))])):(i(),v("span",ut,d(n.placeholder),1))]}),option:c(n=>[o("div",mt,[o("div",null,d(n.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onClick","onChange"])]),_:1}),l(s(m),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),l(s(m),{field:"address",header:"Address",style:{"min-width":"10rem"}}),l(s(m),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),l(s(m),{field:"start_date",header:"Start Date",style:{"min-width":"10rem"}},{body:c(({data:e})=>[p(d(q(e.start_date)),1)]),_:1}),l(s(m),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:c(({data:e})=>[p(d(q(e.due_date)),1)]),_:1}),l(s(m),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),l(s(m),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:c(({data:e})=>[p(d(q(e.invoice_date)),1)]),_:1}),l(s(m),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:c(({data:e})=>{var n;return[p(d((n=I.value[e.state_id-1])==null?void 0:n.name),1)]}),_:1}),l(s(m),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),l(s(m),{field:"email",header:"Email",style:{"min-width":"10rem"}}),l(s(m),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:c(({data:e})=>[e.payment_status==="paid"?(i(),H(s(Ve),{key:0,severity:"success",value:"Paid"})):k("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},pt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},gt={__name:"Dashboard",props:{filterSubs:Object,stateIds:Object,activitySummaries:Object,filterSubIds:Object},setup(_){const S=je();return(C,x)=>(i(),H(we,{title:"Dashboard"},{default:c(()=>[o("div",pt,[l(vt,{filterSubs:_.filterSubs,stateIds:_.stateIds,activitySummaries:_.activitySummaries,filterSubIds:_.filterSubIds,currentUser:s(S).props.auth.user},null,8,["filterSubs","stateIds","activitySummaries","filterSubIds","currentUser"])])]),_:1}))}};export{gt as default};
