import{_ as Ce}from"./AppLayout-DDN4xZiC.js";import{d as $e,s as ee,a as u,b as te,c as le,e as C,f as Ie,g as Fe,h as Ue,i as qe,j as xe,k as Ve}from"./primeicons-BqKdTtcn.js";import{s as se}from"./index-ES5vMCfc.js";import{p as je,q as Ae,d as n,s as Oe,x as Ne,y as ae,z as $,A as q,B as ie,C as Pe,o,e as v,a as i,g as p,t as c,f as _,b as a,w as r,u as s,F as Q,h as G,c as h,l as x,D as oe,E as re,Q as Ee}from"./app-8REE4K1P.js";import{s as Te}from"./index-B7b3F6ZG.js";import{s as ne}from"./index-4WpceyfX.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Le={class:"card"},Re={class:"m-4 my-4"},Be={key:0},Me=i("i",{class:"pi pi-calendar"},null,-1),Je={key:1},Qe=i("i",{class:"pi pi-map-marker"},null,-1),Ge=i("i",{class:"pi pi-user"},null,-1),Ke=i("i",{class:"pi pi-map-marker mt-2"},null,-1),ze=i("p",{class:"mt-6"}," Order Lines:",-1),He={key:0},We=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),Xe=i("i",{class:"pi pi-building-columns"},null,-1),Ye=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),Ze=i("i",{class:"pi pi-building"},null,-1),et=i("p",{class:"mb-2 text-xl font-bold"},"States",-1),tt=["for"],lt=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),st=["for"],at={class:"font-bold"},it={class:"flex justify-between"},ot=i("i",{class:"pi pi-search"},null,-1),rt={style:{display:"flex","align-items":"center"}},nt=["onClick"],dt=["onClick"],ct={class:"flex items-center"},ut={key:2,class:"pi pi-truck ml-2"},mt=["src"],vt={style:{display:"flex","align-items":"center"}},ft={key:0,class:"flex align-items-center"},yt={key:0},pt={key:1},_t={key:1},ht={class:"flex align-items-center"},bt=["src"],gt={__name:"ConfirmDeliveryFilterSubscriptionDataTable",props:{currentUser:Object,deliverSubIds:Object,filterSubs:Object,stateIds:Object,users:Object,filters:Object},setup(f){const P=je(),K=(e,l,m)=>{P.require({message:`Do you want to unlink #${l} from #${e}?`,header:"Unlink Sales Order",icon:"pi pi-info-circle",rejectLabel:"Cancel",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Unlink",severity:"danger"},accept:async()=>{await q.delete(`/api/deliverSub/${m}`),b(),S.add({severity:"info",summary:"Unlinked Successfully",detail:`Unlinked #${l} from #${e}`,life:3e3})},reject:()=>{}})};Ae();let g=f;const y=n([]),V=n(!0),k=n(1),j=n(0),E=n(),T=n(!1),L=n(!1),de=n(),z=n([]),S=Oe(),A=n([]),R=n(),H=n(),W=n(),X=n(),ce=n([]);n([{id:1,name:"Subscription"}]);const ue=n([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),me=n([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),I=n([]),O=n(),w=n([]),F=n([]),B=n([]),N=n(100),D=n();Ne(()=>{V.value=!1,j.value=g.filterSubs.total,de.value=g.salesQuotations,A.value=g.stateIds});const Y=()=>{D.value={start_date:{operator:oe.AND,constraints:[{value:null,matchMode:re.DATE_IS}]},due_date:{operator:oe.AND,constraints:[{value:null,matchMode:re.DATE_IS}]}}};Y();const ve=e=>{N.value=e.rows,k.value=e.page+1,console.log("page change"),console.log(k.value),b()},fe=e=>{E.value=e.target.value,console.log(e.target.value),ye()},b=async()=>{try{console.log("fetch data page"),console.log(k.value);const e=ae.get("/confirmDeliveryFilterSubscription",{page:k.value,search:E.value,dates:I.value,stateId:w.value,activitySummary:F.value,categories:B.value,perPage:N.value,filters:JSON.stringify(D.value)},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),j.value=l.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{V.value=!1}},ye=$e(async()=>{try{console.log("fetch data page"),console.log(k.value);const e=await ae.get("/confirmDeliveryFilterSubscription",{page:k.value,search:E.value,dates:I.value,stateId:w.value,activitySummary:F.value,categories:B.value,perPage:N.value,filters:JSON.stringify(D.value)},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),j.value=l.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{V.value=!1}},300),M=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,pe=e=>{if(!e||e.length===0)return"";const l=new Date(e[0]),m=e[1]?new Date(e[1]):l;return`${l.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${m.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},_e=e=>e.map(l=>{var m;return(m=A.value[l-1])==null?void 0:m.code}).join(", "),he=()=>{Y()},be=e=>{T.value=!0,R.value=e.sales_order_no,H.value=e.order_line,W.value=e.customer_name,X.value=e.address,ce.value=e.contact_address,O.value=e},ge=async e=>{try{console.log(e.required_delivery.value);const l=await q.put(`/api/updateRequiredDeliveryInDeliverSubs/${e.id}`,{required_delivery:e.required_delivery.value,required_delivery_updated_by_id:g.currentUser.id});e.required_delivery.value=="Confirm"?S.add({severity:"success",summary:`Successfully confirmed #${e.sales_order_no} for delivery`,detail:"",life:3e3}):e.required_delivery.value=="Deny"?S.add({severity:"info",summary:`Successfully denied #${e.sales_order_no}`,detail:"",life:3e3}):S.add({severity:"info",summary:`Updated #${e.sales_order_no}'s require delivery value`,detail:"",life:3e3})}catch(l){console.error("Failed to update required_delivery:",l),S.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};$(R,async e=>{if(e)try{const l=await q.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:e}});z.value=l.data.map(m=>({name:m,value:m})),z.value.push({name:"- Unselect -",value:null})}catch(l){console.error("Error fetching dropdown options:",l)}}),$(w,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),b())}),$(F,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),b())}),$(I,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),b())}),$(B,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),b())}),$(D,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),b())});const Se=e=>e,we=async()=>{var e=y.value.map(m=>m.id);console.log(e);const l=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:g.currentUser.id});await q.post("/api/bulkConfirmDeliverSubs",l,{headers:{"Content-Type":"application/json"}}),S.add({severity:"success",summary:`Successfully confirmed ${e.length} filter subs`,detail:"",life:3e3}),b(),y.value=[]},ke=async e=>{y.value=e},De=async()=>{var e=y.value.map(m=>m.id);console.log(e);const l=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:g.currentUser.id});await q.post("/api/bulkDenyDeliverSubs",l,{headers:{"Content-Type":"application/json"}}),S.add({severity:"success",summary:`Successfully denied ${e.length} filter subs`,detail:"",life:3e3}),b(),y.value=[]};return(e,l)=>{const m=ie("Toast"),J=ie("font-awesome-icon"),U=Pe("tooltip");return o(),v("div",Le,[i("div",null,[i("div",Re,[I.value.length?(o(),v("div",Be,[Me,p(" "+c(pe(I.value)),1)])):_("",!0),w.value.length?(o(),v("div",Je,[Qe,p(" "+c(_e(w.value)),1)])):_("",!0)])]),a(m),a(s(te),{visible:T.value,"onUpdate:visible":l[0]||(l[0]=t=>T.value=t),header:R.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:r(()=>[i("p",null,[Ge,p(" "+c(W.value),1)]),i("p",null,[Ke,p(" "+c(X.value),1)]),ze,a(s(ee),{value:H.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:r(()=>[a(s(u),{field:"product",header:"Product",style:{"min-width":"10rem"}}),a(s(u),{field:"description",header:"Description",style:{"min-width":"10rem"}}),a(s(u),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),i("div",null,[O.value.contact_address[0].parent?(o(),v("p",He,[We,Xe,p(" "+c(O.value.contact_address[0].parent.complete_address),1)])):_("",!0)]),i("div",null,[(o(!0),v(Q,null,G(O.value.contact_address[0].children,(t,d)=>(o(),v("p",{key:d},[Ye,Ze,p(" "+c(t.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),a(s(te),{visible:L.value,"onUpdate:visible":l[3]||(l[3]=t=>L.value=t),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:r(()=>[et,(o(!0),v(Q,null,G(A.value,t=>(o(),v("div",{key:t.id,class:"flex items-center mb-2"},[a(s(le),{modelValue:w.value,"onUpdate:modelValue":l[1]||(l[1]=d=>w.value=d),inputId:t.state_id,name:"stateIds",value:t.state_id},null,8,["modelValue","inputId","value"]),i("label",{for:t.id,class:"ml-2"},c(t.name),9,tt)]))),128)),lt,(o(!0),v(Q,null,G(ue.value,t=>(o(),v("div",{key:t.id,class:"flex items-center mb-2"},[a(s(le),{modelValue:F.value,"onUpdate:modelValue":l[2]||(l[2]=d=>F.value=d),inputId:t.name,name:"category",value:t.name},null,8,["modelValue","inputId","value"]),i("label",{for:t.id,class:"ml-2"},c(t.name),9,st)]))),128))]),_:1},8,["visible"]),y.value.length?(o(),h(s(C),{key:0,class:"ml-4",outlined:""},{default:r(()=>[i("p",at,c(y.value.length),1),p("selected "),y.value.length<f.filterSubs.total?(o(),h(s(C),{key:0,label:`Select all ${f.deliverSubIds.length}`,onClick:l[4]||(l[4]=t=>ke(f.deliverSubIds)),icon:"pi pi-arrow-right",class:"ml-4",severity:"info"},null,8,["label"])):_("",!0)]),_:1})):_("",!0),y.value.length?(o(),h(s(C),{key:1,label:`Confirm All (${y.value.length})`,onClick:we,icon:"pi pi-verified",class:"ml-4"},null,8,["label"])):_("",!0),y.value.length?(o(),h(s(C),{key:2,label:`Deny All (${y.value.length})`,onClick:De,icon:"pi pi-times-circle",class:"ml-4"},null,8,["label"])):_("",!0),a(s(Ie),{rows:N.value,totalRecords:j.value,rowsPerPageOptions:[10,25,50,100],onPage:ve},{start:r(t=>[p(c(f.filterSubs.from)+"-"+c(f.filterSubs.to)+" / "+c(f.filterSubs.total),1)]),_:1},8,["rows","totalRecords"]),a(s(ee),{selection:y.value,"onUpdate:selection":l[7]||(l[7]=t=>y.value=t),value:Se(f.filterSubs.data),lazy:"",loading:V.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu",filters:D.value,"onUpdate:filters":l[8]||(l[8]=t=>D.value=t)},{header:r(()=>[i("div",it,[a(s(C),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:l[5]||(l[5]=t=>he())}),a(s(Fe),null,{default:r(()=>[a(s(Ue),null,{default:r(()=>[ot]),_:1}),i("div",null,[a(s(C),{onClick:l[6]||(l[6]=t=>L.value=!0),label:"Filter",class:"mr-4"}),a(s(qe),{placeholder:"Keyword Search",onInput:fe})])]),_:1})])]),empty:r(()=>[p(" No filterSubs found. ")]),loading:r(()=>[p(" Loading filterSubs data. Please wait. ")]),default:r(()=>[a(s(u),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(s(u),{field:"root_sales_order.sales_order_no",header:"Root Sales Order #",style:{"min-width":"10rem"}},{body:r(({data:t})=>[i("div",rt,[i("span",null,c(t.root_sales_order.sales_order_no),1),a(s(Te)),i("div",{onClick:d=>K(t.root_sales_order.sales_order_no,t.sales_order_no,t.id),style:{cursor:"pointer","margin-left":"8px"}},[a(J,{icon:["fas","link-slash"],style:{color:"#800000"}})],8,nt)])]),_:1}),a(s(u),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:r(({data:t})=>[i("span",{onClick:d=>be(t),class:"cursor-pointer hover:underline"},c(t.sales_order_no),9,dt),i("div",ct,[t.hasCallOutService?x((o(),h(J,{key:0,icon:["fas","toolbox"]},null,512)),[[U,"Filter Sub (Filter + Call Out Service)"]]):x((o(),h(J,{key:1,icon:["fas","faucet"]},null,512)),[[U,"Filter Sub (Filter Only)"]]),t.delivered_or_delivery_booked&&t.delivered_or_delivery_booked.value!==null?x((o(),v("i",ut,null,512)),[[U,"Delivery Booked"]]):_("",!0),t.odoo_created_by_id?x((o(),h(s(ne),{key:3,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:r(()=>[i("img",{src:t.odoo_created_by.profile_photo_url,alt:"User Initials"},null,8,mt)]),_:2},1024)),[[U,`Last updated by:
${t.odoo_created_by.name}`]]):_("",!0)])]),_:1}),e.route().current("confirmDeliveryFilterSubscription")?(o(),h(s(u),{key:0,field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:r(({data:t})=>[i("div",vt,[a(s(xe),{modelValue:t.required_delivery,"onUpdate:modelValue":d=>t.required_delivery=d,options:me.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:d=>ge(t)},{value:r(d=>{var Z;return[d.value?(o(),v("div",ft,[t.required_delivery&&t.required_delivery.value!==null?(o(),v("div",yt,c(((Z=t.required_delivery)==null?void 0:Z.name)||t.required_delivery),1)):(o(),v("div",pt,c(d.placeholder),1))])):(o(),v("span",_t,c(d.placeholder),1))]}),option:r(d=>[i("div",ht,[i("div",null,c(d.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),t.required_delivery_updated_by_id?x((o(),h(s(ne),{key:0,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:r(()=>[i("img",{src:t.required_delivery_updated_by.profile_photo_url,alt:"User Initials"},null,8,bt)]),_:2},1024)),[[U,`Last updated by:
${t.required_delivery_updated_by.name}`]]):_("",!0)])]),_:1})):_("",!0),a(s(u),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),a(s(u),{field:"address",header:"Address",style:{"min-width":"10rem"}}),a(s(u),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),a(s(u),{field:"start_date",header:"Start Date",style:{"min-width":"10rem"},filterField:"start_date",dataType:"date"},{body:r(({data:t})=>[p(c(M(t.start_date)),1)]),filter:r(({filterModel:t})=>[a(s(se),{modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,dateFormat:"dd/mm/yy",placeholder:"dd/mm/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(s(u),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"},filterField:"due_date",dataType:"date"},{body:r(({data:t})=>[p(c(M(t.due_date)),1)]),filter:r(({filterModel:t})=>[a(s(se),{modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,dateFormat:"dd/mm/yy",placeholder:"dd/mm/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(s(u),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),a(s(u),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:r(({data:t})=>[p(c(M(t.invoice_date)),1)]),_:1}),a(s(u),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:r(({data:t})=>{var d;return[p(c((d=A.value[t.state_id-1])==null?void 0:d.name),1)]}),_:1}),a(s(u),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),a(s(u),{field:"email",header:"Email",style:{"min-width":"10rem"}}),a(s(u),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:r(({data:t})=>[t.payment_status==="paid"?(o(),h(s(Ve),{key:0,severity:"success",value:"Paid"})):_("",!0)]),_:1})]),_:1},8,["selection","value","loading","filters"])])}}},St={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},Ut={__name:"ConfirmDeliveryFilterSubscription",props:{filterSubs:Object,filterSubIds:Object,stateIds:Object,users:Object,filters:Object},setup(f){const P=Ee();return(K,g)=>(o(),h(Ce,{title:"confirmDeliveryFilterSubscription"},{default:r(()=>[i("div",St,[a(gt,{filterSubs:f.filterSubs,stateIds:f.stateIds,deliverSubIds:f.filterSubIds,filters:f.filters,currentUser:s(P).props.auth.user,users:f.users},null,8,["filterSubs","stateIds","deliverSubIds","filters","currentUser","users"])])]),_:1}))}};export{Ut as default};
