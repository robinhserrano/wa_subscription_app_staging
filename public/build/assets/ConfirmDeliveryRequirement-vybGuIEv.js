import{_ as pe}from"./AppLayout-Bt29hB35.js";import{d as fe,s as H,a as v,b as J,c as G,e as he,f as A,g as be,h as ge,i as Se,j as we,k as W}from"./primeicons-uK35twJA.js";import{d as _,p as ke,q as Ce,s as X,x as U,y as O,z as Y,o as s,e as o,a as d,f as m,g as b,t as a,b as n,w as c,u as i,F as E,h as T,c as D,Q as Ie}from"./app-DRv2TXE3.js";import{s as Z}from"./index-BnC97A-Q.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const De={class:"card"},$e={class:"m-4 my-4"},xe={key:0,class:"pi pi-calendar"},qe=d("i",{class:"pi pi-user"},null,-1),Fe=d("i",{class:"pi pi-map-marker mt-2"},null,-1),Ve=d("p",{class:"mt-6"}," Order Lines:",-1),Ue={key:0},Oe=d("p",{class:"mt-6 mb-2"}," Other Address:",-1),je=d("i",{class:"pi pi-building-columns"},null,-1),Re=d("p",{class:"mt-6 mb-2"}," Other Address:",-1),Ne=d("i",{class:"pi pi-building"},null,-1),Pe=d("p",{class:"mb-2 text-xl font-bold"},"States",-1),Ae=["for"],Ee=d("p",{class:"mt-4 mb-2 text-xl font-bold"},"Category",-1),Te=["for"],Be=d("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),Le=["for"],Me=d("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),Qe={class:"flex justify-between"},Ge=d("i",{class:"pi pi-search"},null,-1),Ke=["onClick"],ze={key:1,class:"pi pi-truck ml-2"},He={class:"flex"},Je={key:0,class:"flex align-items-center"},We={key:0},Xe={key:1},Ye={key:1},Ze={class:"flex align-items-center"},et={class:"flex"},tt={key:0,class:"flex align-items-center"},lt={key:0},st={key:1},ot={key:1},at={class:"flex align-items-center"},it={key:0},nt={key:1},rt={key:0},dt={key:1},ct={key:0},ut={key:1},_t={key:0},mt={key:1},vt={key:0},yt={key:1},pt={key:0},ft={key:1},ht={key:0},bt={key:1},gt={key:0},St={key:1},wt={key:0},kt={key:1},Ct={key:0},It={key:1},Dt={__name:"ConfirmDeliveryRequirementDataTable",props:{filterSubs:Object,stateIds:Object,filterSubIds:Object,currentUser:Object,users:Object},setup(y){let f=y;const p=_([]);_();const $=_(!0),I=_(1),x=_(0),B=_(),L=_(!1),M=_(!1),ee=_(),Q=_([]),g=ke(),j=_([]),R=_();_();const te=_([{id:1,name:"Subscription"}]),le=_([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),se=_([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),k=_([]),C=_(),q=_([]),F=_([]),V=_([]),N=_(100);Ce(()=>{$.value=!1,x.value=f.filterSubs.total,ee.value=f.salesQuotations,j.value=f.stateIds});const oe=t=>{N.value=t.rows,I.value=t.page+1,console.log("page change"),console.log(I.value),S()},ae=t=>{B.value=t.target.value,console.log(t.target.value),ie()},S=async()=>{try{console.log("fetch data page"),console.log(I.value);const t=await X.get("/confirmDeliveryRequirement",{page:I.value,search:B.value,dates:k.value,stateId:q.value,activitySummary:F.value,categories:V.value,perPage:N.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),x.value=l.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{$.value=!1}},ie=fe(async()=>{try{console.log("fetch data page"),console.log(I.value);const t=await X.get("/confirmDeliveryRequirement",{page:I.value,search:B.value,dates:k.value,stateId:q.value,activitySummary:F.value,categories:V.value,perPage:N.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),x.value=l.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{$.value=!1}},300),P=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,ne=t=>{if(!t||t.length===0)return"";const l=new Date(t[0]),u=t[1]?new Date(t[1]):l;return`${l.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${u.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},re=()=>{initFilters()},de=t=>{L.value=!0,R.value=t.sales_order_no,C.value=t},ce=t=>{R.value=t.sales_order_no,console.log("Select clicked",event)},ue=async t=>{var l;try{const u=await O.put(`/api/updateCreatedOnOdooInFilterSubs/${t.id}`,{created_on_odoo:t.created_on_odoo.value,odoo_created_by_id:f.currentUser.id});(l=t.created_on_odoo)!=null&&l.value?(g.add({severity:"success",summary:`Updated #${t.sales_order_no}'s created on odoo to ${t.created_on_odoo.value}`,detail:"",life:3e3}),S()):g.add({severity:"info",summary:`Moved #${t.sales_order_no} back to Subscription to Enter`,detail:"",life:3e3})}catch(u){console.error("Failed to update created_on_odoo:",u),g.add({severity:"error",summary:"Failed to update",detail:"",life:3e3})}},_e=async t=>{var l,u;try{const h=await O.put(`/api/updateRequiredDeliveryInFilterSubs/${t.id}`,{required_delivery:t.required_delivery.value,required_delivery_updated_by_id:f.currentUser.id});(l=t.required_delivery)!=null&&l.value&&(((u=t.required_delivery)==null?void 0:u.value)==="Confirm"?g.add({severity:"success",summary:`Added #${t.sales_order_no} to Subscriptions to Deliver`,detail:"",life:3e3}):g.add({severity:"success",summary:`Updated #${t.sales_order_no} required delivery to Denied`,detail:"",life:3e3}))}catch(h){console.error("Failed to update created_on_odoo:",h),g.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};U(R,async t=>{if(t)try{const l=await O.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:t}});Q.value=l.data.map(u=>({name:u,value:u})),Q.value.push({name:"- Unselect -",value:null})}catch(l){console.error("Error fetching dropdown options:",l)}}),U(q,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),S())}),U(F,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),S())}),U(k,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),S())}),U(V,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),S())});const me=t=>t.filter(l=>{var u;return l.created_on_odoo!==null&&((u=l.created_on_odoo)==null?void 0:u.value)!==null}),K=t=>t.filter(l=>{var u;return l.created_on_odoo===null||((u=l.created_on_odoo)==null?void 0:u.value)===null||l.created_on_odoo===void 0}).length,z=(t,l)=>{const u=l.find(h=>h.id===t);if(u){const h=u.name.split(" ").map(r=>r[0]).join("").toUpperCase();return h.substring(0,2)||h}return""},ve=async()=>{var t=p.value.map(u=>u.id);console.log(t);const l=JSON.stringify({filterSubIds:t,required_delivery_updated_by_id:f.currentUser.id});await O.post("/api/bulkConfirmFilterSubs",l,{headers:{"Content-Type":"application/json"}}),g.add({severity:"success",summary:`Successfully confirmed ${t.length} filter subs`,detail:"",life:3e3}),S(),p.value=[]},ye=async()=>{var t=p.value.map(u=>u.id);console.log(t);const l=JSON.stringify({filterSubIds:t,required_delivery_updated_by_id:f.currentUser.id});await O.post("/api/bulkDenyFilterSubs",l,{headers:{"Content-Type":"application/json"}}),g.add({severity:"success",summary:`Successfully denied ${t.length} filter subs`,detail:"",life:3e3}),S(),p.value=[]};return(t,l)=>{const u=Y("Toast"),h=Y("font-awesome-icon");return s(),o("div",De,[d("div",null,[d("div",$e,[k.value.length?(s(),o("i",xe)):m("",!0),b(" "+a(ne(k.value)),1)])]),n(u),n(i(J),{visible:L.value,"onUpdate:visible":l[0]||(l[0]=e=>L.value=e),header:R.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[d("p",null,[qe,b(" "+a(C.value.customer_name),1)]),b("filtersubs.wateranalytics.com.au "),d("p",null,[Fe,b(" "+a(C.value.address),1)]),Ve,n(i(H),{value:C.value.order_line,dataKey:"id",showGridlines:"",class:"mt-2"},{default:c(()=>[n(i(v),{field:"product",header:"Product",style:{"min-width":"10rem"}}),n(i(v),{field:"description",header:"Description",style:{"min-width":"10rem"}}),n(i(v),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),d("div",null,[C.value.contact_address[0].parent?(s(),o("p",Ue,[Oe,je,b(" "+a(C.value.contact_address[0].parent.complete_address),1)])):m("",!0)]),d("div",null,[(s(!0),o(E,null,T(C.value.contact_address[0].children,(e,r)=>(s(),o("p",{key:r},[Re,Ne,b(" "+a(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),n(i(J),{visible:M.value,"onUpdate:visible":l[5]||(l[5]=e=>M.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[Pe,(s(!0),o(E,null,T(j.value,e=>(s(),o("div",{key:e.id,class:"flex items-center mb-2"},[n(i(G),{modelValue:q.value,"onUpdate:modelValue":l[1]||(l[1]=r=>q.value=r),inputId:e.state_id,name:"stateIds",value:e.state_id},null,8,["modelValue","inputId","value"]),d("label",{for:e.id,class:"ml-2"},a(e.name),9,Ae)]))),128)),Ee,(s(!0),o(E,null,T(te.value,e=>(s(),o("div",{key:e.id,class:"flex items-center mb-2"},[n(i(G),{modelValue:V.value,"onUpdate:modelValue":l[2]||(l[2]=r=>V.value=r),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),d("label",{for:e.id,class:"ml-2"},a(e.name),9,Te)]))),128)),Be,(s(!0),o(E,null,T(le.value,e=>(s(),o("div",{key:e.id,class:"flex items-center mb-2"},[n(i(G),{modelValue:F.value,"onUpdate:modelValue":l[3]||(l[3]=r=>F.value=r),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),d("label",{for:e.id,class:"ml-2"},a(e.name),9,Le)]))),128)),Me,n(i(he),{modelValue:k.value,"onUpdate:modelValue":l[4]||(l[4]=e=>k.value=e),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),p.value.length?(s(),D(i(A),{key:0,label:`Confirm All (${p.value.length})`,onClick:ve,icon:"pi pi-verified",class:"ml-4"},null,8,["label"])):m("",!0),p.value.length?(s(),D(i(A),{key:1,label:`Deny All (${p.value.length})`,onClick:ye,icon:"pi pi-times-circle",class:"ml-4"},null,8,["label"])):m("",!0),n(i(be),{rows:N.value,totalRecords:x.value,rowsPerPageOptions:[10,25,50,100,x.value].sort((e,r)=>e-r),onPage:oe},{start:c(e=>[b(a(y.filterSubs.from)+"-"+a(y.filterSubs.to-K(y.filterSubs.data))+" / "+a(y.filterSubs.total-K(y.filterSubs.data)),1)]),_:1},8,["rows","totalRecords","rowsPerPageOptions"]),n(i(H),{selection:p.value,"onUpdate:selection":l[8]||(l[8]=e=>p.value=e),value:me(y.filterSubs.data),lazy:"",loading:$.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:c(()=>[d("div",Qe,[n(i(A),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:l[6]||(l[6]=e=>re())}),n(i(ge),null,{default:c(()=>[n(i(Se),null,{default:c(()=>[Ge]),_:1}),d("div",null,[n(i(A),{onClick:l[7]||(l[7]=e=>M.value=!0),label:"Filter",class:"mr-4"}),n(i(we),{placeholder:"Keyword Search",onInput:ae})])]),_:1})])]),empty:c(()=>[b(" No filterSubs found. ")]),loading:c(()=>[b(" Loading filterSubs data. Please wait. ")]),default:c(()=>[n(i(v),{selectionMode:"multiple",headerStyle:"width: 3rem"}),n(i(v),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:c(({data:e})=>[d("span",{onClick:r=>de(e),class:"cursor-pointer hover:underline"},a(e.sales_order_no),9,Ke),e.category==="Subscription"?(s(),D(h,{key:0,icon:"fa-filter-circle-dollar",class:"ml-2"})):m("",!0),e.delivered_or_delivery_booked&&e.delivered_or_delivery_booked.value!==null?(s(),o("i",ze)):m("",!0)]),_:1}),n(i(v),{field:"",header:"Created on Odoo",style:{"min-width":"10rem"}},{body:c(({data:e})=>[d("div",He,[n(i(W),{modelValue:e.created_on_odoo,"onUpdate:modelValue":r=>e.created_on_odoo=r,options:Q.value,filter:"",optionLabel:"name",placeholder:"Select Sales Order #",class:"w-full md:w-14rem",onClick:r=>ce(e),onChange:r=>ue(e)},{value:c(r=>{var w;return[r.value?(s(),o("div",Je,[e.created_on_odoo&&e.created_on_odoo.value!==null?(s(),o("div",We,a(((w=e.created_on_odoo)==null?void 0:w.name)||e.created_on_odoo),1)):(s(),o("div",Xe,a(r.placeholder),1))])):(s(),o("span",Ye,a(r.placeholder),1))]}),option:c(r=>[d("div",Ze,[d("div",null,a(r.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onClick","onChange"]),e.odoo_created_by_id?(s(),D(i(Z),{key:0,label:z(e.odoo_created_by_id,y.users),class:"ml-2",style:{"background-color":"#dee9fc",color:"#1a2551"}},null,8,["label"])):m("",!0)])]),_:1}),n(i(v),{field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:c(({data:e})=>[d("div",et,[n(i(W),{modelValue:e.required_delivery,"onUpdate:modelValue":r=>e.required_delivery=r,options:se.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:r=>_e(e)},{value:c(r=>{var w;return[r.value?(s(),o("div",tt,[e.required_delivery&&e.required_delivery.value!==null?(s(),o("div",lt,a(((w=e.required_delivery)==null?void 0:w.name)||e.required_delivery),1)):(s(),o("div",st,a(r.placeholder),1))])):(s(),o("span",ot,a(r.placeholder),1))]}),option:c(r=>[d("div",at,[d("div",null,a(r.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),e.required_delivery_updated_by_id?(s(),D(i(Z),{key:0,label:z(e.required_delivery_updated_by_id,y.users),class:"ml-2",style:{"background-color":"#dee9fc",color:"#1a2551"}},null,8,["label"])):m("",!0)])]),_:1}),n(i(v),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"},{body:c(({data:e})=>[e.new_sales_order.customer_name?(s(),o("p",it,a(e.new_sales_order.customer_name),1)):e.customer_name?(s(),o("p",nt,a(e.customer_name),1)):m("",!0)]),_:1}),n(i(v),{field:"address",header:"Address",style:{"min-width":"10rem"}},{body:c(({data:e})=>[e.new_sales_order.address?(s(),o("p",rt,a(e.new_sales_order.address),1)):e.address?(s(),o("p",dt,a(e.address),1)):m("",!0)]),_:1}),n(i(v),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}},{body:c(({data:e})=>[e.new_sales_order.activity_summary?(s(),o("p",ct,a(e.new_sales_order.activity_summary),1)):e.activity_summary?(s(),o("p",ut,a(e.activity_summary),1)):m("",!0)]),_:1}),n(i(v),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:c(({data:e})=>[e.new_sales_order.due_date?(s(),o("p",_t,a(P(e.new_sales_order.due_date)),1)):e.due_date?(s(),o("p",mt,a(P(e.due_date)),1)):m("",!0)]),_:1}),n(i(v),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}},{body:c(({data:e})=>[e.new_sales_order.invoice_number?(s(),o("p",vt,a(e.new_sales_order.invoice_number),1)):e.invoice_number?(s(),o("p",yt,a(e.invoice_number),1)):m("",!0)]),_:1}),n(i(v),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:c(({data:e})=>[e.new_sales_order.invoice_date?(s(),o("p",pt,a(P(e.new_sales_order.invoice_date)),1)):e.invoice_date?(s(),o("p",ft,a(P(e.invoice_date)),1)):m("",!0)]),_:1}),n(i(v),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:c(({data:e})=>{var r,w;return[e.new_sales_order.state_id?(s(),o("p",ht,a((r=j.value[e.new_sales_order.state_id-1])==null?void 0:r.name),1)):e.state_id?(s(),o("p",bt,a((w=j.value[e.state_id-1])==null?void 0:w.name),1)):m("",!0)]}),_:1}),n(i(v),{field:"phone",header:"Phone",style:{"min-width":"10rem"}},{body:c(({data:e})=>[e.new_sales_order.phone?(s(),o("p",gt,a(e.new_sales_order.phone),1)):e.phone?(s(),o("p",St,a(e.phone),1)):m("",!0)]),_:1}),n(i(v),{field:"email",header:"Email",style:{"min-width":"10rem"}},{body:c(({data:e})=>[e.new_sales_order.email?(s(),o("p",wt,a(e.new_sales_order.email),1)):e.email?(s(),o("p",kt,a(e.email),1)):m("",!0)]),_:1}),n(i(v),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:c(({data:e})=>[e.new_sales_order.payment_status?(s(),o("p",Ct,a(e.new_sales_order.payment_status),1)):e.payment_status?(s(),o("p",It,a(e.payment_status),1)):m("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},$t={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},Ot={__name:"ConfirmDeliveryRequirement",props:{filterSubs:Object,stateIds:Object,activitySummaries:Object,filterSubIds:Object,users:Object},setup(y){const f=Ie();return(p,$)=>(s(),D(pe,{title:"ConfirmDeliveryRequirement"},{default:c(()=>[d("div",$t,[n(Dt,{filterSubs:y.filterSubs,stateIds:y.stateIds,activitySummaries:y.activitySummaries,filterSubIds:y.filterSubIds,currentUser:i(f).props.auth.user,users:y.users},null,8,["filterSubs","stateIds","activitySummaries","filterSubIds","currentUser","users"])])]),_:1}))}};export{Ot as default};
