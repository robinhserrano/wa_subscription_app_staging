import{_ as he}from"./AppLayout-jSiHA2iZ.js";import{d as fe,s as H,a as v,b as J,c as G,e as be,f as A,g as ge,h as Se,i as we,j as ke,k as W}from"./primeicons-VkbeT39n.js";import{d as _,p as Ce,q as Ie,s as X,x as O,y as j,z as Y,o as s,e as o,a as d,g as h,t as a,f as m,b as n,w as u,u as i,F as E,h as T,c as $,Q as De}from"./app-Bpqm5GAO.js";import{s as Z}from"./index-BXUwbsjA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const $e={class:"card"},xe={class:"m-4 my-4"},qe={key:0},Fe=d("i",{class:"pi pi-calendar"},null,-1),Ve={key:1},Ue=d("i",{class:"pi pi-map-marker"},null,-1),Oe=d("i",{class:"pi pi-user"},null,-1),je=d("i",{class:"pi pi-map-marker mt-2"},null,-1),Re=d("p",{class:"mt-6"}," Order Lines:",-1),Ne={key:0},Pe=d("p",{class:"mt-6 mb-2"}," Other Address:",-1),Ae=d("i",{class:"pi pi-building-columns"},null,-1),Ee=d("p",{class:"mt-6 mb-2"}," Other Address:",-1),Te=d("i",{class:"pi pi-building"},null,-1),Be=d("p",{class:"mb-2 text-xl font-bold"},"States",-1),Le=["for"],Me=d("p",{class:"mt-4 mb-2 text-xl font-bold"},"Category",-1),Qe=["for"],Ge=d("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),Ke=["for"],ze=d("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),He={class:"flex justify-between"},Je=d("i",{class:"pi pi-search"},null,-1),We=["onClick"],Xe={key:1,class:"pi pi-truck ml-2"},Ye={class:"flex"},Ze={key:0,class:"flex align-items-center"},et={key:0},tt={key:1},lt={key:1},st={class:"flex align-items-center"},ot={class:"flex"},at={key:0,class:"flex align-items-center"},it={key:0},nt={key:1},rt={key:1},dt={class:"flex align-items-center"},ct={key:0},ut={key:1},_t={key:0},mt={key:1},vt={key:0},yt={key:1},pt={key:0},ht={key:1},ft={key:0},bt={key:1},gt={key:0},St={key:1},wt={key:0},kt={key:1},Ct={key:0},It={key:1},Dt={key:0},$t={key:1},xt={key:0},qt={key:1},Ft={__name:"ConfirmDeliveryRequirementDataTable",props:{filterSubs:Object,stateIds:Object,filterSubIds:Object,currentUser:Object,users:Object},setup(y){let f=y;const p=_([]);_();const x=_(!0),D=_(1),q=_(0),B=_(),L=_(!1),M=_(!1),ee=_(),Q=_([]),g=Ce(),F=_([]),R=_();_();const te=_([{id:1,name:"Subscription"}]),le=_([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),se=_([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),k=_([]),C=_(),I=_([]),V=_([]),U=_([]),N=_(100);Ie(()=>{x.value=!1,q.value=f.filterSubs.total,ee.value=f.salesQuotations,F.value=f.stateIds});const oe=t=>{N.value=t.rows,D.value=t.page+1,console.log("page change"),console.log(D.value),S()},ae=t=>{B.value=t.target.value,console.log(t.target.value),ie()},S=async()=>{try{console.log("fetch data page"),console.log(D.value);const t=await X.get("/confirmDeliveryRequirement",{page:D.value,search:B.value,dates:k.value,stateId:I.value,activitySummary:V.value,categories:U.value,perPage:N.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),q.value=l.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{x.value=!1}},ie=fe(async()=>{try{console.log("fetch data page"),console.log(D.value);const t=await X.get("/confirmDeliveryRequirement",{page:D.value,search:B.value,dates:k.value,stateId:I.value,activitySummary:V.value,categories:U.value,perPage:N.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),q.value=l.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{x.value=!1}},300),P=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,ne=t=>{if(!t||t.length===0)return"";const l=new Date(t[0]),c=t[1]?new Date(t[1]):l;return`${l.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${c.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},re=t=>t.map(l=>{var c;return(c=F.value[l-1])==null?void 0:c.code}).join(", "),de=()=>{initFilters()},ce=t=>{L.value=!0,R.value=t.sales_order_no,C.value=t},ue=t=>{R.value=t.sales_order_no,console.log("Select clicked",event)},_e=async t=>{var l;try{const c=await j.put(`/api/updateCreatedOnOdooInFilterSubs/${t.id}`,{created_on_odoo:t.created_on_odoo.value,odoo_created_by_id:f.currentUser.id});(l=t.created_on_odoo)!=null&&l.value?(g.add({severity:"success",summary:`Updated #${t.sales_order_no}'s created on odoo to ${t.created_on_odoo.value}`,detail:"",life:3e3}),S()):g.add({severity:"info",summary:`Moved #${t.sales_order_no} back to Subscription to Enter`,detail:"",life:3e3})}catch(c){console.error("Failed to update created_on_odoo:",c),g.add({severity:"error",summary:"Failed to update",detail:"",life:3e3})}},me=async t=>{var l,c;try{const b=await j.put(`/api/updateRequiredDeliveryInFilterSubs/${t.id}`,{required_delivery:t.required_delivery.value,required_delivery_updated_by_id:f.currentUser.id});(l=t.required_delivery)!=null&&l.value&&(((c=t.required_delivery)==null?void 0:c.value)==="Confirm"?g.add({severity:"success",summary:`Added #${t.sales_order_no} to Subscriptions to Deliver`,detail:"",life:3e3}):g.add({severity:"success",summary:`Updated #${t.sales_order_no} required delivery to Denied`,detail:"",life:3e3}))}catch(b){console.error("Failed to update created_on_odoo:",b),g.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};O(R,async t=>{if(t)try{const l=await j.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:t}});Q.value=l.data.map(c=>({name:c,value:c})),Q.value.push({name:"- Unselect -",value:null})}catch(l){console.error("Error fetching dropdown options:",l)}}),O(I,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),S())}),O(V,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),S())}),O(k,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),S())}),O(U,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),S())});const ve=t=>t.filter(l=>{var c;return l.created_on_odoo!==null&&((c=l.created_on_odoo)==null?void 0:c.value)!==null}),K=t=>t.filter(l=>{var c;return l.created_on_odoo===null||((c=l.created_on_odoo)==null?void 0:c.value)===null||l.created_on_odoo===void 0}).length,z=(t,l)=>{const c=l.find(b=>b.id===t);if(c){const b=c.name.split(" ").map(r=>r[0]).join("").toUpperCase();return b.substring(0,2)||b}return""},ye=async()=>{var t=p.value.map(c=>c.id);console.log(t);const l=JSON.stringify({filterSubIds:t,required_delivery_updated_by_id:f.currentUser.id});await j.post("/api/bulkConfirmFilterSubs",l,{headers:{"Content-Type":"application/json"}}),g.add({severity:"success",summary:`Successfully confirmed ${t.length} filter subs`,detail:"",life:3e3}),S(),p.value=[]},pe=async()=>{var t=p.value.map(c=>c.id);console.log(t);const l=JSON.stringify({filterSubIds:t,required_delivery_updated_by_id:f.currentUser.id});await j.post("/api/bulkDenyFilterSubs",l,{headers:{"Content-Type":"application/json"}}),g.add({severity:"success",summary:`Successfully denied ${t.length} filter subs`,detail:"",life:3e3}),S(),p.value=[]};return(t,l)=>{const c=Y("Toast"),b=Y("font-awesome-icon");return s(),o("div",$e,[d("div",null,[d("div",xe,[k.value.length?(s(),o("div",qe,[Fe,h(" "+a(ne(k.value)),1)])):m("",!0),I.value.length?(s(),o("div",Ve,[Ue,h(" "+a(re(I.value)),1)])):m("",!0)])]),n(c),n(i(J),{visible:L.value,"onUpdate:visible":l[0]||(l[0]=e=>L.value=e),header:R.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:u(()=>[d("p",null,[Oe,h(" "+a(C.value.customer_name),1)]),h("filtersubs.wateranalytics.com.au "),d("p",null,[je,h(" "+a(C.value.address),1)]),Re,n(i(H),{value:C.value.order_line,dataKey:"id",showGridlines:"",class:"mt-2"},{default:u(()=>[n(i(v),{field:"product",header:"Product",style:{"min-width":"10rem"}}),n(i(v),{field:"description",header:"Description",style:{"min-width":"10rem"}}),n(i(v),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),d("div",null,[C.value.contact_address[0].parent?(s(),o("p",Ne,[Pe,Ae,h(" "+a(C.value.contact_address[0].parent.complete_address),1)])):m("",!0)]),d("div",null,[(s(!0),o(E,null,T(C.value.contact_address[0].children,(e,r)=>(s(),o("p",{key:r},[Ee,Te,h(" "+a(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),n(i(J),{visible:M.value,"onUpdate:visible":l[5]||(l[5]=e=>M.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:u(()=>[Be,(s(!0),o(E,null,T(F.value,e=>(s(),o("div",{key:e.id,class:"flex items-center mb-2"},[n(i(G),{modelValue:I.value,"onUpdate:modelValue":l[1]||(l[1]=r=>I.value=r),inputId:e.state_id,name:"stateIds",value:e.state_id},null,8,["modelValue","inputId","value"]),d("label",{for:e.id,class:"ml-2"},a(e.name),9,Le)]))),128)),Me,(s(!0),o(E,null,T(te.value,e=>(s(),o("div",{key:e.id,class:"flex items-center mb-2"},[n(i(G),{modelValue:U.value,"onUpdate:modelValue":l[2]||(l[2]=r=>U.value=r),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),d("label",{for:e.id,class:"ml-2"},a(e.name),9,Qe)]))),128)),Ge,(s(!0),o(E,null,T(le.value,e=>(s(),o("div",{key:e.id,class:"flex items-center mb-2"},[n(i(G),{modelValue:V.value,"onUpdate:modelValue":l[3]||(l[3]=r=>V.value=r),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),d("label",{for:e.id,class:"ml-2"},a(e.name),9,Ke)]))),128)),ze,n(i(be),{modelValue:k.value,"onUpdate:modelValue":l[4]||(l[4]=e=>k.value=e),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),p.value.length?(s(),$(i(A),{key:0,label:`Confirm All (${p.value.length})`,onClick:ye,icon:"pi pi-verified",class:"ml-4"},null,8,["label"])):m("",!0),p.value.length?(s(),$(i(A),{key:1,label:`Deny All (${p.value.length})`,onClick:pe,icon:"pi pi-times-circle",class:"ml-4"},null,8,["label"])):m("",!0),n(i(ge),{rows:N.value,totalRecords:q.value,rowsPerPageOptions:[10,25,50,100,q.value].sort((e,r)=>e-r),onPage:oe},{start:u(e=>[h(a(y.filterSubs.from)+"-"+a(y.filterSubs.to-K(y.filterSubs.data))+" / "+a(y.filterSubs.total-K(y.filterSubs.data)),1)]),_:1},8,["rows","totalRecords","rowsPerPageOptions"]),n(i(H),{selection:p.value,"onUpdate:selection":l[8]||(l[8]=e=>p.value=e),value:ve(y.filterSubs.data),lazy:"",loading:x.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:u(()=>[d("div",He,[n(i(A),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:l[6]||(l[6]=e=>de())}),n(i(Se),null,{default:u(()=>[n(i(we),null,{default:u(()=>[Je]),_:1}),d("div",null,[n(i(A),{onClick:l[7]||(l[7]=e=>M.value=!0),label:"Filter",class:"mr-4"}),n(i(ke),{placeholder:"Keyword Search",onInput:ae})])]),_:1})])]),empty:u(()=>[h(" No filterSubs found. ")]),loading:u(()=>[h(" Loading filterSubs data. Please wait. ")]),default:u(()=>[n(i(v),{selectionMode:"multiple",headerStyle:"width: 3rem"}),n(i(v),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:u(({data:e})=>[d("span",{onClick:r=>ce(e),class:"cursor-pointer hover:underline"},a(e.sales_order_no),9,We),e.category==="Subscription"?(s(),$(b,{key:0,icon:"fa-filter-circle-dollar",class:"ml-2"})):m("",!0),e.delivered_or_delivery_booked&&e.delivered_or_delivery_booked.value!==null?(s(),o("i",Xe)):m("",!0)]),_:1}),n(i(v),{field:"",header:"Created on Odoo",style:{"min-width":"10rem"}},{body:u(({data:e})=>[d("div",Ye,[n(i(W),{modelValue:e.created_on_odoo,"onUpdate:modelValue":r=>e.created_on_odoo=r,options:Q.value,filter:"",optionLabel:"name",placeholder:"Select Sales Order #",class:"w-full md:w-14rem",onClick:r=>ue(e),onChange:r=>_e(e)},{value:u(r=>{var w;return[r.value?(s(),o("div",Ze,[e.created_on_odoo&&e.created_on_odoo.value!==null?(s(),o("div",et,a(((w=e.created_on_odoo)==null?void 0:w.name)||e.created_on_odoo),1)):(s(),o("div",tt,a(r.placeholder),1))])):(s(),o("span",lt,a(r.placeholder),1))]}),option:u(r=>[d("div",st,[d("div",null,a(r.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onClick","onChange"]),e.odoo_created_by_id?(s(),$(i(Z),{key:0,label:z(e.odoo_created_by_id,y.users),class:"ml-2",style:{"background-color":"#dee9fc",color:"#1a2551"}},null,8,["label"])):m("",!0)])]),_:1}),n(i(v),{field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:u(({data:e})=>[d("div",ot,[n(i(W),{modelValue:e.required_delivery,"onUpdate:modelValue":r=>e.required_delivery=r,options:se.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:r=>me(e)},{value:u(r=>{var w;return[r.value?(s(),o("div",at,[e.required_delivery&&e.required_delivery.value!==null?(s(),o("div",it,a(((w=e.required_delivery)==null?void 0:w.name)||e.required_delivery),1)):(s(),o("div",nt,a(r.placeholder),1))])):(s(),o("span",rt,a(r.placeholder),1))]}),option:u(r=>[d("div",dt,[d("div",null,a(r.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),e.required_delivery_updated_by_id?(s(),$(i(Z),{key:0,label:z(e.required_delivery_updated_by_id,y.users),class:"ml-2",style:{"background-color":"#dee9fc",color:"#1a2551"}},null,8,["label"])):m("",!0)])]),_:1}),n(i(v),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"},{body:u(({data:e})=>[e.new_sales_order.customer_name?(s(),o("p",ct,a(e.new_sales_order.customer_name),1)):e.customer_name?(s(),o("p",ut,a(e.customer_name),1)):m("",!0)]),_:1}),n(i(v),{field:"address",header:"Address",style:{"min-width":"10rem"}},{body:u(({data:e})=>[e.new_sales_order.address?(s(),o("p",_t,a(e.new_sales_order.address),1)):e.address?(s(),o("p",mt,a(e.address),1)):m("",!0)]),_:1}),n(i(v),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}},{body:u(({data:e})=>[e.new_sales_order.activity_summary?(s(),o("p",vt,a(e.new_sales_order.activity_summary),1)):e.activity_summary?(s(),o("p",yt,a(e.activity_summary),1)):m("",!0)]),_:1}),n(i(v),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:u(({data:e})=>[e.new_sales_order.due_date?(s(),o("p",pt,a(P(e.new_sales_order.due_date)),1)):e.due_date?(s(),o("p",ht,a(P(e.due_date)),1)):m("",!0)]),_:1}),n(i(v),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}},{body:u(({data:e})=>[e.new_sales_order.invoice_number?(s(),o("p",ft,a(e.new_sales_order.invoice_number),1)):e.invoice_number?(s(),o("p",bt,a(e.invoice_number),1)):m("",!0)]),_:1}),n(i(v),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:u(({data:e})=>[e.new_sales_order.invoice_date?(s(),o("p",gt,a(P(e.new_sales_order.invoice_date)),1)):e.invoice_date?(s(),o("p",St,a(P(e.invoice_date)),1)):m("",!0)]),_:1}),n(i(v),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:u(({data:e})=>{var r,w;return[e.new_sales_order.state_id?(s(),o("p",wt,a((r=F.value[e.new_sales_order.state_id-1])==null?void 0:r.name),1)):e.state_id?(s(),o("p",kt,a((w=F.value[e.state_id-1])==null?void 0:w.name),1)):m("",!0)]}),_:1}),n(i(v),{field:"phone",header:"Phone",style:{"min-width":"10rem"}},{body:u(({data:e})=>[e.new_sales_order.phone?(s(),o("p",Ct,a(e.new_sales_order.phone),1)):e.phone?(s(),o("p",It,a(e.phone),1)):m("",!0)]),_:1}),n(i(v),{field:"email",header:"Email",style:{"min-width":"10rem"}},{body:u(({data:e})=>[e.new_sales_order.email?(s(),o("p",Dt,a(e.new_sales_order.email),1)):e.email?(s(),o("p",$t,a(e.email),1)):m("",!0)]),_:1}),n(i(v),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:u(({data:e})=>[e.new_sales_order.payment_status?(s(),o("p",xt,a(e.new_sales_order.payment_status),1)):e.payment_status?(s(),o("p",qt,a(e.payment_status),1)):m("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},Vt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},Pt={__name:"ConfirmDeliveryRequirement",props:{filterSubs:Object,stateIds:Object,activitySummaries:Object,filterSubIds:Object,users:Object},setup(y){const f=De();return(p,x)=>(s(),$(he,{title:"ConfirmDeliveryRequirement"},{default:u(()=>[d("div",Vt,[n(Ft,{filterSubs:y.filterSubs,stateIds:y.stateIds,activitySummaries:y.activitySummaries,filterSubIds:y.filterSubIds,currentUser:i(f).props.auth.user,users:y.users},null,8,["filterSubs","stateIds","activitySummaries","filterSubIds","currentUser","users"])])]),_:1}))}};export{Pt as default};
