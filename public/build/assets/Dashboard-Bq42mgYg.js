import{_ as ye}from"./AppLayout-jSiHA2iZ.js";import{d as ge,s as W,a as v,b as J,c as T,e as be,g as Se,f as X,h as we,i as Ce,j as ke,k as Y}from"./primeicons-VkbeT39n.js";import{s as Ie}from"./index-Bz4IMvjr.js";import{A as De,d,p as xe,q as $e,s as Z,x,y as M,z as ee,o as i,e as m,a as s,g as h,t as c,f as b,b as o,w as u,u as l,F as j,h as N,c as P,Q as Fe}from"./app-Bpqm5GAO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ve={class:"card"},Ue={class:"m-4 my-4"},Oe={key:0},qe=s("i",{class:"pi pi-calendar"},null,-1),je={key:1},Ne=s("i",{class:"pi pi-map-marker"},null,-1),Pe=s("i",{class:"pi pi-user"},null,-1),Re=s("i",{class:"pi pi-map-marker mt-2"},null,-1),Ae=s("p",{class:"mt-6"}," Order Lines:",-1),Ee={key:0},Le=s("p",{class:"mt-6 mb-2"}," Other Address:",-1),Be=s("i",{class:"pi pi-building-columns"},null,-1),Te=s("p",{class:"mt-6 mb-2"}," Other Address:",-1),Me=s("i",{class:"pi pi-building"},null,-1),Qe=s("p",{class:"mb-2 text-xl font-bold"},"States",-1),Ge=["for"],Ke=s("p",{class:"mt-4 mb-2 text-xl font-bold"},"Category",-1),ze=["for"],He=s("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),We=["for"],Je=s("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),Xe={class:"flex justify-between"},Ye=s("i",{class:"pi pi-search"},null,-1),Ze=["onClick"],et={key:1,class:"pi pi-truck ml-2"},tt={key:0,class:"flex align-items-center"},at={key:0},lt={key:1},ot={key:1},st={class:"flex align-items-center"},nt={key:0,class:"flex align-items-center"},it={key:0},rt={key:1},dt={key:1},ct={class:"flex align-items-center"},ut={__name:"SubsToEnterDataTable",props:{filterSubs:Object,stateIds:Object,filterSubIds:Object,currentUser:Object},setup(p){De();let f=p;const R=d([]),w=d(!0),S=d(1),$=d(0),A=d(),E=d(!1),L=d(!1),te=d(),B=d([]),F=xe(),V=d([]),U=d(),Q=d(),G=d(),K=d(),ae=d([]),le=d([{id:1,name:"Subscription"}]),oe=d([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),se=d([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),y=d([]),O=d(),g=d([]),C=d([]),k=d([]),q=d(100);$e(()=>{w.value=!1,$.value=f.filterSubs.total,te.value=f.salesQuotations,V.value=f.stateIds});const ne=t=>{q.value=t.rows,S.value=t.page+1,console.log("page change"),console.log(S.value),I()},ie=t=>{A.value=t.target.value,console.log(t.target.value),re()},I=async()=>{try{console.log("fetch data page"),console.log(S.value);const t=Z.get("/dashboard",{page:S.value,search:A.value,dates:y.value,stateId:g.value,activitySummary:C.value,categories:k.value,perPage:q.value},{preserveState:!0,replace:!1,onSuccess:a=>{console.log(a),console.log(a.props.filterSubs.total),$.value=a.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{w.value=!1}},re=ge(async()=>{try{console.log("fetch data page"),console.log(S.value);const t=await Z.get("/dashboard",{page:S.value,search:A.value,dates:y.value,stateId:g.value,activitySummary:C.value,categories:k.value,perPage:q.value},{preserveState:!0,replace:!1,onSuccess:a=>{console.log(a),console.log(a.props.filterSubs.total),$.value=a.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{w.value=!1}},300),z=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,de=t=>{if(!t||t.length===0)return"";const a=new Date(t[0]),_=t[1]?new Date(t[1]):a;return`${a.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${_.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},ce=t=>t.map(a=>{var _;return(_=V.value[a-1])==null?void 0:_.code}).join(", "),ue=()=>{initFilters()},me=t=>{E.value=!0,U.value=t.sales_order_no,Q.value=t.order_line,G.value=t.customer_name,K.value=t.address,ae.value=t.contact_address,O.value=t},ve=t=>{U.value=t.sales_order_no},_e=async t=>{var a;try{if((a=t.created_on_odoo)!=null&&a.value){const _=await M.put(`/api/updateCreatedOnOdooInFilterSubs/${t.id}`,{created_on_odoo:t.created_on_odoo.value,odoo_created_by_id:f.currentUser.id});F.add({severity:"success",summary:`Moved #${t.sales_order_no} to Confirm Delivery Requirement`,detail:"",life:3e3})}}catch(_){console.error("Failed to update created_on_odoo:",_),F.add({severity:"error",summary:"Failed to update",detail:"",life:3e3})}},pe=async t=>{try{const a=await M.put(`/api/updateRequiredDeliveryInFilterSubs/${t.id}`,{required_delivery:t.required_delivery.value,required_delivery_updated_by_id:f.currentUser.id});F.add({severity:"success",summary:"Success",detail:"Message Content",life:3e3})}catch(a){r,console.error("Failed to update created_on_odoo:",a),F.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};x(U,async t=>{if(t)try{const a=await M.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:t}});B.value=a.data.map(_=>({name:_,value:_})),B.value.push({name:"- Unselect -",value:null})}catch(a){console.error("Error fetching dropdown options:",a)}}),x(g,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),I())}),x(C,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),I())}),x(y,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),I())}),x(k,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),I())});const he=t=>t.filter(a=>{var _;return a.created_on_odoo===null||((_=a.created_on_odoo)==null?void 0:_.value)===null}),H=t=>t.filter(a=>a.created_on_odoo!==null&&a.created_on_odoo!==void 0).length;return(t,a)=>{const _=ee("Toast"),fe=ee("font-awesome-icon");return i(),m("div",Ve,[s("div",null,[s("div",Ue,[y.value.length?(i(),m("div",Oe,[qe,h(" "+c(de(y.value)),1)])):b("",!0),g.value.length?(i(),m("div",je,[Ne,h(" "+c(ce(g.value)),1)])):b("",!0)])]),o(_),o(l(J),{visible:E.value,"onUpdate:visible":a[0]||(a[0]=e=>E.value=e),header:U.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:u(()=>[s("p",null,[Pe,h(" "+c(G.value),1)]),s("p",null,[Re,h(" "+c(K.value),1)]),Ae,o(l(W),{value:Q.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:u(()=>[o(l(v),{field:"product",header:"Product",style:{"min-width":"10rem"}}),o(l(v),{field:"description",header:"Description",style:{"min-width":"10rem"}}),o(l(v),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),s("div",null,[O.value.contact_address[0].parent?(i(),m("p",Ee,[Le,Be,h(" "+c(O.value.contact_address[0].parent.complete_address),1)])):b("",!0)]),s("div",null,[(i(!0),m(j,null,N(O.value.contact_address[0].children,(e,n)=>(i(),m("p",{key:n},[Te,Me,h(" "+c(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),o(l(J),{visible:L.value,"onUpdate:visible":a[5]||(a[5]=e=>L.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:u(()=>[Qe,(i(!0),m(j,null,N(V.value,e=>(i(),m("div",{key:e.id,class:"flex items-center mb-2"},[o(l(T),{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=n=>g.value=n),inputId:e.state_id,name:"stateIds",value:e.state_id},null,8,["modelValue","inputId","value"]),s("label",{for:e.id,class:"ml-2"},c(e.name),9,Ge)]))),128)),Ke,(i(!0),m(j,null,N(le.value,e=>(i(),m("div",{key:e.id,class:"flex items-center mb-2"},[o(l(T),{modelValue:k.value,"onUpdate:modelValue":a[2]||(a[2]=n=>k.value=n),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),s("label",{for:e.id,class:"ml-2"},c(e.name),9,ze)]))),128)),He,(i(!0),m(j,null,N(oe.value,e=>(i(),m("div",{key:e.id,class:"flex items-center mb-2"},[o(l(T),{modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=n=>C.value=n),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),s("label",{for:e.id,class:"ml-2"},c(e.name),9,We)]))),128)),Je,o(l(be),{modelValue:y.value,"onUpdate:modelValue":a[4]||(a[4]=e=>y.value=e),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),o(l(Se),{rows:q.value,totalRecords:$.value,rowsPerPageOptions:[10,25,50,100],onPage:ne},{start:u(e=>[h(c(p.filterSubs.from)+"-"+c(p.filterSubs.to-H(p.filterSubs.data))+" / "+c(p.filterSubs.total-H(p.filterSubs.data)),1)]),_:1},8,["rows","totalRecords"]),o(l(W),{selection:R.value,"onUpdate:selection":a[8]||(a[8]=e=>R.value=e),value:he(p.filterSubs.data),lazy:"",loading:w.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:u(()=>[s("div",Xe,[o(l(X),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:a[6]||(a[6]=e=>ue())}),o(l(we),null,{default:u(()=>[o(l(Ce),null,{default:u(()=>[Ye]),_:1}),s("div",null,[o(l(X),{onClick:a[7]||(a[7]=e=>L.value=!0),label:"Filter",class:"mr-4"}),o(l(ke),{placeholder:"Keyword Search",onInput:ie})])]),_:1})])]),empty:u(()=>[h(" No filterSubs found. ")]),loading:u(()=>[h(" Loading filterSubs data. Please wait. ")]),default:u(()=>[o(l(v),{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(l(v),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:u(({data:e})=>[s("span",{onClick:n=>me(e),class:"cursor-pointer hover:underline"},c(e.sales_order_no),9,Ze),e.category==="Subscription"?(i(),P(fe,{key:0,icon:"fa-filter-circle-dollar",class:"ml-2"})):b("",!0),e.delivered_or_delivery_booked&&e.delivered_or_delivery_booked.value!==null?(i(),m("i",et)):b("",!0)]),_:1}),o(l(v),{field:"",header:"Created on Odoo",style:{"min-width":"10rem"}},{body:u(({data:e})=>[o(l(Y),{modelValue:e.created_on_odoo,"onUpdate:modelValue":n=>e.created_on_odoo=n,options:B.value,filter:"",optionLabel:"name",placeholder:"Select Sales Order #",class:"w-full md:w-14rem",onClick:n=>ve(e),onChange:n=>_e(e)},{value:u(n=>{var D;return[n.value?(i(),m("div",tt,[e.created_on_odoo&&e.created_on_odoo.value!==null?(i(),m("div",at,c(((D=e.created_on_odoo)==null?void 0:D.name)||e.created_on_odoo),1)):(i(),m("div",lt,c(n.placeholder),1))])):(i(),m("span",ot,c(n.placeholder),1))]}),option:u(n=>[s("div",st,[s("div",null,c(n.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onClick","onChange"])]),_:1}),t.route().current("confirmDeliveryRequirement")?(i(),P(l(v),{key:0,field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:u(({data:e})=>[o(l(Y),{modelValue:e.required_delivery,"onUpdate:modelValue":n=>e.required_delivery=n,options:se.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:n=>pe(e)},{value:u(n=>{var D;return[n.value?(i(),m("div",nt,[e.required_delivery&&e.required_delivery.value!==null?(i(),m("div",it,c(((D=e.required_delivery)==null?void 0:D.name)||e.required_delivery),1)):(i(),m("div",rt,c(n.placeholder),1))])):(i(),m("span",dt,c(n.placeholder),1))]}),option:u(n=>[s("div",ct,[s("div",null,c(n.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1})):b("",!0),o(l(v),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),o(l(v),{field:"address",header:"Address",style:{"min-width":"10rem"}}),o(l(v),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),o(l(v),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:u(({data:e})=>[h(c(z(e.due_date)),1)]),_:1}),o(l(v),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),o(l(v),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:u(({data:e})=>[h(c(z(e.invoice_date)),1)]),_:1}),o(l(v),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:u(({data:e})=>{var n;return[h(c((n=V.value[e.state_id-1])==null?void 0:n.name),1)]}),_:1}),o(l(v),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),o(l(v),{field:"email",header:"Email",style:{"min-width":"10rem"}}),o(l(v),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:u(({data:e})=>[e.payment_status==="paid"?(i(),P(l(Ie),{key:0,severity:"success",value:"Paid"})):b("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},mt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},yt={__name:"Dashboard",props:{filterSubs:Object,stateIds:Object,activitySummaries:Object,filterSubIds:Object},setup(p){const f=Fe();return(R,w)=>(i(),P(ye,{title:"Dashboard"},{default:u(()=>[s("div",mt,[o(ut,{filterSubs:p.filterSubs,stateIds:p.stateIds,activitySummaries:p.activitySummaries,filterSubIds:p.filterSubIds,currentUser:l(f).props.auth.user},null,8,["filterSubs","stateIds","activitySummaries","filterSubIds","currentUser"])])]),_:1}))}};export{yt as default};
