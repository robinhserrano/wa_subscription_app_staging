import{_ as ye}from"./AppLayout-ChJ3s0TN.js";import{d as he,s as z,a as v,b as H,c as L,e as ge,f as be,g as W,h as Se,i as we,j as Ae,k as J,l as Ce}from"./primeicons-BjELKfwS.js";import{d as n,p as Xe,q as ke,s as Y,x,y as P,z as ee,o as r,e as m,a as i,f as S,g as f,t as d,b as o,w as c,u as a,F,h as U,c as D,Q as Ie}from"./app-B2uDyFGt.js";import{s as te}from"./index-uF88HVmj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const xe={class:"card"},De={class:"m-4 my-4"},$e={key:0,class:"pi pi-calendar"},qe=i("i",{class:"pi pi-user"},null,-1),Ve=i("i",{class:"pi pi-map-marker mt-2"},null,-1),Fe=i("p",{class:"mt-6"}," Order Lines:",-1),Ue={key:0},Ze=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),Oe=i("i",{class:"pi pi-building-columns"},null,-1),je=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),Re=i("i",{class:"pi pi-building"},null,-1),Ne=i("p",{class:"mb-2 text-xl font-bold"},"States",-1),Ee=["for"],Le=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Category",-1),Pe=["for"],Be=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),Te=["for"],Me=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),Qe={class:"flex justify-between"},Ge=i("i",{class:"pi pi-search"},null,-1),Ke=["onClick"],ze={class:"flex"},He={key:0,class:"flex align-items-center"},We={key:0},Je={key:1},Ye={key:1},et={class:"flex align-items-center"},tt={class:"flex"},lt={key:0,class:"flex align-items-center"},at={key:0},ot={key:1},st={key:1},it={class:"flex align-items-center"},nt={__name:"ConfirmDeliveryRequirementDataTable",props:{filterSubs:Object,stateIds:Object,filterSubIds:Object,currentUser:Object,users:Object},setup(_){let y=_;const Z=n([]);n();const w=n(!0),g=n(1),$=n(0),O=n(),j=n(!1),R=n(!1),le=n(),N=n([]),b=Xe(),E=n([]),q=n(),B=n(),T=n(),M=n(),ae=n([]);n();const oe=n([{id:1,name:"Subscription"}]),se=n([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),ie=n([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),h=n([]),V=n(),A=n([]),C=n([]),X=n([]);ke(()=>{w.value=!1,$.value=y.filterSubs.total,le.value=y.salesQuotations,E.value=y.stateIds});const ne=t=>{g.value=t.page+1,console.log("page change"),console.log(g.value),k()},re=t=>{O.value=t.target.value,console.log(t.target.value),de()},k=async()=>{try{console.log("fetch data page"),console.log(g.value);const t=await Y.get("/confirmDeliveryRequirement",{page:g.value,search:O.value,dates:h.value,stateId:A.value,activitySummary:C.value,categories:X.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),$.value=l.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{w.value=!1}},de=he(async()=>{try{console.log("fetch data page"),console.log(g.value);const t=await Y.get("/confirmDeliveryRequirement",{page:g.value,search:O.value,dates:h.value,stateId:A.value,activitySummary:C.value,categories:X.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),$.value=l.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{w.value=!1}},300),Q=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,ce=t=>{if(!t||t.length===0)return"";const l=new Date(t[0]),u=t[1]?new Date(t[1]):l;return`${l.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${u.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},ue=()=>{initFilters()},me=t=>{j.value=!0,q.value=t.sales_order_no,B.value=t.order_line,T.value=t.customer_name,M.value=t.address,ae.value=t.contact_address,V.value=t},ve=t=>{q.value=t.sales_order_no,console.log("Select clicked",event)},_e=async t=>{var l;try{const u=await P.put(`/api/updateCreatedOnOdooInFilterSubs/${t.id}`,{created_on_odoo:t.created_on_odoo.value,odoo_created_by_id:y.currentUser.id});(l=t.created_on_odoo)!=null&&l.value?b.add({severity:"success",summary:`Updated #${t.sales_order_no}'s created on odoo to ${t.created_on_odoo.value}`,detail:"",life:3e3}):b.add({severity:"info",summary:`Moved #${t.sales_order_no} back to Subscription to Enter`,detail:"",life:3e3})}catch(u){console.error("Failed to update created_on_odoo:",u),b.add({severity:"error",summary:"Failed to update",detail:"",life:3e3})}},fe=async t=>{var l,u;try{const p=await P.put(`/api/updateRequiredDeliveryInFilterSubs/${t.id}`,{required_delivery:t.required_delivery.value,required_delivery_updated_by_id:y.currentUser.id});(l=t.required_delivery)!=null&&l.value&&(((u=t.required_delivery)==null?void 0:u.value)==="Confirm"?b.add({severity:"success",summary:`Added #${t.sales_order_no} to Subscriptions to Deliver`,detail:"",life:3e3}):b.add({severity:"success",summary:`Updated #${t.sales_order_no} required delivery to Denied`,detail:"",life:3e3}))}catch(p){console.error("Failed to update created_on_odoo:",p),b.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};x(q,async t=>{if(t)try{const l=await P.get("/api/findSalesOrdersBySalesOrderNo",{params:{sales_order_no:t}});console.log("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZZZZZZZZZZZZZZZZZZZZZ"),console.log(l),console.log("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"),N.value=l.data.map(u=>({name:u.sales_order_no,value:u.sales_order_no})),N.value.push({name:"- Unselect -",value:null})}catch(l){console.error("Error fetching dropdown options:",l)}}),x(A,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),k())}),x(C,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),k())}),x(h,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),k())}),x(X,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),k())});const pe=t=>t.filter(l=>{var u;return l.created_on_odoo!==null&&((u=l.created_on_odoo)==null?void 0:u.value)!==null}),G=t=>t.filter(l=>{var u;return l.created_on_odoo===null||((u=l.created_on_odoo)==null?void 0:u.value)===null||l.created_on_odoo===void 0}).length,K=(t,l)=>{const u=l.find(p=>p.id===t);if(u){const p=u.name.split(" ").map(s=>s[0]).join("").toUpperCase();return p.substring(0,2)||p}return""};return(t,l)=>{const u=ee("Toast"),p=ee("font-awesome-icon");return r(),m("div",xe,[i("div",null,[i("div",De,[h.value.length?(r(),m("i",$e)):S("",!0),f(" "+d(ce(h.value)),1)])]),o(u),o(a(H),{visible:j.value,"onUpdate:visible":l[0]||(l[0]=e=>j.value=e),header:q.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[i("p",null,[qe,f(" "+d(T.value),1)]),i("p",null,[Ve,f(" "+d(M.value),1)]),Fe,o(a(z),{value:B.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:c(()=>[o(a(v),{field:"product",header:"Product",style:{"min-width":"10rem"}}),o(a(v),{field:"description",header:"Description",style:{"min-width":"10rem"}}),o(a(v),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),i("div",null,[V.value.contact_address[0].parent?(r(),m("p",Ue,[Ze,Oe,f(" "+d(V.value.contact_address[0].parent.complete_address),1)])):S("",!0)]),i("div",null,[(r(!0),m(F,null,U(V.value.contact_address[0].children,(e,s)=>(r(),m("p",{key:s},[je,Re,f(" "+d(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),o(a(H),{visible:R.value,"onUpdate:visible":l[5]||(l[5]=e=>R.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[Ne,(r(!0),m(F,null,U(E.value,e=>(r(),m("div",{key:e.id,class:"flex items-center mb-2"},[o(a(L),{modelValue:A.value,"onUpdate:modelValue":l[1]||(l[1]=s=>A.value=s),inputId:e.state_id,name:"stateIds",value:e.state_id},null,8,["modelValue","inputId","value"]),i("label",{for:e.id,class:"ml-2"},d(e.name),9,Ee)]))),128)),Le,(r(!0),m(F,null,U(oe.value,e=>(r(),m("div",{key:e.id,class:"flex items-center mb-2"},[o(a(L),{modelValue:X.value,"onUpdate:modelValue":l[2]||(l[2]=s=>X.value=s),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),i("label",{for:e.id,class:"ml-2"},d(e.name),9,Pe)]))),128)),Be,(r(!0),m(F,null,U(se.value,e=>(r(),m("div",{key:e.id,class:"flex items-center mb-2"},[o(a(L),{modelValue:C.value,"onUpdate:modelValue":l[3]||(l[3]=s=>C.value=s),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),i("label",{for:e.id,class:"ml-2"},d(e.name),9,Te)]))),128)),Me,o(a(ge),{modelValue:h.value,"onUpdate:modelValue":l[4]||(l[4]=e=>h.value=e),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),o(a(be),{rows:100,totalRecords:$.value,rowsPerPageOptions:[10,25,50,100],onPage:ne},{start:c(e=>[f(d(_.filterSubs.from)+"-"+d(_.filterSubs.to-G(_.filterSubs.data))+" / "+d(_.filterSubs.total-G(_.filterSubs.data)),1)]),_:1},8,["totalRecords"]),o(a(z),{selection:Z.value,"onUpdate:selection":l[8]||(l[8]=e=>Z.value=e),value:pe(_.filterSubs.data),lazy:"",loading:w.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:c(()=>[i("div",Qe,[o(a(W),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:l[6]||(l[6]=e=>ue())}),o(a(Se),null,{default:c(()=>[o(a(we),null,{default:c(()=>[Ge]),_:1}),i("div",null,[o(a(W),{onClick:l[7]||(l[7]=e=>R.value=!0),label:"Filter",class:"mr-4"}),o(a(Ae),{placeholder:"Keyword Search",onInput:re})])]),_:1})])]),empty:c(()=>[f(" No filterSubs found. ")]),loading:c(()=>[f(" Loading filterSubs data. Please wait. ")]),default:c(()=>[o(a(v),{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(a(v),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:c(({data:e})=>[i("span",{onClick:s=>me(e),class:"cursor-pointer hover:underline"},d(e.sales_order_no),9,Ke),e.category==="Subscription"?(r(),D(p,{key:0,icon:"fa-filter-circle-dollar",class:"ml-2"})):S("",!0)]),_:1}),o(a(v),{field:"",header:"Created on Odoo",style:{"min-width":"10rem"}},{body:c(({data:e})=>[i("div",ze,[o(a(J),{modelValue:e.created_on_odoo,"onUpdate:modelValue":s=>e.created_on_odoo=s,options:N.value,filter:"",optionLabel:"name",placeholder:"Select Sales Order #",class:"w-full md:w-14rem",onClick:s=>ve(e),onChange:s=>_e(e)},{value:c(s=>{var I;return[s.value?(r(),m("div",He,[e.created_on_odoo&&e.created_on_odoo.value!==null?(r(),m("div",We,d(((I=e.created_on_odoo)==null?void 0:I.name)||e.created_on_odoo),1)):(r(),m("div",Je,d(s.placeholder),1))])):(r(),m("span",Ye,d(s.placeholder),1))]}),option:c(s=>[i("div",et,[i("div",null,d(s.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onClick","onChange"]),e.odoo_created_by_id?(r(),D(a(te),{key:0,label:K(e.odoo_created_by_id,_.users),class:"ml-2",style:{"background-color":"#dee9fc",color:"#1a2551"}},null,8,["label"])):S("",!0)])]),_:1}),o(a(v),{field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:c(({data:e})=>[i("div",tt,[o(a(J),{modelValue:e.required_delivery,"onUpdate:modelValue":s=>e.required_delivery=s,options:ie.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:s=>fe(e)},{value:c(s=>{var I;return[s.value?(r(),m("div",lt,[e.required_delivery&&e.required_delivery.value!==null?(r(),m("div",at,d(((I=e.required_delivery)==null?void 0:I.name)||e.required_delivery),1)):(r(),m("div",ot,d(s.placeholder),1))])):(r(),m("span",st,d(s.placeholder),1))]}),option:c(s=>[i("div",it,[i("div",null,d(s.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),e.required_delivery_updated_by_id?(r(),D(a(te),{key:0,label:K(e.required_delivery_updated_by_id,_.users),class:"ml-2",style:{"background-color":"#dee9fc",color:"#1a2551"}},null,8,["label"])):S("",!0)])]),_:1}),o(a(v),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),o(a(v),{field:"address",header:"Address",style:{"min-width":"10rem"}}),o(a(v),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),o(a(v),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:c(({data:e})=>[f(d(Q(e.due_date)),1)]),_:1}),o(a(v),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),o(a(v),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:c(({data:e})=>[f(d(Q(e.invoice_date)),1)]),_:1}),o(a(v),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:c(({data:e})=>{var s;return[f(d((s=E.value[e.state_id-1])==null?void 0:s.name),1)]}),_:1}),o(a(v),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),o(a(v),{field:"email",header:"Email",style:{"min-width":"10rem"}}),o(a(v),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:c(({data:e})=>[e.payment_status==="paid"?(r(),D(a(Ce),{key:0,severity:"success",value:"Paid"})):S("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},rt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},_t={__name:"ConfirmDeliveryRequirement",props:{filterSubs:Object,stateIds:Object,activitySummaries:Object,filterSubIds:Object,users:Object},setup(_){const y=Ie();return(Z,w)=>(r(),D(ye,{title:"ConfirmDeliveryRequirement"},{default:c(()=>[i("div",rt,[o(nt,{filterSubs:_.filterSubs,stateIds:_.stateIds,activitySummaries:_.activitySummaries,filterSubIds:_.filterSubIds,currentUser:a(y).props.auth.user,users:_.users},null,8,["filterSubs","stateIds","activitySummaries","filterSubIds","currentUser","users"])])]),_:1}))}};export{_t as default};
