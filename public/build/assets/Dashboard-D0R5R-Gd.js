import{_ as ve}from"./AppLayout-CUUPClWN.js";import{d as pe,s as q,a as m,b as z,c as L,e as _e,g as fe,f as H,h as he,i as ye,j as ge,k as be,l as Se}from"./primeicons-DLkXWPVG.js";import{y as we,d as n,z as Ce,A as ke,C as W,D as I,E as J,G as X,o as r,e as u,a as o,g as p,t as d,f as b,b as l,w as c,u as s,F as U,h as P,c as T,Q as Ie}from"./app-pw3lNDCF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const De={class:"card"},xe={class:"m-4 my-4"},$e={key:0},Fe=o("i",{class:"pi pi-calendar"},null,-1),Ve={key:1},Ue=o("i",{class:"pi pi-map-marker"},null,-1),Pe=o("i",{class:"pi pi-user"},null,-1),Oe=o("i",{class:"pi pi-map-marker mt-2"},null,-1),je=o("p",{class:"mt-6"}," Order Lines:",-1),Ee={key:0},Ae=o("p",{class:"mt-6 mb-2"}," Other Address:",-1),Ne=o("i",{class:"pi pi-building-columns"},null,-1),Be=o("p",{class:"mt-6 mb-2"}," Other Address:",-1),Le=o("i",{class:"pi pi-building"},null,-1),Te=o("p",{class:"mb-2 text-xl font-bold"},"States",-1),Re=["for"],Ge=o("p",{class:"mt-4 mb-2 text-xl font-bold"},"Category",-1),Me=["for"],Qe=o("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),Ke=["for"],qe=o("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),ze={class:"flex justify-between"},He=o("i",{class:"pi pi-search"},null,-1),We=["onClick"],Je={key:1,class:"pi pi-truck ml-2"},Xe={key:0,class:"flex align-items-center"},Ye={key:0},Ze={key:1},et={key:1},tt={class:"flex align-items-center"},at={__name:"SubsToEnterDataTable",props:{currentUser:Object,filterSubs:Object,filterSubIds:Object,stateIds:Object},setup(_){we();let y=_;const O=n([]),S=n(!0),g=n(1),D=n(0),j=n(),E=n(!1),A=n(!1),Y=n(),N=n([]),B=Ce(),x=n([]),$=n(),R=n(),G=n(),M=n(),Z=n([]),ee=n([{id:1,name:"Subscription"}]),te=n([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]);n([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]);const f=n([]),F=n(),h=n([]),w=n([]),C=n([]),V=n(100);ke(()=>{S.value=!1,D.value=y.filterSubs.total,Y.value=y.salesQuotations,x.value=y.stateIds});const ae=t=>{V.value=t.rows,g.value=t.page+1,console.log("page change"),console.log(g.value),k()},le=t=>{j.value=t.target.value,console.log(t.target.value),se()},k=async()=>{try{console.log("fetch data page"),console.log(g.value);const t=W.get("/dashboard",{page:g.value,search:j.value,dates:f.value,stateId:h.value,activitySummary:w.value,categories:C.value,perPage:V.value},{preserveState:!0,replace:!1,onSuccess:a=>{console.log(a),console.log(a.props.filterSubs.total),D.value=a.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{S.value=!1}},se=pe(async()=>{try{console.log("fetch data page"),console.log(g.value);const t=await W.get("/dashboard",{page:g.value,search:j.value,dates:f.value,stateId:h.value,activitySummary:w.value,categories:C.value,perPage:V.value},{preserveState:!0,replace:!1,onSuccess:a=>{console.log(a),console.log(a.props.filterSubs.total),D.value=a.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{S.value=!1}},300),Q=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,oe=t=>{if(!t||t.length===0)return"";const a=new Date(t[0]),v=t[1]?new Date(t[1]):a;return`${a.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${v.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},ne=t=>t.map(a=>{var v;return(v=x.value[a-1])==null?void 0:v.code}).join(", "),ie=()=>{initFilters()},de=t=>{E.value=!0,$.value=t.sales_order_no,R.value=t.order_line,G.value=t.customer_name,M.value=t.address,Z.value=t.contact_address,F.value=t},re=t=>{$.value=t.sales_order_no},ce=async t=>{var a;try{if((a=t.created_on_odoo)!=null&&a.value){console.log(t);const v=await J.post("/api/createDeliverSub",{filter_sub_id:t.id,created_on_odoo:t.created_on_odoo.value,odoo_created_by_id:y.currentUser.id,due_date:t.due_date.value});B.add({severity:"success",summary:`Moved #${t.sales_order_no} to Confirm Delivery Requirement`,detail:"",life:3e3})}}catch(v){console.error("Failed to update created_on_odoo:",v),v.response.data.error?B.add({severity:"error",summary:v.response.data.error,detail:"",life:3e3}):B.add({severity:"error",summary:"Failed to update created on odoo",detail:"",life:3e3})}};I($,async t=>{if(t)try{const a=await J.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:t}});N.value=a.data.map(v=>({name:v,value:v})),N.value.push({name:"- Unselect -",value:null})}catch(a){console.error("Error fetching dropdown options:",a)}}),I(h,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),k())}),I(w,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),k())}),I(f,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),k())}),I(C,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),k())});const ue=t=>t;return(t,a)=>{const v=X("Toast"),me=X("font-awesome-icon");return r(),u("div",De,[o("div",null,[o("div",xe,[f.value.length?(r(),u("div",$e,[Fe,p(" "+d(oe(f.value)),1)])):b("",!0),h.value.length?(r(),u("div",Ve,[Ue,p(" "+d(ne(h.value)),1)])):b("",!0)])]),l(v),l(s(z),{visible:E.value,"onUpdate:visible":a[0]||(a[0]=e=>E.value=e),header:$.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[o("p",null,[Pe,p(" "+d(G.value),1)]),o("p",null,[Oe,p(" "+d(M.value),1)]),je,l(s(q),{value:R.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:c(()=>[l(s(m),{field:"product",header:"Product",style:{"min-width":"10rem"}}),l(s(m),{field:"description",header:"Description",style:{"min-width":"10rem"}}),l(s(m),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),o("div",null,[F.value.contact_address[0].parent?(r(),u("p",Ee,[Ae,Ne,p(" "+d(F.value.contact_address[0].parent.complete_address),1)])):b("",!0)]),o("div",null,[(r(!0),u(U,null,P(F.value.contact_address[0].children,(e,i)=>(r(),u("p",{key:i},[Be,Le,p(" "+d(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),l(s(z),{visible:A.value,"onUpdate:visible":a[5]||(a[5]=e=>A.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[Te,(r(!0),u(U,null,P(x.value,e=>(r(),u("div",{key:e.id,class:"flex items-center mb-2"},[l(s(L),{modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=i=>h.value=i),inputId:e.state_id,name:"stateIds",value:e.state_id},null,8,["modelValue","inputId","value"]),o("label",{for:e.id,class:"ml-2"},d(e.name),9,Re)]))),128)),Ge,(r(!0),u(U,null,P(ee.value,e=>(r(),u("div",{key:e.id,class:"flex items-center mb-2"},[l(s(L),{modelValue:C.value,"onUpdate:modelValue":a[2]||(a[2]=i=>C.value=i),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),o("label",{for:e.id,class:"ml-2"},d(e.name),9,Me)]))),128)),Qe,(r(!0),u(U,null,P(te.value,e=>(r(),u("div",{key:e.id,class:"flex items-center mb-2"},[l(s(L),{modelValue:w.value,"onUpdate:modelValue":a[3]||(a[3]=i=>w.value=i),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),o("label",{for:e.id,class:"ml-2"},d(e.name),9,Ke)]))),128)),qe,l(s(_e),{modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=e=>f.value=e),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),l(s(fe),{rows:V.value,totalRecords:D.value,rowsPerPageOptions:[10,25,50,100],onPage:ae},{start:c(e=>[p(d(_.filterSubs.from)+"-"+d(_.filterSubs.to)+" / "+d(_.filterSubs.total),1)]),_:1},8,["rows","totalRecords"]),l(s(q),{selection:O.value,"onUpdate:selection":a[8]||(a[8]=e=>O.value=e),value:ue(_.filterSubs.data),lazy:"",loading:S.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:c(()=>[o("div",ze,[l(s(H),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:a[6]||(a[6]=e=>ie())}),l(s(he),null,{default:c(()=>[l(s(ye),null,{default:c(()=>[He]),_:1}),o("div",null,[l(s(H),{onClick:a[7]||(a[7]=e=>A.value=!0),label:"Filter",class:"mr-4"}),l(s(ge),{placeholder:"Keyword Search",onInput:le})])]),_:1})])]),empty:c(()=>[p(" No filterSubs found. ")]),loading:c(()=>[p(" Loading filterSubs data. Please wait. ")]),default:c(()=>[l(s(m),{selectionMode:"multiple",headerStyle:"width: 3rem"}),l(s(m),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:c(({data:e})=>[o("span",{onClick:i=>de(e),class:"cursor-pointer hover:underline"},d(e.sales_order_no),9,We),e.category==="Subscription"?(r(),T(me,{key:0,icon:"fa-filter-circle-dollar",class:"ml-2"})):b("",!0),e.delivered_or_delivery_booked&&e.delivered_or_delivery_booked.value!==null?(r(),u("i",Je)):b("",!0)]),_:1}),l(s(m),{field:"",header:"Created on Odoo",style:{"min-width":"10rem"}},{body:c(({data:e})=>[l(s(be),{modelValue:e.created_on_odoo,"onUpdate:modelValue":i=>e.created_on_odoo=i,options:N.value,filter:"",optionLabel:"name",placeholder:"Select Sales Order #",class:"w-full md:w-14rem",onClick:i=>re(e),onChange:i=>ce(e)},{value:c(i=>{var K;return[i.value?(r(),u("div",Xe,[e.created_on_odoo&&e.created_on_odoo.value!==null?(r(),u("div",Ye,d(((K=e.created_on_odoo)==null?void 0:K.name)||e.created_on_odoo),1)):(r(),u("div",Ze,d(i.placeholder),1))])):(r(),u("span",et,d(i.placeholder),1))]}),option:c(i=>[o("div",tt,[o("div",null,d(i.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onClick","onChange"])]),_:1}),l(s(m),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),l(s(m),{field:"address",header:"Address",style:{"min-width":"10rem"}}),l(s(m),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),l(s(m),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:c(({data:e})=>[p(d(Q(e.due_date)),1)]),_:1}),l(s(m),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),l(s(m),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:c(({data:e})=>[p(d(Q(e.invoice_date)),1)]),_:1}),l(s(m),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:c(({data:e})=>{var i;return[p(d((i=x.value[e.state_id-1])==null?void 0:i.name),1)]}),_:1}),l(s(m),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),l(s(m),{field:"email",header:"Email",style:{"min-width":"10rem"}}),l(s(m),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:c(({data:e})=>[e.payment_status==="paid"?(r(),T(s(Se),{key:0,severity:"success",value:"Paid"})):b("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},lt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},dt={__name:"Dashboard",props:{filterSubs:Object,stateIds:Object,activitySummaries:Object,filterSubIds:Object},setup(_){const y=Ie();return(O,S)=>(r(),T(ve,{title:"Dashboard"},{default:c(()=>[o("div",lt,[l(at,{filterSubs:_.filterSubs,stateIds:_.stateIds,activitySummaries:_.activitySummaries,filterSubIds:_.filterSubIds,currentUser:s(y).props.auth.user},null,8,["filterSubs","stateIds","activitySummaries","filterSubIds","currentUser"])])]),_:1}))}};export{dt as default};
