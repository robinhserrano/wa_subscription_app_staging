import{_ as ke}from"./AppLayout-CP5cg5Fm.js";import{d as Ce,s as Z,a as v,b as ee,c as q,e as xe,f as z,g as De,h as Ie,i as $e,j as Fe,k as Ve,l as Oe}from"./primeicons-CIvCBJdi.js";import{y as Ue,d as n,z as Ae,A as je,C as te,D as U,E as ae,G as se,o as r,e as m,a as l,g as p,t as d,f as w,b as o,w as c,u as s,F as B,h as L,c as R,Q as Ee}from"./app-BWH7wEES.js";import{u as H,w as Ne}from"./xlsx-YQvpTstd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Pe={class:"card"},Be={class:"m-4 my-4"},Le={key:0},Re=l("i",{class:"pi pi-calendar"},null,-1),Te={key:1},Ge=l("i",{class:"pi pi-map-marker"},null,-1),Me=l("i",{class:"pi pi-user"},null,-1),Qe=l("i",{class:"pi pi-map-marker mt-2"},null,-1),Ke=l("p",{class:"mt-6"}," Order Lines:",-1),qe={key:0},ze=l("p",{class:"mt-6 mb-2"}," Other Address:",-1),He=l("i",{class:"pi pi-building-columns"},null,-1),We=l("p",{class:"mt-6 mb-2"}," Other Address:",-1),Je=l("i",{class:"pi pi-building"},null,-1),Xe=l("p",{class:"mb-2 text-xl font-bold"},"States",-1),Ye=["for"],Ze=l("p",{class:"mt-4 mb-2 text-xl font-bold"},"Category",-1),et=["for"],tt=l("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),at=["for"],st=l("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),ot={class:"flex justify-between"},lt=l("i",{class:"pi pi-search"},null,-1),nt=["onClick"],it={key:1,class:"pi pi-truck ml-2"},rt={key:0,class:"flex align-items-center"},dt={key:0},ct={key:1},ut={key:1},mt={class:"flex align-items-center"},vt={__name:"SubsToEnterDataTable",props:{currentUser:Object,filterSubs:Object,filterSubIds:Object,stateIds:Object},setup(_){Ue();let k=_;const x=n([]),D=n(!0),C=n(1),A=n(0),T=n(),G=n(!1),M=n(!1),oe=n(),Q=n([]),K=Ae(),I=n([]),j=n(),W=n(),J=n(),X=n(),le=n([]),ne=n([{id:1,name:"Subscription"}]),ie=n([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]);n([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]);const b=n([]),E=n(),g=n([]),$=n([]),F=n([]),N=n(100);je(()=>{D.value=!1,A.value=k.filterSubs.total,oe.value=k.salesQuotations,I.value=k.stateIds});const re=e=>{N.value=e.rows,C.value=e.page+1,console.log("page change"),console.log(C.value),V()},de=e=>{T.value=e.target.value,console.log(e.target.value),ce()},V=async()=>{try{console.log("fetch data page"),console.log(C.value);const e=te.get("/dashboard",{page:C.value,search:T.value,dates:b.value,stateId:g.value,activitySummary:$.value,categories:F.value,perPage:N.value},{preserveState:!0,replace:!1,onSuccess:a=>{console.log(a),console.log(a.props.filterSubs.total),A.value=a.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{D.value=!1}},ce=Ce(async()=>{try{console.log("fetch data page"),console.log(C.value);const e=await te.get("/dashboard",{page:C.value,search:T.value,dates:b.value,stateId:g.value,activitySummary:$.value,categories:F.value,perPage:N.value},{preserveState:!0,replace:!1,onSuccess:a=>{console.log(a),console.log(a.props.filterSubs.total),A.value=a.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{D.value=!1}},300),Y=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,ue=e=>{if(!e||e.length===0)return"";const a=new Date(e[0]),u=e[1]?new Date(e[1]):a;return`${a.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${u.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},me=e=>e.map(a=>{var u;return(u=I.value[a-1])==null?void 0:u.code}).join(", "),ve=()=>{initFilters()},pe=e=>{G.value=!0,j.value=e.sales_order_no,W.value=e.order_line,J.value=e.customer_name,X.value=e.address,le.value=e.contact_address,E.value=e},_e=e=>{j.value=e.sales_order_no},fe=async e=>{var a;try{if((a=e.created_on_odoo)!=null&&a.value){console.log(e);const u=await ae.post("/api/createDeliverSub",{filter_sub_id:e.id,created_on_odoo:e.created_on_odoo.value,odoo_created_by_id:k.currentUser.id,due_date:e.due_date.value});K.add({severity:"success",summary:`Moved #${e.sales_order_no} to Confirm Delivery Requirement`,detail:"",life:3e3})}}catch(u){console.error("Failed to update created_on_odoo:",u),u.response.data.error?K.add({severity:"error",summary:u.response.data.error,detail:"",life:3e3}):K.add({severity:"error",summary:"Failed to update created on odoo",detail:"",life:3e3})}};U(j,async e=>{if(e)try{const a=await ae.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:e}});Q.value=a.data.map(u=>({name:u,value:u})),Q.value.push({name:"- Unselect -",value:null})}catch(a){console.error("Error fetching dropdown options:",a)}}),U(g,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),V())}),U($,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),V())}),U(b,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),V())}),U(F,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),V())});const he=e=>e,ye=e=>{const a={"Invoice Number":"invoice_number","Sales Order":"sales_order_no","Customer Name":"customer_name","Invoice Date":"invoice_date","Payment Status":"payment_status",Address:"address",State:"state_id","Activity Summary":"activity_summary","Phone Number":"phone",Email:"email","Due Date":"due_date","Created on Odoo":"created_on_odoo"},h=x.value.map(f=>{var y;f.state_id=(y=e[f.state_id-1])==null?void 0:y.name;let S={};for(const[Se,we]of Object.entries(a))S[Se]=f[we];return S}).reduce((f,S)=>{const y=S.State;return f[y]||(f[y]=[]),f[y].push(S),f},{}),t=H.book_new();for(const[f,S]of Object.entries(h)){const y=H.json_to_sheet(S);H.book_append_sheet(t,y,f)}const i=Ne(t,{bookType:"xlsx",type:"binary"}),P=new Blob([be(i)],{type:"application/octet-stream"}),ge=URL.createObjectURL(P),O=document.createElement("a");O.href=ge,O.setAttribute("download","subs_to_enter.xlsx"),document.body.appendChild(O),O.click(),document.body.removeChild(O)};function be(e){const a=new ArrayBuffer(e.length),u=new Uint8Array(a);for(let h=0;h<e.length;h++)u[h]=e.charCodeAt(h)&255;return a}return(e,a)=>{const u=se("Toast"),h=se("font-awesome-icon");return r(),m("div",Pe,[l("div",null,[l("div",Be,[b.value.length?(r(),m("div",Le,[Re,p(" "+d(ue(b.value)),1)])):w("",!0),g.value.length?(r(),m("div",Te,[Ge,p(" "+d(me(g.value)),1)])):w("",!0)])]),o(u),o(s(ee),{visible:G.value,"onUpdate:visible":a[0]||(a[0]=t=>G.value=t),header:j.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[l("p",null,[Me,p(" "+d(J.value),1)]),l("p",null,[Qe,p(" "+d(X.value),1)]),Ke,o(s(Z),{value:W.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:c(()=>[o(s(v),{field:"product",header:"Product",style:{"min-width":"10rem"}}),o(s(v),{field:"description",header:"Description",style:{"min-width":"10rem"}}),o(s(v),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),l("div",null,[E.value.contact_address[0].parent?(r(),m("p",qe,[ze,He,p(" "+d(E.value.contact_address[0].parent.complete_address),1)])):w("",!0)]),l("div",null,[(r(!0),m(B,null,L(E.value.contact_address[0].children,(t,i)=>(r(),m("p",{key:i},[We,Je,p(" "+d(t.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),o(s(ee),{visible:M.value,"onUpdate:visible":a[5]||(a[5]=t=>M.value=t),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[Xe,(r(!0),m(B,null,L(I.value,t=>(r(),m("div",{key:t.id,class:"flex items-center mb-2"},[o(s(q),{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=i=>g.value=i),inputId:t.state_id,name:"stateIds",value:t.state_id},null,8,["modelValue","inputId","value"]),l("label",{for:t.id,class:"ml-2"},d(t.name),9,Ye)]))),128)),Ze,(r(!0),m(B,null,L(ne.value,t=>(r(),m("div",{key:t.id,class:"flex items-center mb-2"},[o(s(q),{modelValue:F.value,"onUpdate:modelValue":a[2]||(a[2]=i=>F.value=i),inputId:t.name,name:"category",value:t.name},null,8,["modelValue","inputId","value"]),l("label",{for:t.id,class:"ml-2"},d(t.name),9,et)]))),128)),tt,(r(!0),m(B,null,L(ie.value,t=>(r(),m("div",{key:t.id,class:"flex items-center mb-2"},[o(s(q),{modelValue:$.value,"onUpdate:modelValue":a[3]||(a[3]=i=>$.value=i),inputId:t.name,name:"category",value:t.name},null,8,["modelValue","inputId","value"]),l("label",{for:t.id,class:"ml-2"},d(t.name),9,at)]))),128)),st,o(s(xe),{modelValue:b.value,"onUpdate:modelValue":a[4]||(a[4]=t=>b.value=t),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),x.value.length?(r(),R(s(z),{key:0,label:"Export as Excel",onClick:a[6]||(a[6]=t=>ye(I.value)),class:"ml-4"})):w("",!0),o(s(De),{rows:N.value,totalRecords:A.value,rowsPerPageOptions:[10,25,50,100],onPage:re},{start:c(t=>[p(d(_.filterSubs.from)+"-"+d(_.filterSubs.to)+" / "+d(_.filterSubs.total),1)]),_:1},8,["rows","totalRecords"]),o(s(Z),{selection:x.value,"onUpdate:selection":a[9]||(a[9]=t=>x.value=t),value:he(_.filterSubs.data),lazy:"",loading:D.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:c(()=>[l("div",ot,[o(s(z),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:a[7]||(a[7]=t=>ve())}),o(s(Ie),null,{default:c(()=>[o(s($e),null,{default:c(()=>[lt]),_:1}),l("div",null,[o(s(z),{onClick:a[8]||(a[8]=t=>M.value=!0),label:"Filter",class:"mr-4"}),o(s(Fe),{placeholder:"Keyword Search",onInput:de})])]),_:1})])]),empty:c(()=>[p(" No filterSubs found. ")]),loading:c(()=>[p(" Loading filterSubs data. Please wait. ")]),default:c(()=>[o(s(v),{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(s(v),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:c(({data:t})=>[l("span",{onClick:i=>pe(t),class:"cursor-pointer hover:underline"},d(t.sales_order_no),9,nt),t.category==="Subscription"?(r(),R(h,{key:0,icon:"fa-filter-circle-dollar",class:"ml-2"})):w("",!0),t.delivered_or_delivery_booked&&t.delivered_or_delivery_booked.value!==null?(r(),m("i",it)):w("",!0)]),_:1}),o(s(v),{field:"",header:"Created on Odoo",style:{"min-width":"10rem"}},{body:c(({data:t})=>[o(s(Ve),{modelValue:t.created_on_odoo,"onUpdate:modelValue":i=>t.created_on_odoo=i,options:Q.value,filter:"",optionLabel:"name",placeholder:"Select Sales Order #",class:"w-full md:w-14rem",onClick:i=>_e(t),onChange:i=>fe(t)},{value:c(i=>{var P;return[i.value?(r(),m("div",rt,[t.created_on_odoo&&t.created_on_odoo.value!==null?(r(),m("div",dt,d(((P=t.created_on_odoo)==null?void 0:P.name)||t.created_on_odoo),1)):(r(),m("div",ct,d(i.placeholder),1))])):(r(),m("span",ut,d(i.placeholder),1))]}),option:c(i=>[l("div",mt,[l("div",null,d(i.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onClick","onChange"])]),_:1}),o(s(v),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),o(s(v),{field:"address",header:"Address",style:{"min-width":"10rem"}}),o(s(v),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),o(s(v),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:c(({data:t})=>[p(d(Y(t.due_date)),1)]),_:1}),o(s(v),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),o(s(v),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:c(({data:t})=>[p(d(Y(t.invoice_date)),1)]),_:1}),o(s(v),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:c(({data:t})=>{var i;return[p(d((i=I.value[t.state_id-1])==null?void 0:i.name),1)]}),_:1}),o(s(v),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),o(s(v),{field:"email",header:"Email",style:{"min-width":"10rem"}}),o(s(v),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:c(({data:t})=>[t.payment_status==="paid"?(r(),R(s(Oe),{key:0,severity:"success",value:"Paid"})):w("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},pt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},gt={__name:"Dashboard",props:{filterSubs:Object,stateIds:Object,activitySummaries:Object,filterSubIds:Object},setup(_){const k=Ee();return(x,D)=>(r(),R(ke,{title:"Dashboard"},{default:c(()=>[l("div",pt,[o(vt,{filterSubs:_.filterSubs,stateIds:_.stateIds,activitySummaries:_.activitySummaries,filterSubIds:_.filterSubIds,currentUser:s(k).props.auth.user},null,8,["filterSubs","stateIds","activitySummaries","filterSubIds","currentUser"])])]),_:1}))}};export{gt as default};
