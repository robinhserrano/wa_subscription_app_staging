import{_ as fe}from"./AppLayout-Dnh158Yn.js";import{d as pe,s as Q,a as v,b as z,c as j,e as he,f as ye,g as H,h as ge,i as be,j as Se,k as W,l as we}from"./primeicons-Cc7Lkvtk.js";import{d as i,p as Ae,q as Xe,s as J,x as X,y as L,z as Y,o as r,e as u,a as n,f as V,g as f,t as d,b as a,w as c,u as o,F,h as q,c as P}from"./app-BteOlHFE.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ce={class:"card"},ke={class:"m-4 my-4"},De={key:0,class:"pi pi-calendar"},Ie=n("i",{class:"pi pi-user"},null,-1),$e=n("i",{class:"pi pi-map-marker mt-2"},null,-1),xe=n("p",{class:"mt-6"}," Order Lines:",-1),Ve={key:0},Fe=n("p",{class:"mt-6 mb-2"}," Other Address:",-1),qe=n("i",{class:"pi pi-building-columns"},null,-1),Ze=n("p",{class:"mt-6 mb-2"}," Other Address:",-1),Ue=n("i",{class:"pi pi-building"},null,-1),Re=n("p",{class:"mb-2 text-xl font-bold"},"States",-1),Ne=["for"],Oe=n("p",{class:"mt-4 mb-2 text-xl font-bold"},"Category",-1),Ee=["for"],je=n("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),Le=["for"],Pe=n("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),Be={class:"flex justify-between"},Te=n("i",{class:"pi pi-search"},null,-1),Me=["onClick"],Ge={key:0,class:"flex align-items-center"},Ke={key:0},Qe={key:1},ze={key:1},He={class:"flex align-items-center"},We={key:0,class:"flex align-items-center"},Je={key:0},Ye={key:1},et={key:1},tt={class:"flex align-items-center"},lt={__name:"ConfirmDeliveryRequirementDataTable",props:{filterSubs:Object,stateIds:Object,filterSubIds:Object},setup(_){let C=_;const Z=i([]);i();const k=i(!0),h=i(1),D=i(0),U=i(),R=i(!1),N=i(!1),ee=i(),O=i([]),y=Ae(),E=i([]),I=i(),B=i(),T=i(),M=i(),te=i([]);i();const le=i([{id:1,name:"Subscription"}]),ae=i([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),oe=i([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),p=i([]),$=i(),g=i([]),b=i([]),S=i([]);Xe(()=>{k.value=!1,D.value=C.filterSubs.total,ee.value=C.salesQuotations,E.value=C.stateIds});const se=t=>{h.value=t.page+1,console.log("page change"),console.log(h.value),w()},ne=t=>{U.value=t.target.value,console.log(t.target.value),ie()},w=async()=>{try{console.log("fetch data page"),console.log(h.value);const t=await J.get("/confirmDeliveryRequirement",{page:h.value,search:U.value,dates:p.value,stateId:g.value,activitySummary:b.value,categories:S.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),D.value=l.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{k.value=!1}},ie=pe(async()=>{try{console.log("fetch data page"),console.log(h.value);const t=await J.get("/confirmDeliveryRequirement",{page:h.value,search:U.value,dates:p.value,stateId:g.value,activitySummary:b.value,categories:S.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),D.value=l.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{k.value=!1}},300),G=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,de=t=>{if(!t||t.length===0)return"";const l=new Date(t[0]),m=t[1]?new Date(t[1]):l;return`${l.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${m.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},re=()=>{initFilters()},ce=t=>{R.value=!0,I.value=t.sales_order_no,B.value=t.order_line,T.value=t.customer_name,M.value=t.address,te.value=t.contact_address,$.value=t},ue=t=>{I.value=t.sales_order_no,console.log("Select clicked",event)},me=async t=>{var l;try{const m=await L.put(`/api/updateCreatedOnOdooInFilterSubs/${t.id}`,{created_on_odoo:t.created_on_odoo.value});(l=t.created_on_odoo)!=null&&l.value?y.add({severity:"success",summary:`Updated #${t.sales_order_no}'s created on odoo to ${t.created_on_odoo.value}`,detail:"",life:3e3}):y.add({severity:"info",summary:`Moved #${t.sales_order_no} back to Subscription to Enter`,detail:"",life:3e3})}catch(m){console.error("Failed to update created_on_odoo:",m),y.add({severity:"error",summary:"Failed to update",detail:"",life:3e3})}},ve=async t=>{var l,m;try{const x=await L.put(`/api/updateRequiredDeliveryInFilterSubs/${t.id}`,{required_delivery:t.required_delivery.value});(l=t.required_delivery)!=null&&l.value&&(((m=t.required_delivery)==null?void 0:m.value)==="Confirm"?y.add({severity:"success",summary:`Added #${t.sales_order_no} to Subscriptions to Deliver`,detail:"",life:3e3}):y.add({severity:"success",summary:`Updated #${t.sales_order_no} required delivery to Denied`,detail:"",life:3e3}))}catch(x){console.error("Failed to update created_on_odoo:",x),y.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};X(I,async t=>{if(t)try{const l=await L.get("/api/findSalesOrdersBySalesOrderNo",{params:{sales_order_no:t}});console.log("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZZZZZZZZZZZZZZZZZZZZZ"),console.log(l),console.log("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"),O.value=l.data.map(m=>({name:m.sales_order_no,value:m.sales_order_no})),O.value.push({name:"- Unselect -",value:null})}catch(l){console.error("Error fetching dropdown options:",l)}}),X(g,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),w())}),X(b,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),w())}),X(p,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),w())}),X(S,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),w())});const _e=t=>t.filter(l=>{var m;return l.created_on_odoo!==null&&((m=l.created_on_odoo)==null?void 0:m.value)!==null}),K=t=>t.filter(l=>{var m;return l.created_on_odoo===null||((m=l.created_on_odoo)==null?void 0:m.value)===null}).length;return(t,l)=>{const m=Y("Toast"),x=Y("font-awesome-icon");return r(),u("div",Ce,[n("div",null,[n("div",ke,[p.value.length?(r(),u("i",De)):V("",!0),f(" "+d(de(p.value)),1)])]),a(m),a(o(z),{visible:R.value,"onUpdate:visible":l[0]||(l[0]=e=>R.value=e),header:I.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[n("p",null,[Ie,f(" "+d(T.value),1)]),n("p",null,[$e,f(" "+d(M.value),1)]),xe,a(o(Q),{value:B.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:c(()=>[a(o(v),{field:"product",header:"Product",style:{"min-width":"10rem"}}),a(o(v),{field:"description",header:"Description",style:{"min-width":"10rem"}}),a(o(v),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),n("div",null,[$.value.contact_address[0].parent?(r(),u("p",Ve,[Fe,qe,f(" "+d($.value.contact_address[0].parent.complete_address),1)])):V("",!0)]),n("div",null,[(r(!0),u(F,null,q($.value.contact_address[0].children,(e,s)=>(r(),u("p",{key:s},[Ze,Ue,f(" "+d(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),a(o(z),{visible:N.value,"onUpdate:visible":l[5]||(l[5]=e=>N.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[Re,(r(!0),u(F,null,q(E.value,e=>(r(),u("div",{key:e.id,class:"flex items-center mb-2"},[a(o(j),{modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=s=>g.value=s),inputId:e.state_id,name:"stateIds",value:e.state_id},null,8,["modelValue","inputId","value"]),n("label",{for:e.id,class:"ml-2"},d(e.name),9,Ne)]))),128)),Oe,(r(!0),u(F,null,q(le.value,e=>(r(),u("div",{key:e.id,class:"flex items-center mb-2"},[a(o(j),{modelValue:S.value,"onUpdate:modelValue":l[2]||(l[2]=s=>S.value=s),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),n("label",{for:e.id,class:"ml-2"},d(e.name),9,Ee)]))),128)),je,(r(!0),u(F,null,q(ae.value,e=>(r(),u("div",{key:e.id,class:"flex items-center mb-2"},[a(o(j),{modelValue:b.value,"onUpdate:modelValue":l[3]||(l[3]=s=>b.value=s),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),n("label",{for:e.id,class:"ml-2"},d(e.name),9,Le)]))),128)),Pe,a(o(he),{modelValue:p.value,"onUpdate:modelValue":l[4]||(l[4]=e=>p.value=e),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),a(o(ye),{rows:100,totalRecords:D.value,rowsPerPageOptions:[10,25,50,100],onPage:se},{start:c(e=>[f(d(_.filterSubs.from)+"-"+d(_.filterSubs.to-K(_.filterSubs.data))+" / "+d(_.filterSubs.total-K(_.filterSubs.data)),1)]),_:1},8,["totalRecords"]),a(o(Q),{selection:Z.value,"onUpdate:selection":l[8]||(l[8]=e=>Z.value=e),value:_e(_.filterSubs.data),lazy:"",loading:k.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:c(()=>[n("div",Be,[a(o(H),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:l[6]||(l[6]=e=>re())}),a(o(ge),null,{default:c(()=>[a(o(be),null,{default:c(()=>[Te]),_:1}),n("div",null,[a(o(H),{onClick:l[7]||(l[7]=e=>N.value=!0),label:"Filter",class:"mr-4"}),a(o(Se),{placeholder:"Keyword Search",onInput:ne})])]),_:1})])]),empty:c(()=>[f(" No filterSubs found. ")]),loading:c(()=>[f(" Loading filterSubs data. Please wait. ")]),default:c(()=>[a(o(v),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(o(v),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:c(({data:e})=>[n("span",{onClick:s=>ce(e),class:"cursor-pointer hover:underline"},d(e.sales_order_no),9,Me),e.category==="Subscription"?(r(),P(x,{key:0,icon:"fa-filter-circle-dollar",class:"ml-2"})):V("",!0)]),_:1}),a(o(v),{field:"",header:"Created on Odoo",style:{"min-width":"10rem"}},{body:c(({data:e})=>[a(o(W),{modelValue:e.created_on_odoo,"onUpdate:modelValue":s=>e.created_on_odoo=s,options:O.value,filter:"",optionLabel:"name",placeholder:"Select Sales Order #",class:"w-full md:w-14rem",onClick:s=>ue(e),onChange:s=>me(e)},{value:c(s=>{var A;return[s.value?(r(),u("div",Ge,[e.created_on_odoo&&e.created_on_odoo.value!==null?(r(),u("div",Ke,d(((A=e.created_on_odoo)==null?void 0:A.name)||e.created_on_odoo),1)):(r(),u("div",Qe,d(s.placeholder),1))])):(r(),u("span",ze,d(s.placeholder),1))]}),option:c(s=>[n("div",He,[n("div",null,d(s.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onClick","onChange"])]),_:1}),a(o(v),{field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:c(({data:e})=>[a(o(W),{modelValue:e.required_delivery,"onUpdate:modelValue":s=>e.required_delivery=s,options:oe.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:s=>ve(e)},{value:c(s=>{var A;return[s.value?(r(),u("div",We,[e.required_delivery&&e.required_delivery.value!==null?(r(),u("div",Je,d(((A=e.required_delivery)==null?void 0:A.name)||e.required_delivery),1)):(r(),u("div",Ye,d(s.placeholder),1))])):(r(),u("span",et,d(s.placeholder),1))]}),option:c(s=>[n("div",tt,[n("div",null,d(s.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1}),a(o(v),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),a(o(v),{field:"address",header:"Address",style:{"min-width":"10rem"}}),a(o(v),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),a(o(v),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:c(({data:e})=>[f(d(G(e.due_date)),1)]),_:1}),a(o(v),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),a(o(v),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:c(({data:e})=>[f(d(G(e.invoice_date)),1)]),_:1}),a(o(v),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:c(({data:e})=>{var s;return[f(d((s=E.value[e.state_id-1])==null?void 0:s.name),1)]}),_:1}),a(o(v),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),a(o(v),{field:"email",header:"Email",style:{"min-width":"10rem"}}),a(o(v),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:c(({data:e})=>[e.payment_status==="paid"?(r(),P(o(we),{key:0,severity:"success",value:"Paid"})):V("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},at={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},dt={__name:"ConfirmDeliveryRequirement",props:{filterSubs:Object,stateIds:Object,activitySummaries:Object,filterSubIds:Object},setup(_){return(C,Z)=>(r(),P(fe,{title:"ConfirmDeliveryRequirement"},{default:c(()=>[n("div",at,[a(lt,{filterSubs:_.filterSubs,stateIds:_.stateIds,activitySummaries:_.activitySummaries,filterSubIds:_.filterSubIds},null,8,["filterSubs","stateIds","activitySummaries","filterSubIds"])])]),_:1}))}};export{dt as default};
