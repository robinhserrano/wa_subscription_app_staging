import{_ as ue}from"./AppLayout-CFFCB6mI.js";import{d as me,s as z,a as m,b as G,c as O,e as ve,f as pe,g as K,h as fe,i as he,j as _e,k as Q}from"./primeicons-C4PWyKt-.js";import{d,p as ye,q as ge,s as H,x as D,y as j,z as Xe,o as r,e as u,a as i,f as N,g as v,t as n,b as a,w as c,u as o,F as I,h as V,c as J}from"./app-DQW7rna-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ae={class:"card"},be={class:"m-4 my-4"},Se={key:0,class:"pi pi-calendar"},we=i("i",{class:"pi pi-map-marker ml-4"},null,-1),Ze=i("i",{class:"pi pi-user"},null,-1),Ce=i("i",{class:"pi pi-map-marker mt-2"},null,-1),ke=i("p",{class:"mt-6"}," Order Lines:",-1),De=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),Ie={key:0},Ve=i("i",{class:"pi pi-building-columns"},null,-1),$e=i("i",{class:"pi pi-building"},null,-1),xe=i("p",{class:"mb-2 text-xl font-bold"},"States",-1),qe=["for"],Fe=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"_ Category _",-1),Re=["for"],Ue=i("p",{class:"mb-2 text-xl font-bold"},"Activity Summary",-1),Oe=["for"],je=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),Ne={class:"flex justify-between"},Le=i("i",{class:"pi pi-search"},null,-1),Be=["onClick"],Pe={key:0,class:"flex align-items-center"},Te={key:0},Me={key:1},Ee={key:1},ze={class:"flex align-items-center"},Ge={key:0,class:"flex align-items-center"},Ke={key:0},Qe={key:1},He={key:1},Je={class:"flex align-items-center"},We={__name:"ConfirmDeliveryRequirementDataTable",props:{filterSubs:Object,stateIds:Object,activitySummaries:Object,filterSubIds:Object},setup(p){let b=p;const $=d([]),L=d(),S=d(!0),_=d(1),w=d(0),x=d(),q=d(!1),F=d(!1),W=d(),R=d([]),g=ye(),U=d([]),Z=d(),B=d(),P=d(),T=d(),Y=d([]),f=d(),M=d(),ee=d([{id:1,name:"1st Stage Filter Only"},{id:2,name:"Filter Subscription"},{id:3,name:"All Types"}]),te=d([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),h=d([]),X=d(),C=d();ge(()=>{S.value=!1,w.value=b.filterSubs.total,W.value=b.salesQuotations,U.value=b.stateIds});const le=t=>{_.value=t.page+1,console.log("page change"),console.log(_.value),k()},ae=t=>{x.value=t.target.value,console.log(t.target.value),oe()},k=async()=>{try{console.log("fetch data page"),console.log(_.value);const t=await H.get("/confirmDeliveryRequirement",{page:_.value,search:x.value,dates:h.value,stateId:f.value===0?null:f.value,activitySummary:X.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),w.value=l.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{S.value=!1}},oe=me(async()=>{try{console.log("fetch data page"),console.log(_.value);const t=await H.get("/confirmDeliveryRequirement",{page:_.value,search:x.value,dates:h.value,stateId:f.value===0?null:f.value,activitySummary:X.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),w.value=l.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{S.value=!1}},300),E=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,se=t=>{if(!t||t.length===0)return"";const l=new Date(t[0]),y=t[1]?new Date(t[1]):l;return`${l.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${y.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},ie=()=>{initFilters()},ne=t=>{q.value=!0,Z.value=t.sales_order_no,B.value=t.order_line,P.value=t.customer_name,T.value=t.address,Y.value=t.contact_address,C.value=t},de=t=>{Z.value=t.sales_order_no,console.log("Select clicked",event)},re=async t=>{try{const l=await j.put(`/api/updateCreatedOnOdooInFilterSubs/${t.id}`,{created_on_odoo:t.created_on_odoo.value});console.log("a"),console.log(t),console.log("z"),console.log(l),console.log("handle select change"),g.add({severity:"success",summary:`Moved #${t.sales_order_no} for Confirm Delivery Requirement`,detail:"",life:3e3})}catch(l){console.error("Failed to update created_on_odoo:",l),g.add({severity:"error",summary:"Failed to update",detail:"",life:3e3})}},ce=async t=>{try{const l=await j.put(`/api/updateRequiredDeliveryInFilterSubs/${t.id}`,{required_delivery:t.required_delivery.value});console.log("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZZZZZZZZZZZZZZZZZZZZZ"),console.log(l),console.log("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"),console.log("handle select change"),t.required_delivery.value?g.add({severity:"success",summary:"Success",detail:"Message Content",life:3e3}):g.add({severity:"success",summary:"Updated",detail:"",life:3e3})}catch(l){console.error("Failed to update created_on_odoo:",l),g.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};return D(Z,async t=>{if(t)try{const l=await j.get("/api/findSalesOrdersBySalesOrderNo",{params:{sales_order_no:t}});console.log("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZZZZZZZZZZZZZZZZZZZZZ"),console.log(l),console.log("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"),R.value=l.data.map(y=>({name:y.sales_order_no,value:y.sales_order_no})),R.value.push({name:"- Unselect -",value:null})}catch(l){console.error("Error fetching dropdown options:",l)}}),D(f,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),k())}),D(X,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),k())}),D(h,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),k())}),(t,l)=>{const y=Xe("Toast");return r(),u("div",Ae,[i("div",null,[i("div",be,[h.value.length?(r(),u("i",Se)):N("",!0),v(" "+n(se(h.value))+" ",1),we,v(" "+n(f.value),1)])]),a(y),a(o(G),{visible:q.value,"onUpdate:visible":l[0]||(l[0]=e=>q.value=e),header:Z.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[i("p",null,[Ze,v(" "+n(P.value),1)]),i("p",null,[Ce,v(" "+n(T.value),1)]),ke,a(o(z),{value:B.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:c(()=>[a(o(m),{field:"product",header:"Product",style:{"min-width":"10rem"}}),a(o(m),{field:"description",header:"Description",style:{"min-width":"10rem"}}),a(o(m),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),De,i("div",null,[C.value.contact_address[0].parent?(r(),u("p",Ie,[Ve,v(" "+n(C.value.contact_address[0].parent.complete_address),1)])):N("",!0)]),i("div",null,[(r(!0),u(I,null,V(C.value.contact_address[0].children,(e,s)=>(r(),u("p",{key:s},[$e,v(" "+n(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),a(o(G),{visible:F.value,"onUpdate:visible":l[5]||(l[5]=e=>F.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[xe,(r(!0),u(I,null,V(U.value,e=>(r(),u("div",{key:e.id,class:"flex items-center mb-2"},[a(o(O),{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=s=>f.value=s),inputId:e.id,name:"dynamic",value:e.state_id},null,8,["modelValue","inputId","value"]),i("label",{for:e.id,class:"ml-2"},n(e.name),9,qe)]))),128)),Fe,(r(!0),u(I,null,V(ee.value,e=>(r(),u("div",{key:e.id,class:"flex items-center mb-2"},[a(o(O),{modelValue:M.value,"onUpdate:modelValue":l[2]||(l[2]=s=>M.value=s),inputId:e.id,name:"dynamic",value:e.state_id},null,8,["modelValue","inputId","value"]),i("label",{for:e.id,class:"ml-2"},n(e.name),9,Re)]))),128)),Ue,(r(!0),u(I,null,V(p.activitySummaries,e=>(r(),u("div",{key:e.id,class:"flex items-center mb-2"},[a(o(O),{modelValue:X.value,"onUpdate:modelValue":l[3]||(l[3]=s=>X.value=s),inputId:e.id,name:"dynamic",value:e.activity_summary},null,8,["modelValue","inputId","value"]),i("label",{for:e.id,class:"ml-2"},n(e.activity_summary),9,Oe)]))),128)),je,a(o(ve),{modelValue:h.value,"onUpdate:modelValue":l[4]||(l[4]=e=>h.value=e),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),a(o(pe),{rows:100,totalRecords:w.value,rowsPerPageOptions:[10,25,50,100],onPage:le},{start:c(e=>[v(n(p.filterSubs.from)+"-"+n(p.filterSubs.to)+" / "+n(p.filterSubs.total),1)]),_:1},8,["totalRecords"]),a(o(z),{selection:$.value,"onUpdate:selection":l[8]||(l[8]=e=>$.value=e),filters:L.value,"onUpdate:filters":l[9]||(l[9]=e=>L.value=e),value:p.filterSubs.data,lazy:"",loading:S.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:c(()=>[i("div",Ne,[a(o(K),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:l[6]||(l[6]=e=>ie())}),a(o(fe),null,{default:c(()=>[a(o(he),null,{default:c(()=>[Le]),_:1}),i("div",null,[a(o(K),{onClick:l[7]||(l[7]=e=>F.value=!0),label:"Filter",class:"mr-4"}),a(o(_e),{placeholder:"Keyword Search",onInput:ae})])]),_:1})])]),empty:c(()=>[v(" No filterSubs found. ")]),loading:c(()=>[v(" Loading filterSubs data. Please wait. ")]),default:c(()=>[a(o(m),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(o(m),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:c(({data:e})=>[i("span",{onClick:s=>ne(e),class:"cursor-pointer hover:underline"},n(e.sales_order_no),9,Be)]),_:1}),a(o(m),{field:"",header:"Created on Odoo",style:{"min-width":"10rem"}},{body:c(({data:e})=>[a(o(Q),{modelValue:e.created_on_odoo,"onUpdate:modelValue":s=>e.created_on_odoo=s,options:R.value,filter:"",optionLabel:"name",placeholder:"Select Sales Order #",class:"w-full md:w-14rem",onClick:s=>de(e),onChange:s=>re(e)},{value:c(s=>{var A;return[s.value?(r(),u("div",Pe,[e.created_on_odoo&&e.created_on_odoo.value!==null?(r(),u("div",Te,n(((A=e.created_on_odoo)==null?void 0:A.name)||e.created_on_odoo),1)):(r(),u("div",Me,n(s.placeholder),1))])):(r(),u("span",Ee,n(s.placeholder),1))]}),option:c(s=>[i("div",ze,[i("div",null,n(s.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onClick","onChange"])]),_:1}),t.route().current("confirmDeliveryRequirement")?(r(),J(o(m),{key:0,field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:c(({data:e})=>[a(o(Q),{modelValue:e.required_delivery,"onUpdate:modelValue":s=>e.required_delivery=s,options:te.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:s=>ce(e)},{value:c(s=>{var A;return[s.value?(r(),u("div",Ge,[e.required_delivery&&e.required_delivery.value!==null?(r(),u("div",Ke,n(((A=e.required_delivery)==null?void 0:A.name)||e.required_delivery),1)):(r(),u("div",Qe,n(s.placeholder),1))])):(r(),u("span",He,n(s.placeholder),1))]}),option:c(s=>[i("div",Je,[i("div",null,n(s.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1})):N("",!0),a(o(m),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),a(o(m),{field:"address",header:"Address",style:{"min-width":"10rem"}}),a(o(m),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),a(o(m),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:c(({data:e})=>[v(n(E(e.due_date)),1)]),_:1}),a(o(m),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),a(o(m),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:c(({data:e})=>[v(n(E(e.invoice_date)),1)]),_:1}),a(o(m),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:c(({data:e})=>{var s;return[v(n((s=U.value[e.state_id-1])==null?void 0:s.name),1)]}),_:1}),a(o(m),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),a(o(m),{field:"email",header:"Email",style:{"min-width":"10rem"}}),a(o(m),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}})]),_:1},8,["selection","filters","value","loading"])])}}},Ye={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},ot={__name:"ConfirmDeliveryRequirement",props:{filterSubs:Object,stateIds:Object,activitySummaries:Object,filterSubIds:Object},setup(p){return(b,$)=>(r(),J(ue,{title:"ConfirmDeliveryRequirement"},{default:c(()=>[i("div",Ye,[a(We,{filterSubs:p.filterSubs,stateIds:p.stateIds,activitySummaries:p.activitySummaries,filterSubIds:p.filterSubIds},null,8,["filterSubs","stateIds","activitySummaries","filterSubIds"])])]),_:1}))}};export{ot as default};
