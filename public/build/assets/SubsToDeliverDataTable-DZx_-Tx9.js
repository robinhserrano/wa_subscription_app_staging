import{d as Ie,s as se,a as _,b as ae,c as K,e as Ue,f as T,g as Ve,h as Fe,i as Re,j as Ze,k as ie,l as Oe}from"./primeicons-DUxkHKsn.js";import{x as Te,d as c,z as je,A as ze,C as re,D as I,E as U,G as ne,o as n,e as u,a as i,g as p,t as d,f as h,b as a,w as v,u as o,F as j,h as z,c as B}from"./app-CaNukmwN.js";import{u as L}from"./xlsx-YQvpTstd.js";import{s as Be}from"./index-fg7Ylll-.js";const Le={class:"card"},Ee={class:"m-4 my-4"},Pe={key:0},Ne=i("i",{class:"pi pi-calendar"},null,-1),We={key:1},Me=i("i",{class:"pi pi-map-marker"},null,-1),Ge=i("i",{class:"pi pi-user"},null,-1),Ke=i("i",{class:"pi pi-map-marker mt-2"},null,-1),Qe=i("p",{class:"mt-6"}," Order Lines:",-1),qe={key:0},He=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),Je=i("i",{class:"pi pi-building-columns"},null,-1),Ye=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),et=i("i",{class:"pi pi-building"},null,-1),tt=i("p",{class:"mb-2 text-xl font-bold"},"States",-1),lt=["for"],ot=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Category",-1),st=["for"],at=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),it=["for"],rt=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),nt={class:"flex justify-between"},dt=i("i",{class:"pi pi-search"},null,-1),ct={style:{display:"flex","align-items":"center"}},ut=["onClick"],vt=["onClick"],_t={key:1,class:"pi pi-truck ml-2"},mt={class:"flex"},pt={key:0,class:"flex align-items-center"},ht={key:0},yt={key:1},ft={key:1},gt={class:"flex align-items-center"},bt={class:"flex"},kt={key:0,class:"flex align-items-center"},wt={key:0},St={key:1},Ct={key:0},At={key:2},Xt={key:0},Dt={key:3},xt={key:1},$t={class:"flex align-items-center"},It={key:0,class:"ml-1"},Zt={__name:"SubsToDeliverDataTable",props:{filterSubs:Object,stateIds:Object,filterSubIds:Object,currentUser:Object,users:Object,serviceCodes:Object},setup(X){const de=Te(),ce=(t,l,m)=>{de.require({message:`Do you want to unlink #${l} from #${t}?`,header:"Unlink Sales Order",icon:"pi pi-info-circle",rejectLabel:"Cancel",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Unlink",severity:"danger"},accept:async()=>{await U.delete(`/api/deliverSub/${m}`),f(),A.add({severity:"info",summary:"Unlinked Successfully",detail:`Unlinked #${l} from #${t}`,life:3e3})},reject:()=>{}})};let b=X;const y=c([]);c();const V=c(!0),C=c(1),D=c(0),E=c(),P=c(!1),N=c(!1),ue=c(),Q=c([]),A=je(),F=c([]),W=c(),q=c(),H=c(),J=c(),ve=c([]),M=c([]);c();const _e=c([{id:1,name:"Subscription"}]),me=c([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]);c([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]);const pe=c([{name:"Delivery Booked",value:"Delivery Booked"},{name:"- Unselect -",value:null}]),k=c([]),R=c(),w=c([]),x=c([]),$=c([]),Z=c(100);ze(()=>{V.value=!1,D.value=b.filterSubs.total,ue.value=b.salesQuotations,F.value=b.stateIds,M.value=b.serviceCodes.map(t=>({name:t.service_code,value:t.id,totalWeight:t.total_weight})),M.value.push({name:"- Unselect -",value:null,totalWeight:null}),console.log("aaaaaaaaa"),console.log(b.serviceCodes),console.log("zzzzzzzzzzz")});const he=t=>{Z.value=t.rows,C.value=t.page+1,console.log("page change"),console.log(C.value),f()},ye=t=>{E.value=t.target.value,console.log(t.target.value),fe()},f=async()=>{try{console.log("fetch data page"),console.log(C.value);const t=await re.get("/subscriptionsToDeliver",{page:C.value,search:E.value,dates:k.value,stateId:w.value,activitySummary:x.value,categories:$.value,perPage:Z.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),D.value=l.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{V.value=!1}},fe=Ie(async()=>{try{console.log("fetch data page"),console.log(C.value);const t=await re.get("/subscriptionsToDeliver",{page:C.value,search:E.value,dates:k.value,stateId:w.value,activitySummary:x.value,categories:$.value,perPage:Z.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),D.value=l.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{V.value=!1}},300),Y=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,ge=t=>{if(!t||t.length===0)return"";const l=new Date(t[0]),m=t[1]?new Date(t[1]):l;return`${l.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${m.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},be=t=>t.map(l=>{var m;return(m=F.value[l-1])==null?void 0:m.code}).join(", "),ke=()=>{initFilters()},we=t=>{P.value=!0,W.value=t.sales_order_no,q.value=t.order_line,H.value=t.customer_name,J.value=t.address,ve.value=t.contact_address,R.value=t},Se=async t=>{try{const l=await U.put(`/api/updateDeliveredOrDeliveryBooked/${t.id}`,{delivered_or_delivery_booked:t.delivered_or_delivery_booked.value,delivered_or_delivery_booked_by_id:b.currentUser.id});A.add({severity:"success",summary:`Updated #${t.sales_order_no} delivered or delivery booked status`,detail:"",life:3e3})}catch(l){console.error("Failed to update delivered_or_delivery_booked:",l),A.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}},Ce=async t=>{try{console.log(t);const l=await U.put(`/api/updateServiceCode/${t.id}`,{service_code_id:t.service_code_id.value});A.add({severity:"success",summary:`Updated #${t.sales_order_no}'s service code`,detail:"",life:3e3}),f()}catch(l){console.error("Failed to update delivered_or_delivery_booked:",l),A.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};I(W,async t=>{if(t)try{const l=await U.get("/api/findSalesOrdersBySalesOrderNo",{params:{sales_order_no:t}});console.log("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZZZZZZZZZZZZZZZZZZZZZ"),console.log(l),console.log("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"),Q.value=l.data.map(m=>({name:m.sales_order_no,value:m.sales_order_no})),Q.value.push({name:"- Unselect -",value:null})}catch(l){console.error("Error fetching dropdown options:",l)}}),I(w,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),f())}),I(x,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),f())}),I(k,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),f())}),I($,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),f())});const Ae=t=>t,Xe=()=>{const t={"Record Type":"recordType","Receiver Code":"receiverCode","Receiver Name":"customer_name","Receiver Address 1":"street","Receiver Address 2":"street2","Receiver Address 3":"receiverAddress3","Receiver Suburb":"city","Receiver Postcode":"zip","Receiver Contact":"receiverContact","Receiver Phone":"phone",Email:"email","Reference 1":"sales_order_no","Reference 2":"","Special Instructions":"","Service Code":"serviceCode","Number of Items":"numberOfItems","Total Weight":"totalWeight","Total Cubic Volume":"totalCubicVolume","Authority to Leave":"authorityToLeave"},l=y.value.map(r=>{var ee,te,le,oe;console.log(r),console.log(r.contact_address),r.recordType="C",r.receiverCode=null,r.street=r.contact_address[0].street,r.street2=r.contact_address[0].street2,r.receiverAddress3=null,r.city=r.contact_address[0].city,r.zip=r.contact_address[0].zip,r.receiverContact=r.customer_name,r.reference2=null,r.specialInstructions=null,r.serviceCode=(ee=r.service_code)==null?void 0:ee.service_code,r.numberOfItems=(te=r.service_code)==null?void 0:te.number_of_items,r.totalWeight=(le=r.service_code)==null?void 0:le.total_weight,r.totalCubicVolume=(oe=r.service_code)==null?void 0:oe.total_cubic_volume,r.authorityToLeave="Y";let G={};for(const[xe,$e]of Object.entries(t))G[xe]=r[$e];return console.log(G),G}),m=L.json_to_sheet(l),O=L.book_new();L.book_append_sheet(O,m,"Sheet1");const e=L.sheet_to_csv(m),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),S=URL.createObjectURL(s),g=document.createElement("a");g.href=S,g.setAttribute("download","subs_to_deliver.csv"),document.body.appendChild(g),g.click(),document.body.removeChild(g)},De=async()=>{var t=y.value.map(m=>m.id);console.log(t);const l=JSON.stringify({filterSubIds:t,delivered_or_delivery_booked_by_id:b.currentUser.id});await U.post("/api/bulkConfirmDeliveryBooked",l,{headers:{"Content-Type":"application/json"}}),A.add({severity:"success",summary:`Successfully confirmed ${t.length} filter subs`,detail:"",life:3e3}),f(),y.value=[]};return(t,l)=>{const m=ne("Toast"),O=ne("font-awesome-icon");return n(),u("div",Le,[i("div",null,[i("div",Ee,[k.value.length?(n(),u("div",Pe,[Ne,p(" "+d(ge(k.value)),1)])):h("",!0),w.value.length?(n(),u("div",We,[Me,p(" "+d(be(w.value)),1)])):h("",!0)])]),a(m),a(o(ae),{visible:P.value,"onUpdate:visible":l[0]||(l[0]=e=>P.value=e),header:W.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:v(()=>[i("p",null,[Ge,p(" "+d(H.value),1)]),i("p",null,[Ke,p(" "+d(J.value),1)]),Qe,a(o(se),{value:q.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:v(()=>[a(o(_),{field:"product",header:"Product",style:{"min-width":"10rem"}}),a(o(_),{field:"description",header:"Description",style:{"min-width":"10rem"}}),a(o(_),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),i("div",null,[R.value.contact_address[0].parent?(n(),u("p",qe,[He,Je,p(" "+d(R.value.contact_address[0].parent.complete_address),1)])):h("",!0)]),i("div",null,[(n(!0),u(j,null,z(R.value.contact_address[0].children,(e,s)=>(n(),u("p",{key:s},[Ye,et,p(" "+d(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),a(o(ae),{visible:N.value,"onUpdate:visible":l[5]||(l[5]=e=>N.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:v(()=>[tt,(n(!0),u(j,null,z(F.value,e=>(n(),u("div",{key:e.id,class:"flex items-center mb-2"},[a(o(K),{modelValue:w.value,"onUpdate:modelValue":l[1]||(l[1]=s=>w.value=s),inputId:e.state_id,name:"stateIds",value:e.state_id},null,8,["modelValue","inputId","value"]),i("label",{for:e.id,class:"ml-2"},d(e.name),9,lt)]))),128)),ot,(n(!0),u(j,null,z(_e.value,e=>(n(),u("div",{key:e.id,class:"flex items-center mb-2"},[a(o(K),{modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=s=>$.value=s),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),i("label",{for:e.id,class:"ml-2"},d(e.name),9,st)]))),128)),at,(n(!0),u(j,null,z(me.value,e=>(n(),u("div",{key:e.id,class:"flex items-center mb-2"},[a(o(K),{modelValue:x.value,"onUpdate:modelValue":l[3]||(l[3]=s=>x.value=s),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),i("label",{for:e.id,class:"ml-2"},d(e.name),9,it)]))),128)),rt,a(o(Ue),{modelValue:k.value,"onUpdate:modelValue":l[4]||(l[4]=e=>k.value=e),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),y.value.length?(n(),B(o(T),{key:0,label:"Export as Excel",onClick:Xe,class:"ml-4"})):h("",!0),y.value.length?(n(),B(o(T),{key:1,label:`Mark All As Delivery Booked (${y.value.length})`,onClick:De,icon:"pi pi-truck",class:"ml-4"},null,8,["label"])):h("",!0),a(o(Ve),{rows:Z.value,totalRecords:D.value,rowsPerPageOptions:[10,25,50,100,D.value].sort((e,s)=>e-s),onPage:he},{start:v(e=>[p(d(X.filterSubs.from)+"-"+d(X.filterSubs.to)+" / "+d(X.filterSubs.total),1)]),_:1},8,["rows","totalRecords","rowsPerPageOptions"]),a(o(se),{selection:y.value,"onUpdate:selection":l[8]||(l[8]=e=>y.value=e),value:Ae(X.filterSubs.data),lazy:"",loading:V.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:v(()=>[i("div",nt,[a(o(T),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:l[6]||(l[6]=e=>ke())}),a(o(Fe),null,{default:v(()=>[a(o(Re),null,{default:v(()=>[dt]),_:1}),i("div",null,[a(o(T),{onClick:l[7]||(l[7]=e=>N.value=!0),label:"Filter",class:"mr-4"}),a(o(Ze),{placeholder:"Keyword Search",onInput:ye})])]),_:1})])]),empty:v(()=>[p(" No filterSubs found. ")]),loading:v(()=>[p(" Loading filterSubs data. Please wait. ")]),default:v(()=>[a(o(_),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(o(_),{field:"root_sales_order.sales_order_no",header:"Root Sales Order #",style:{"min-width":"10rem"}},{body:v(({data:e})=>[i("div",ct,[i("span",null,d(e.root_sales_order.sales_order_no),1),a(o(Be)),i("div",{onClick:s=>ce(e.root_sales_order.sales_order_no,e.sales_order_no,e.id),style:{cursor:"pointer","margin-left":"8px"}},[a(O,{icon:["fas","link-slash"],style:{color:"#800000"}})],8,ut)])]),_:1}),a(o(_),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:v(({data:e})=>[i("span",{onClick:s=>we(e),class:"cursor-pointer hover:underline"},d(e.sales_order_no),9,vt),e.category==="Subscription"?(n(),B(O,{key:0,icon:"fa-filter-circle-dollar",class:"ml-2"})):h("",!0),e.delivered_or_delivery_booked&&e.delivered_or_delivery_booked.value!==null?(n(),u("i",_t)):h("",!0)]),_:1}),a(o(_),{field:"",header:"Delivered or Delivery Booked",style:{"min-width":"10rem"}},{body:v(({data:e})=>[i("div",mt,[a(o(ie),{modelValue:e.delivered_or_delivery_booked,"onUpdate:modelValue":s=>e.delivered_or_delivery_booked=s,options:pe.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:s=>Se(e)},{value:v(s=>{var S;return[s.value?(n(),u("div",pt,[e.delivered_or_delivery_booked&&e.delivered_or_delivery_booked.value!==null?(n(),u("div",ht,d(((S=e.delivered_or_delivery_booked)==null?void 0:S.name)||e.delivered_or_delivery_booked),1)):(n(),u("div",yt,d(s.placeholder),1))])):(n(),u("span",ft,d(s.placeholder),1))]}),option:v(s=>[i("div",gt,[i("div",null,d(s.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"])])]),_:1}),a(o(_),{field:"",header:"Service Code",style:{"min-width":"10rem"}},{body:v(({data:e})=>[i("div",bt,[a(o(ie),{modelValue:e.service_code_id,"onUpdate:modelValue":s=>e.service_code_id=s,options:M.value,filter:"",optionLabel:"name",placeholder:"Select Code",class:"w-full md:w-14rem",onChange:s=>Ce(e)},{value:v(s=>{var S,g,r;return[s.value?(n(),u("div",kt,[e.service_code_id.name=="- Unselect -"&&e.service_code_id.value==null?(n(),u("div",wt,d(s.placeholder),1)):e.service_code_id&&e.service_code_id.value==null?(n(),u("div",St,[i("div",null,d(e.service_code.service_code),1),e.service_code.total_weight?(n(),u("div",Ct,"("+d(e.service_code.total_weight)+"kg) ",1)):h("",!0)])):e.service_code_id.value!==null?(n(),u("div",At,[i("div",null,d(((S=e.service_code_id)==null?void 0:S.name)||""),1),(g=e.service_code_id)!=null&&g.totalWeight?(n(),u("div",Xt,"("+d((r=e.service_code_id)==null?void 0:r.totalWeight)+"kg) ",1)):h("",!0)])):(n(),u("div",Dt,d(s.placeholder),1))])):(n(),u("span",xt,d(s.placeholder),1))]}),option:v(s=>[i("div",$t,[i("div",null,d(s.option.name),1),s.option.totalWeight?(n(),u("div",It,"("+d(s.option.totalWeight)+"kg) ",1)):h("",!0)])]),default:v(()=>[p(" aaaaaaaaaaaaaaaaa ")]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"])])]),_:1}),a(o(_),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),a(o(_),{field:"address",header:"Address",style:{"min-width":"10rem"}}),a(o(_),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),a(o(_),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:v(({data:e})=>[p(d(Y(e.due_date)),1)]),_:1}),a(o(_),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),a(o(_),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:v(({data:e})=>[p(d(Y(e.invoice_date)),1)]),_:1}),a(o(_),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:v(({data:e})=>{var s;return[p(d((s=F.value[e.state_id-1])==null?void 0:s.name),1)]}),_:1}),a(o(_),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),a(o(_),{field:"email",header:"Email",style:{"min-width":"10rem"}}),a(o(_),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:v(({data:e})=>[e.payment_status==="paid"?(n(),B(o(Oe),{key:0,severity:"success",value:"Paid"})):h("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}};export{Zt as _};
