import{_ as ge}from"./AppLayout-BsYwGUg1.js";import{d as Se,s as Y,a as u,b as Z,c as ee,e as we,f as D,g as ke,h as Ce,i as De,j as $e,k as Ie,l as Fe}from"./primeicons-BXeiMZlh.js";import{p as xe,q as qe,d as r,s as Ue,x as je,y as te,z as F,A as x,B as le,C as Ve,o,e as v,a as i,g as p,t as d,f as _,b as a,w as n,u as s,F as Q,h as G,c as h,l as q,Q as Ae}from"./app-L6f9-XHl.js";import{s as Pe}from"./index-Biis6575.js";import{s as se}from"./index-CFd9i-YD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ne={class:"card"},Oe={class:"m-4 my-4"},Le={key:0},Re=i("i",{class:"pi pi-calendar"},null,-1),Ee={key:1},Be=i("i",{class:"pi pi-map-marker"},null,-1),Te=i("i",{class:"pi pi-user"},null,-1),Me=i("i",{class:"pi pi-map-marker mt-2"},null,-1),Qe=i("p",{class:"mt-6"}," Order Lines:",-1),Ge={key:0},Ke=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),ze=i("i",{class:"pi pi-building-columns"},null,-1),He=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),Je=i("i",{class:"pi pi-building"},null,-1),We=i("p",{class:"mb-2 text-xl font-bold"},"States",-1),Xe=["for"],Ye=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),Ze=["for"],et=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),tt={class:"font-bold"},lt={class:"flex justify-between"},st=i("i",{class:"pi pi-search"},null,-1),at={style:{display:"flex","align-items":"center"}},it=["onClick"],ot=["onClick"],rt={class:"flex items-center"},nt={key:2,class:"pi pi-truck ml-2"},dt=["src"],ct={style:{display:"flex","align-items":"center"}},ut={key:0,class:"flex align-items-center"},mt={key:0},vt={key:1},ft={key:1},pt={class:"flex align-items-center"},yt=["src"],_t={__name:"ConfirmDeliveryFilterSubscriptionDataTable",props:{currentUser:Object,deliverSubIds:Object,filterSubs:Object,stateIds:Object,users:Object},setup(y){const N=xe(),K=(e,l,m)=>{N.require({message:`Do you want to unlink #${l} from #${e}?`,header:"Unlink Sales Order",icon:"pi pi-info-circle",rejectLabel:"Cancel",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Unlink",severity:"danger"},accept:async()=>{await x.delete(`/api/deliverSub/${m}`),b(),S.add({severity:"info",summary:"Unlinked Successfully",detail:`Unlinked #${l} from #${e}`,life:3e3})},reject:()=>{}})};qe();let g=y;const f=r([]),U=r(!0),C=r(1),j=r(0),O=r(),L=r(!1),R=r(!1),ae=r(),z=r([]),S=Ue(),V=r([]),E=r(),H=r(),J=r(),W=r(),ie=r([]);r([{id:1,name:"Subscription"}]);const oe=r([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),re=r([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),w=r([]),A=r(),k=r([]),$=r([]),B=r([]),P=r(100);je(()=>{U.value=!1,j.value=g.filterSubs.total,ae.value=g.salesQuotations,V.value=g.stateIds});const ne=e=>{P.value=e.rows,C.value=e.page+1,console.log("page change"),console.log(C.value),b()},de=e=>{O.value=e.target.value,console.log(e.target.value),ce()},b=async()=>{try{console.log("fetch data page"),console.log(C.value);const e=te.get("/confirmDeliveryFilterSubscription",{page:C.value,search:O.value,dates:w.value,stateId:k.value,activitySummary:$.value,categories:B.value,perPage:P.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),j.value=l.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{U.value=!1}},ce=Se(async()=>{try{console.log("fetch data page"),console.log(C.value);const e=await te.get("/confirmDeliveryFilterSubscription",{page:C.value,search:O.value,dates:w.value,stateId:k.value,activitySummary:$.value,categories:B.value,perPage:P.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),j.value=l.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{U.value=!1}},300),T=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,ue=e=>{if(!e||e.length===0)return"";const l=new Date(e[0]),m=e[1]?new Date(e[1]):l;return`${l.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${m.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},me=e=>e.map(l=>{var m;return(m=V.value[l-1])==null?void 0:m.code}).join(", "),ve=()=>{initFilters()},fe=e=>{L.value=!0,E.value=e.sales_order_no,H.value=e.order_line,J.value=e.customer_name,W.value=e.address,ie.value=e.contact_address,A.value=e},pe=async e=>{try{console.log(e.required_delivery.value);const l=await x.put(`/api/updateRequiredDeliveryInDeliverSubs/${e.id}`,{required_delivery:e.required_delivery.value,required_delivery_updated_by_id:g.currentUser.id});e.required_delivery.value=="Confirm"?S.add({severity:"success",summary:`Successfully confirmed #${e.sales_order_no} for delivery`,detail:"",life:3e3}):e.required_delivery.value=="Deny"?S.add({severity:"info",summary:`Successfully denied #${e.sales_order_no}`,detail:"",life:3e3}):S.add({severity:"info",summary:`Updated #${e.sales_order_no}'s require delivery value`,detail:"",life:3e3})}catch(l){console.error("Failed to update required_delivery:",l),S.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};F(E,async e=>{if(e)try{const l=await x.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:e}});z.value=l.data.map(m=>({name:m,value:m})),z.value.push({name:"- Unselect -",value:null})}catch(l){console.error("Error fetching dropdown options:",l)}}),F(k,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),b())}),F($,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),b())}),F(w,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),b())}),F(B,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),b())});const ye=e=>e,_e=async()=>{var e=f.value.map(m=>m.id);console.log(e);const l=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:g.currentUser.id});await x.post("/api/bulkConfirmDeliverSubs",l,{headers:{"Content-Type":"application/json"}}),S.add({severity:"success",summary:`Successfully confirmed ${e.length} filter subs`,detail:"",life:3e3}),b(),f.value=[]},he=async e=>{f.value=e},be=async()=>{var e=f.value.map(m=>m.id);console.log(e);const l=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:g.currentUser.id});await x.post("/api/bulkDenyDeliverSubs",l,{headers:{"Content-Type":"application/json"}}),S.add({severity:"success",summary:`Successfully denied ${e.length} filter subs`,detail:"",life:3e3}),b(),f.value=[]};return(e,l)=>{const m=le("Toast"),M=le("font-awesome-icon"),I=Ve("tooltip");return o(),v("div",Ne,[i("div",null,[i("div",Oe,[w.value.length?(o(),v("div",Le,[Re,p(" "+d(ue(w.value)),1)])):_("",!0),k.value.length?(o(),v("div",Ee,[Be,p(" "+d(me(k.value)),1)])):_("",!0)])]),a(m),a(s(Z),{visible:L.value,"onUpdate:visible":l[0]||(l[0]=t=>L.value=t),header:E.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:n(()=>[i("p",null,[Te,p(" "+d(J.value),1)]),i("p",null,[Me,p(" "+d(W.value),1)]),Qe,a(s(Y),{value:H.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:n(()=>[a(s(u),{field:"product",header:"Product",style:{"min-width":"10rem"}}),a(s(u),{field:"description",header:"Description",style:{"min-width":"10rem"}}),a(s(u),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),i("div",null,[A.value.contact_address[0].parent?(o(),v("p",Ge,[Ke,ze,p(" "+d(A.value.contact_address[0].parent.complete_address),1)])):_("",!0)]),i("div",null,[(o(!0),v(Q,null,G(A.value.contact_address[0].children,(t,c)=>(o(),v("p",{key:c},[He,Je,p(" "+d(t.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),a(s(Z),{visible:R.value,"onUpdate:visible":l[4]||(l[4]=t=>R.value=t),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:n(()=>[We,(o(!0),v(Q,null,G(V.value,t=>(o(),v("div",{key:t.id,class:"flex items-center mb-2"},[a(s(ee),{modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=c=>k.value=c),inputId:t.state_id,name:"stateIds",value:t.state_id},null,8,["modelValue","inputId","value"]),i("label",{for:t.id,class:"ml-2"},d(t.name),9,Xe)]))),128)),Ye,(o(!0),v(Q,null,G(oe.value,t=>(o(),v("div",{key:t.id,class:"flex items-center mb-2"},[a(s(ee),{modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=c=>$.value=c),inputId:t.name,name:"category",value:t.name},null,8,["modelValue","inputId","value"]),i("label",{for:t.id,class:"ml-2"},d(t.name),9,Ze)]))),128)),et,a(s(we),{modelValue:w.value,"onUpdate:modelValue":l[3]||(l[3]=t=>w.value=t),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),f.value.length?(o(),h(s(D),{key:0,class:"ml-4",outlined:""},{default:n(()=>[i("p",tt,d(f.value.length),1),p("selected "),f.value.length<y.filterSubs.total?(o(),h(s(D),{key:0,label:`Select all ${y.deliverSubIds.length}`,onClick:l[5]||(l[5]=t=>he(y.deliverSubIds)),icon:"pi pi-arrow-right",class:"ml-4",severity:"info"},null,8,["label"])):_("",!0)]),_:1})):_("",!0),f.value.length?(o(),h(s(D),{key:1,label:`Confirm All (${f.value.length})`,onClick:_e,icon:"pi pi-verified",class:"ml-4"},null,8,["label"])):_("",!0),f.value.length?(o(),h(s(D),{key:2,label:`Deny All (${f.value.length})`,onClick:be,icon:"pi pi-times-circle",class:"ml-4"},null,8,["label"])):_("",!0),a(s(ke),{rows:P.value,totalRecords:j.value,rowsPerPageOptions:[10,25,50,100],onPage:ne},{start:n(t=>[p(d(y.filterSubs.from)+"-"+d(y.filterSubs.to)+" / "+d(y.filterSubs.total),1)]),_:1},8,["rows","totalRecords"]),a(s(Y),{selection:f.value,"onUpdate:selection":l[8]||(l[8]=t=>f.value=t),value:ye(y.filterSubs.data),lazy:"",loading:U.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:n(()=>[i("div",lt,[a(s(D),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:l[6]||(l[6]=t=>ve())}),a(s(Ce),null,{default:n(()=>[a(s(De),null,{default:n(()=>[st]),_:1}),i("div",null,[a(s(D),{onClick:l[7]||(l[7]=t=>R.value=!0),label:"Filter",class:"mr-4"}),a(s($e),{placeholder:"Keyword Search",onInput:de})])]),_:1})])]),empty:n(()=>[p(" No filterSubs found. ")]),loading:n(()=>[p(" Loading filterSubs data. Please wait. ")]),default:n(()=>[a(s(u),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(s(u),{field:"root_sales_order.sales_order_no",header:"Root Sales Order #",style:{"min-width":"10rem"}},{body:n(({data:t})=>[i("div",at,[i("span",null,d(t.root_sales_order.sales_order_no),1),a(s(Pe)),i("div",{onClick:c=>K(t.root_sales_order.sales_order_no,t.sales_order_no,t.id),style:{cursor:"pointer","margin-left":"8px"}},[a(M,{icon:["fas","link-slash"],style:{color:"#800000"}})],8,it)])]),_:1}),a(s(u),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:n(({data:t})=>[i("span",{onClick:c=>fe(t),class:"cursor-pointer hover:underline"},d(t.sales_order_no),9,ot),i("div",rt,[t.hasCallOutService?q((o(),h(M,{key:0,icon:["fas","toolbox"]},null,512)),[[I,"Filter Sub (Filter + Call Out Service)"]]):q((o(),h(M,{key:1,icon:["fas","faucet"]},null,512)),[[I,"Filter Sub (Filter Only)"]]),t.delivered_or_delivery_booked&&t.delivered_or_delivery_booked.value!==null?q((o(),v("i",nt,null,512)),[[I,"Delivery Booked"]]):_("",!0),t.odoo_created_by_id?q((o(),h(s(se),{key:3,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:n(()=>[i("img",{src:t.odoo_created_by.profile_photo_url,alt:"User Initials"},null,8,dt)]),_:2},1024)),[[I,`Last updated by:
${t.odoo_created_by.name}`]]):_("",!0)])]),_:1}),e.route().current("confirmDeliveryFilterSubscription")?(o(),h(s(u),{key:0,field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:n(({data:t})=>[i("div",ct,[a(s(Ie),{modelValue:t.required_delivery,"onUpdate:modelValue":c=>t.required_delivery=c,options:re.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:c=>pe(t)},{value:n(c=>{var X;return[c.value?(o(),v("div",ut,[t.required_delivery&&t.required_delivery.value!==null?(o(),v("div",mt,d(((X=t.required_delivery)==null?void 0:X.name)||t.required_delivery),1)):(o(),v("div",vt,d(c.placeholder),1))])):(o(),v("span",ft,d(c.placeholder),1))]}),option:n(c=>[i("div",pt,[i("div",null,d(c.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),t.required_delivery_updated_by_id?q((o(),h(s(se),{key:0,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:n(()=>[i("img",{src:t.required_delivery_updated_by.profile_photo_url,alt:"User Initials"},null,8,yt)]),_:2},1024)),[[I,`Last updated by:
${t.required_delivery_updated_by.name}`]]):_("",!0)])]),_:1})):_("",!0),a(s(u),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),a(s(u),{field:"address",header:"Address",style:{"min-width":"10rem"}}),a(s(u),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),a(s(u),{field:"start_date",header:"Start Date",style:{"min-width":"10rem"}},{body:n(({data:t})=>[p(d(T(t.start_date)),1)]),_:1}),a(s(u),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:n(({data:t})=>[p(d(T(t.due_date)),1)]),_:1}),a(s(u),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),a(s(u),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:n(({data:t})=>[p(d(T(t.invoice_date)),1)]),_:1}),a(s(u),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:n(({data:t})=>{var c;return[p(d((c=V.value[t.state_id-1])==null?void 0:c.name),1)]}),_:1}),a(s(u),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),a(s(u),{field:"email",header:"Email",style:{"min-width":"10rem"}}),a(s(u),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:n(({data:t})=>[t.payment_status==="paid"?(o(),h(s(Fe),{key:0,severity:"success",value:"Paid"})):_("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},ht={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},Dt={__name:"ConfirmDeliveryFilterSubscription",props:{filterSubs:Object,filterSubIds:Object,stateIds:Object,users:Object},setup(y){const N=Ae();return(K,g)=>(o(),h(ge,{title:"confirmDeliveryFilterSubscription"},{default:n(()=>[i("div",ht,[a(_t,{filterSubs:y.filterSubs,stateIds:y.stateIds,deliverSubIds:y.filterSubIds,currentUser:s(N).props.auth.user,users:y.users},null,8,["filterSubs","stateIds","deliverSubIds","currentUser","users"])])]),_:1}))}};export{Dt as default};
