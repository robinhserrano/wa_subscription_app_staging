import{_ as be}from"./AppLayout-CP5cg5Fm.js";import{d as Se,s as ee,a as f,b as ae,c as G,e as we,f as R,g as ke,h as Ce,i as $e,j as De,k as Ie,l as qe}from"./primeicons-CIvCBJdi.js";import{B as xe,s as Ue,o as i,e as m,r as Fe,p as E,t as u,c as b,n as Ve,q as je,f as g,x as Ae,y as ze,d,z as Pe,A as Re,C as te,D as F,E as V,G as le,a as r,g as h,b as n,w as v,u as l,F as L,h as N,Q as Ee}from"./app-BWH7wEES.js";import{s as Le}from"./index-BYaWbSq1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";var Ne=function(y){var o=y.dt;return`
.p-avatar {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: `.concat(o("avatar.width"),`;
    height: `).concat(o("avatar.height"),`;
    font-size: `).concat(o("avatar.font.size"),`;
    background: `).concat(o("avatar.background"),`;
    border-radius: `).concat(o("avatar.border.radius"),`;
}

.p-avatar-image {
    background: transparent;
}

.p-avatar-circle {
    border-radius: 50%;
}

.p-avatar-circle img {
    border-radius: 50%;
}

.p-avatar-icon {
    font-size: `).concat(o("avatar.font.size"),`;
}

.p-avatar img {
    width: 100%;
    height: 100%;
}

.p-avatar-lg {
    width: `).concat(o("avatar.lg.width"),`;
    height: `).concat(o("avatar.lg.width"),`;
    font-size: `).concat(o("avatar.lg.font.size"),`;
}

.p-avatar-lg .p-avatar-icon {
    font-size: `).concat(o("avatar.lg.font.size"),`;
}

.p-avatar-xl {
    width: `).concat(o("avatar.xl.width"),`;
    height: `).concat(o("avatar.xl.width"),`;
    font-size: `).concat(o("avatar.xl.font.size"),`;
}

.p-avatar-xl .p-avatar-icon {
    font-size: `).concat(o("avatar.xl.font.size"),`;
}

.p-avatar-group {
    display: flex;
    align-items: center;
}

.p-avatar-group .p-avatar + .p-avatar {
    margin-left: `).concat(o("avatar.group.offset"),`;
}

.p-avatar-group .p-avatar {
    border: 2px solid `).concat(o("avatar.group.border.color"),`;
}
`)},Be={root:function(y){var o=y.props;return["p-avatar p-component",{"p-avatar-image":o.image!=null,"p-avatar-circle":o.shape==="circle","p-avatar-lg":o.size==="large","p-avatar-xl":o.size==="xlarge"}]},label:"p-avatar-label",icon:"p-avatar-icon"},Oe=xe.extend({name:"avatar",theme:Ne,classes:Be}),Te={name:"BaseAvatar",extends:Ue,props:{label:{type:String,default:null},icon:{type:String,default:null},image:{type:String,default:null},size:{type:String,default:"normal"},shape:{type:String,default:"square"},ariaLabelledby:{type:String,default:null},ariaLabel:{type:String,default:null}},style:Oe,provide:function(){return{$pcAvatar:this,$parentInstance:this}}},Q={name:"Avatar",extends:Te,inheritAttrs:!1,emits:["error"],methods:{onError:function(y){this.$emit("error",y)}}},Me=["aria-labelledby","aria-label"],Ge=["src","alt"];function Qe(s,y,o,S,_,w){return i(),m("div",E({class:s.cx("root"),"aria-labelledby":s.ariaLabelledby,"aria-label":s.ariaLabel},s.ptmi("root")),[Fe(s.$slots,"default",{},function(){return[s.label?(i(),m("span",E({key:0,class:s.cx("label")},s.ptm("label")),u(s.label),17)):s.$slots.icon?(i(),b(je(s.$slots.icon),{key:1,class:Ve(s.cx("icon"))},null,8,["class"])):s.icon?(i(),m("span",E({key:2,class:[s.cx("icon"),s.icon]},s.ptm("icon")),null,16)):s.image?(i(),m("img",E({key:3,src:s.image,alt:s.ariaLabel,onError:y[0]||(y[0]=function(){return w.onError&&w.onError.apply(w,arguments)})},s.ptm("image")),null,16,Ge)):g("",!0)]})],16,Me)}Q.render=Qe;const Ke={class:"card"},He={class:"m-4 my-4"},Je={key:0},We=r("i",{class:"pi pi-calendar"},null,-1),Xe={key:1},Ye=r("i",{class:"pi pi-map-marker"},null,-1),Ze=r("i",{class:"pi pi-user"},null,-1),ea=r("i",{class:"pi pi-map-marker mt-2"},null,-1),aa=r("p",{class:"mt-6"}," Order Lines:",-1),ta={key:0},la=r("p",{class:"mt-6 mb-2"}," Other Address:",-1),sa=r("i",{class:"pi pi-building-columns"},null,-1),na=r("p",{class:"mt-6 mb-2"}," Other Address:",-1),ra=r("i",{class:"pi pi-building"},null,-1),ia=r("p",{class:"mb-2 text-xl font-bold"},"States",-1),oa=["for"],da=r("p",{class:"mt-4 mb-2 text-xl font-bold"},"Category",-1),ca=["for"],ua=r("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),ma=["for"],va=r("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),pa={class:"flex justify-between"},fa=r("i",{class:"pi pi-search"},null,-1),ya={style:{display:"flex","align-items":"center"}},ha=["onClick"],ga=["onClick"],_a={key:1,class:"pi pi-truck ml-2"},ba={style:{display:"flex","align-items":"center"}},Sa={key:0,class:"flex align-items-center"},wa={key:0},ka={key:1},Ca={key:1},$a={class:"flex align-items-center"},Da={__name:"ConfirmDeliveryRequirementDataTable",props:{currentUser:Object,deliverSubIds:Object,filterSubs:Object,stateIds:Object,users:Object},setup(s){const y=Ae(),o=(e,t,p)=>{y.require({message:`Do you want to unlink #${t} from #${e}?`,header:"Unlink Sales Order",icon:"pi pi-info-circle",rejectLabel:"Cancel",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Unlink",severity:"danger"},accept:async()=>{await V.delete(`/api/deliverSub/${p}`),k(),C.add({severity:"info",summary:"Unlinked Successfully",detail:`Unlinked #${t} from #${e}`,life:3e3})},reject:()=>{}})};ze();let S=s;const _=d([]),w=d(!0),q=d(1),j=d(0),B=d(),O=d(!1),T=d(!1),se=d(),K=d([]),C=Pe(),A=d([]),M=d(),H=d(),J=d(),W=d(),ne=d([]),re=d([{id:1,name:"Subscription"}]),ie=d([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),oe=d([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),$=d([]),z=d(),D=d([]),x=d([]),U=d([]),P=d(100);Re(()=>{w.value=!1,j.value=S.filterSubs.total,se.value=S.salesQuotations,A.value=S.stateIds});const de=e=>{P.value=e.rows,q.value=e.page+1,console.log("page change"),console.log(q.value),k()},ce=e=>{B.value=e.target.value,console.log(e.target.value),ue()},k=async()=>{try{console.log("fetch data page"),console.log(q.value);const e=te.get("/confirmDeliveryRequirement",{page:q.value,search:B.value,dates:$.value,stateId:D.value,activitySummary:x.value,categories:U.value,perPage:P.value},{preserveState:!0,replace:!1,onSuccess:t=>{console.log(t),console.log(t.props.filterSubs.total),j.value=t.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{w.value=!1}},ue=Se(async()=>{try{console.log("fetch data page"),console.log(q.value);const e=await te.get("/confirmDeliveryRequirement",{page:q.value,search:B.value,dates:$.value,stateId:D.value,activitySummary:x.value,categories:U.value,perPage:P.value},{preserveState:!0,replace:!1,onSuccess:t=>{console.log(t),console.log(t.props.filterSubs.total),j.value=t.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{w.value=!1}},300),X=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,me=e=>{if(!e||e.length===0)return"";const t=new Date(e[0]),p=e[1]?new Date(e[1]):t;return`${t.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${p.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},ve=e=>e.map(t=>{var p;return(p=A.value[t-1])==null?void 0:p.code}).join(", "),pe=()=>{initFilters()},fe=e=>{O.value=!0,M.value=e.sales_order_no,H.value=e.order_line,J.value=e.customer_name,W.value=e.address,ne.value=e.contact_address,z.value=e},ye=async e=>{try{console.log(e.required_delivery.value);const t=await V.put(`/api/updateRequiredDeliveryInDeliverSubs/${e.id}`,{required_delivery:e.required_delivery.value,required_delivery_updated_by_id:S.currentUser.id});e.required_delivery.value=="Confirm"?C.add({severity:"success",summary:`Successfully confirmed #${e.sales_order_no} for delivery`,detail:"",life:3e3}):e.required_delivery.value=="Deny"?C.add({severity:"info",summary:`Successfully denied #${e.sales_order_no}`,detail:"",life:3e3}):C.add({severity:"info",summary:`Updated #${e.sales_order_no}'s require delivery value`,detail:"",life:3e3})}catch(t){console.error("Failed to update required_delivery:",t),C.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};F(M,async e=>{if(e)try{const t=await V.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:e}});K.value=t.data.map(p=>({name:p,value:p})),K.value.push({name:"- Unselect -",value:null})}catch(t){console.error("Error fetching dropdown options:",t)}}),F(D,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),k())}),F(x,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),k())}),F($,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),k())}),F(U,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),k())});const he=e=>e,ge=async()=>{var e=_.value.map(p=>p.id);console.log(e);const t=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:S.currentUser.id});await V.post("/api/bulkConfirmDeliverSubs",t,{headers:{"Content-Type":"application/json"}}),C.add({severity:"success",summary:`Successfully confirmed ${e.length} filter subs`,detail:"",life:3e3}),k(),_.value=[]},_e=async()=>{var e=_.value.map(p=>p.id);console.log(e);const t=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:S.currentUser.id});await V.post("/api/bulkDenyDeliverSubs",t,{headers:{"Content-Type":"application/json"}}),C.add({severity:"success",summary:`Successfully denied ${e.length} filter subs`,detail:"",life:3e3}),k(),_.value=[]},Y=(e,t)=>{const p=t.find(I=>I.id===e);if(p){const I=p.name.split(" ").map(c=>c[0]).join("").toUpperCase();return I.substring(0,2)||I}return""};return(e,t)=>{const p=le("Toast"),I=le("font-awesome-icon");return i(),m("div",Ke,[r("div",null,[r("div",He,[$.value.length?(i(),m("div",Je,[We,h(" "+u(me($.value)),1)])):g("",!0),D.value.length?(i(),m("div",Xe,[Ye,h(" "+u(ve(D.value)),1)])):g("",!0)])]),n(p),n(l(ae),{visible:O.value,"onUpdate:visible":t[0]||(t[0]=a=>O.value=a),header:M.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:v(()=>[r("p",null,[Ze,h(" "+u(J.value),1)]),r("p",null,[ea,h(" "+u(W.value),1)]),aa,n(l(ee),{value:H.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:v(()=>[n(l(f),{field:"product",header:"Product",style:{"min-width":"10rem"}}),n(l(f),{field:"description",header:"Description",style:{"min-width":"10rem"}}),n(l(f),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),r("div",null,[z.value.contact_address[0].parent?(i(),m("p",ta,[la,sa,h(" "+u(z.value.contact_address[0].parent.complete_address),1)])):g("",!0)]),r("div",null,[(i(!0),m(L,null,N(z.value.contact_address[0].children,(a,c)=>(i(),m("p",{key:c},[na,ra,h(" "+u(a.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),n(l(ae),{visible:T.value,"onUpdate:visible":t[5]||(t[5]=a=>T.value=a),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:v(()=>[ia,(i(!0),m(L,null,N(A.value,a=>(i(),m("div",{key:a.id,class:"flex items-center mb-2"},[n(l(G),{modelValue:D.value,"onUpdate:modelValue":t[1]||(t[1]=c=>D.value=c),inputId:a.state_id,name:"stateIds",value:a.state_id},null,8,["modelValue","inputId","value"]),r("label",{for:a.id,class:"ml-2"},u(a.name),9,oa)]))),128)),da,(i(!0),m(L,null,N(re.value,a=>(i(),m("div",{key:a.id,class:"flex items-center mb-2"},[n(l(G),{modelValue:U.value,"onUpdate:modelValue":t[2]||(t[2]=c=>U.value=c),inputId:a.name,name:"category",value:a.name},null,8,["modelValue","inputId","value"]),r("label",{for:a.id,class:"ml-2"},u(a.name),9,ca)]))),128)),ua,(i(!0),m(L,null,N(ie.value,a=>(i(),m("div",{key:a.id,class:"flex items-center mb-2"},[n(l(G),{modelValue:x.value,"onUpdate:modelValue":t[3]||(t[3]=c=>x.value=c),inputId:a.name,name:"category",value:a.name},null,8,["modelValue","inputId","value"]),r("label",{for:a.id,class:"ml-2"},u(a.name),9,ma)]))),128)),va,n(l(we),{modelValue:$.value,"onUpdate:modelValue":t[4]||(t[4]=a=>$.value=a),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),_.value.length?(i(),b(l(R),{key:0,label:`Confirm All (${_.value.length})`,onClick:ge,icon:"pi pi-verified",class:"ml-4"},null,8,["label"])):g("",!0),_.value.length?(i(),b(l(R),{key:1,label:`Deny All (${_.value.length})`,onClick:_e,icon:"pi pi-times-circle",class:"ml-4"},null,8,["label"])):g("",!0),n(l(ke),{rows:P.value,totalRecords:j.value,rowsPerPageOptions:[10,25,50,100],onPage:de},{start:v(a=>[h(u(s.filterSubs.from)+"-"+u(s.filterSubs.to)+" / "+u(s.filterSubs.total),1)]),_:1},8,["rows","totalRecords"]),n(l(ee),{selection:_.value,"onUpdate:selection":t[8]||(t[8]=a=>_.value=a),value:he(s.filterSubs.data),lazy:"",loading:w.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:v(()=>[r("div",pa,[n(l(R),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:t[6]||(t[6]=a=>pe())}),n(l(Ce),null,{default:v(()=>[n(l($e),null,{default:v(()=>[fa]),_:1}),r("div",null,[n(l(R),{onClick:t[7]||(t[7]=a=>T.value=!0),label:"Filter",class:"mr-4"}),n(l(De),{placeholder:"Keyword Search",onInput:ce})])]),_:1})])]),empty:v(()=>[h(" No filterSubs found. ")]),loading:v(()=>[h(" Loading filterSubs data. Please wait. ")]),default:v(()=>[n(l(f),{selectionMode:"multiple",headerStyle:"width: 3rem"}),n(l(f),{field:"root_sales_order.sales_order_no",header:"Root Sales Order #",style:{"min-width":"10rem"}},{body:v(({data:a})=>[r("div",ya,[r("span",null,u(a.root_sales_order.sales_order_no),1),n(l(Le)),r("div",{onClick:c=>o(a.root_sales_order.sales_order_no,a.sales_order_no,a.id),style:{cursor:"pointer","margin-left":"8px"}},[n(I,{icon:["fas","link-slash"],style:{color:"#800000"}})],8,ha)])]),_:1}),n(l(f),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:v(({data:a})=>[r("span",{onClick:c=>fe(a),class:"cursor-pointer hover:underline"},u(a.sales_order_no),9,ga),a.category==="Subscription"?(i(),b(I,{key:0,icon:"fa-filter-circle-dollar",class:"ml-2"})):g("",!0),a.delivered_or_delivery_booked&&a.delivered_or_delivery_booked.value!==null?(i(),m("i",_a)):g("",!0),a.odoo_created_by_id?(i(),b(l(Q),{key:2,label:Y(a.odoo_created_by_id,s.users),class:"ml-2",style:{"background-color":"#dee9fc",color:"#1a2551"}},null,8,["label"])):g("",!0)]),_:1}),e.route().current("confirmDeliveryRequirement")?(i(),b(l(f),{key:0,field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:v(({data:a})=>[r("div",ba,[n(l(Ie),{modelValue:a.required_delivery,"onUpdate:modelValue":c=>a.required_delivery=c,options:oe.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:c=>ye(a)},{value:v(c=>{var Z;return[c.value?(i(),m("div",Sa,[a.required_delivery&&a.required_delivery.value!==null?(i(),m("div",wa,u(((Z=a.required_delivery)==null?void 0:Z.name)||a.required_delivery),1)):(i(),m("div",ka,u(c.placeholder),1))])):(i(),m("span",Ca,u(c.placeholder),1))]}),option:v(c=>[r("div",$a,[r("div",null,u(c.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),a.required_delivery_updated_by_id?(i(),b(l(Q),{key:0,label:Y(a.required_delivery_updated_by_id,s.users),class:"ml-2",style:{"background-color":"#dee9fc",color:"#1a2551"}},null,8,["label"])):g("",!0)])]),_:1})):g("",!0),n(l(f),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),n(l(f),{field:"address",header:"Address",style:{"min-width":"10rem"}}),n(l(f),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),n(l(f),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:v(({data:a})=>[h(u(X(a.due_date)),1)]),_:1}),n(l(f),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),n(l(f),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:v(({data:a})=>[h(u(X(a.invoice_date)),1)]),_:1}),n(l(f),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:v(({data:a})=>{var c;return[h(u((c=A.value[a.state_id-1])==null?void 0:c.name),1)]}),_:1}),n(l(f),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),n(l(f),{field:"email",header:"Email",style:{"min-width":"10rem"}}),n(l(f),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:v(({data:a})=>[a.payment_status==="paid"?(i(),b(l(qe),{key:0,severity:"success",value:"Paid"})):g("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},Ia={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},ja={__name:"ConfirmDeliveryRequirement",props:{filterSubs:Object,filterSubIds:Object,stateIds:Object,users:Object},setup(s){const y=Ee();return(o,S)=>(i(),b(be,{title:"ConfirmDeliveryRequirement"},{default:v(()=>[r("div",Ia,[n(Da,{filterSubs:s.filterSubs,stateIds:s.stateIds,filterSubIds:s.filterSubIds,currentUser:l(y).props.auth.user,users:s.users},null,8,["filterSubs","stateIds","filterSubIds","currentUser","users"])])]),_:1}))}};export{ja as default};
