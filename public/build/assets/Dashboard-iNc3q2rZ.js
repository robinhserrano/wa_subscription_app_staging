import{_ as fe}from"./AppLayout-ChJ3s0TN.js";import{d as he,s as K,a as v,b as z,c as L,e as ye,f as ge,g as H,h as be,i as Se,j as we,k as W,l as Ae}from"./primeicons-BjELKfwS.js";import{A as Xe,d as i,p as Ce,q as ke,s as J,x as k,y as P,z as Y,o as c,e as m,a as n,f as I,g as f,t as d,b as o,w as u,u as l,F,h as Z,c as O,Q as Ie}from"./app-B2uDyFGt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const De={class:"card"},xe={class:"m-4 my-4"},$e={key:0,class:"pi pi-calendar"},Ve=n("i",{class:"pi pi-user"},null,-1),Fe=n("i",{class:"pi pi-map-marker mt-2"},null,-1),Ze=n("p",{class:"mt-6"}," Order Lines:",-1),Oe={key:0},Ue=n("p",{class:"mt-6 mb-2"}," Other Address:",-1),qe=n("i",{class:"pi pi-building-columns"},null,-1),Ne=n("p",{class:"mt-6 mb-2"}," Other Address:",-1),je=n("i",{class:"pi pi-building"},null,-1),Ee=n("p",{class:"mb-2 text-xl font-bold"},"States",-1),Re=["for"],Le=n("p",{class:"mt-4 mb-2 text-xl font-bold"},"Category",-1),Pe=["for"],Be=n("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),Te=["for"],Me=n("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),Qe={class:"flex justify-between"},Ge=n("i",{class:"pi pi-search"},null,-1),Ke=["onClick"],ze={key:0,class:"flex align-items-center"},He={key:0},We={key:1},Je={key:1},Ye={class:"flex align-items-center"},et={key:0,class:"flex align-items-center"},tt={key:0},at={key:1},lt={key:1},ot={class:"flex align-items-center"},st={__name:"SubsToEnterDataTable",props:{filterSubs:Object,stateIds:Object,filterSubIds:Object,currentUser:Object},setup(_){Xe();let h=_;const U=i([]),b=i(!0),g=i(1),D=i(0),q=i(),N=i(!1),j=i(!1),ee=i(),E=i([]),x=Ce(),R=i([]),$=i(),B=i(),T=i(),M=i(),te=i([]),ae=i([{id:1,name:"Subscription"}]),le=i([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),oe=i([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),y=i([]),V=i(),S=i([]),w=i([]),A=i([]);ke(()=>{b.value=!1,D.value=h.filterSubs.total,ee.value=h.salesQuotations,R.value=h.stateIds});const se=t=>{g.value=t.page+1,console.log("page change"),console.log(g.value),X()},ne=t=>{q.value=t.target.value,console.log(t.target.value),ie()},X=async()=>{try{console.log("fetch data page"),console.log(g.value);const t=J.get("/dashboard",{page:g.value,search:q.value,dates:y.value,stateId:S.value,activitySummary:w.value,categories:A.value},{preserveState:!0,replace:!1,onSuccess:a=>{console.log(a),console.log(a.props.filterSubs.total),D.value=a.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{b.value=!1}},ie=he(async()=>{try{console.log("fetch data page"),console.log(g.value);const t=await J.get("/dashboard",{page:g.value,search:q.value,dates:y.value,stateId:S.value,activitySummary:w.value,categories:A.value},{preserveState:!0,replace:!1,onSuccess:a=>{console.log(a),console.log(a.props.filterSubs.total),D.value=a.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{b.value=!1}},300),Q=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,de=t=>{if(!t||t.length===0)return"";const a=new Date(t[0]),p=t[1]?new Date(t[1]):a;return`${a.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${p.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},re=()=>{initFilters()},ce=t=>{N.value=!0,$.value=t.sales_order_no,B.value=t.order_line,T.value=t.customer_name,M.value=t.address,te.value=t.contact_address,V.value=t},ue=t=>{$.value=t.sales_order_no},me=async t=>{var a;try{if((a=t.created_on_odoo)!=null&&a.value){const p=await P.put(`/api/updateCreatedOnOdooInFilterSubs/${t.id}`,{created_on_odoo:t.created_on_odoo.value,odoo_created_by_id:h.currentUser.id});x.add({severity:"success",summary:`Moved #${t.sales_order_no} to Confirm Delivery Requirement`,detail:"",life:3e3})}}catch(p){console.error("Failed to update created_on_odoo:",p),x.add({severity:"error",summary:"Failed to update",detail:"",life:3e3})}},ve=async t=>{try{const a=await P.put(`/api/updateRequiredDeliveryInFilterSubs/${t.id}`,{required_delivery:t.required_delivery.value,required_delivery_updated_by_id:h.currentUser.id});x.add({severity:"success",summary:"Success",detail:"Message Content",life:3e3})}catch(a){r,console.error("Failed to update created_on_odoo:",a),x.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};k($,async t=>{if(t)try{const a=await P.get("/api/findSalesOrdersBySalesOrderNo",{params:{sales_order_no:t}});console.log("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZZZZZZZZZZZZZZZZZZZZZ"),console.log(a),console.log("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"),E.value=a.data.map(p=>({name:p.sales_order_no,value:p.sales_order_no})),E.value.push({name:"- Unselect -",value:null})}catch(a){console.error("Error fetching dropdown options:",a)}}),k(S,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),X())}),k(w,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),X())}),k(y,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),X())}),k(A,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),X())});const _e=t=>t.filter(a=>{var p;return a.created_on_odoo===null||((p=a.created_on_odoo)==null?void 0:p.value)===null}),G=t=>t.filter(a=>a.created_on_odoo!==null&&a.created_on_odoo!==void 0).length;return(t,a)=>{const p=Y("Toast"),pe=Y("font-awesome-icon");return c(),m("div",De,[n("div",null,[n("div",xe,[y.value.length?(c(),m("i",$e)):I("",!0),f(" "+d(de(y.value)),1)])]),o(p),o(l(z),{visible:N.value,"onUpdate:visible":a[0]||(a[0]=e=>N.value=e),header:$.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:u(()=>[n("p",null,[Ve,f(" "+d(T.value),1)]),n("p",null,[Fe,f(" "+d(M.value),1)]),Ze,o(l(K),{value:B.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:u(()=>[o(l(v),{field:"product",header:"Product",style:{"min-width":"10rem"}}),o(l(v),{field:"description",header:"Description",style:{"min-width":"10rem"}}),o(l(v),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),n("div",null,[V.value.contact_address[0].parent?(c(),m("p",Oe,[Ue,qe,f(" "+d(V.value.contact_address[0].parent.complete_address),1)])):I("",!0)]),n("div",null,[(c(!0),m(F,null,Z(V.value.contact_address[0].children,(e,s)=>(c(),m("p",{key:s},[Ne,je,f(" "+d(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),o(l(z),{visible:j.value,"onUpdate:visible":a[5]||(a[5]=e=>j.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:u(()=>[Ee,(c(!0),m(F,null,Z(R.value,e=>(c(),m("div",{key:e.id,class:"flex items-center mb-2"},[o(l(L),{modelValue:S.value,"onUpdate:modelValue":a[1]||(a[1]=s=>S.value=s),inputId:e.state_id,name:"stateIds",value:e.state_id},null,8,["modelValue","inputId","value"]),n("label",{for:e.id,class:"ml-2"},d(e.name),9,Re)]))),128)),Le,(c(!0),m(F,null,Z(ae.value,e=>(c(),m("div",{key:e.id,class:"flex items-center mb-2"},[o(l(L),{modelValue:A.value,"onUpdate:modelValue":a[2]||(a[2]=s=>A.value=s),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),n("label",{for:e.id,class:"ml-2"},d(e.name),9,Pe)]))),128)),Be,(c(!0),m(F,null,Z(le.value,e=>(c(),m("div",{key:e.id,class:"flex items-center mb-2"},[o(l(L),{modelValue:w.value,"onUpdate:modelValue":a[3]||(a[3]=s=>w.value=s),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),n("label",{for:e.id,class:"ml-2"},d(e.name),9,Te)]))),128)),Me,o(l(ye),{modelValue:y.value,"onUpdate:modelValue":a[4]||(a[4]=e=>y.value=e),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),o(l(ge),{rows:100,totalRecords:D.value,rowsPerPageOptions:[10,25,50,100],onPage:se},{start:u(e=>[f(d(_.filterSubs.from)+"-"+d(_.filterSubs.to-G(_.filterSubs.data))+" / "+d(_.filterSubs.total-G(_.filterSubs.data)),1)]),_:1},8,["totalRecords"]),o(l(K),{selection:U.value,"onUpdate:selection":a[8]||(a[8]=e=>U.value=e),value:_e(_.filterSubs.data),lazy:"",loading:b.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:u(()=>[n("div",Qe,[o(l(H),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:a[6]||(a[6]=e=>re())}),o(l(be),null,{default:u(()=>[o(l(Se),null,{default:u(()=>[Ge]),_:1}),n("div",null,[o(l(H),{onClick:a[7]||(a[7]=e=>j.value=!0),label:"Filter",class:"mr-4"}),o(l(we),{placeholder:"Keyword Search",onInput:ne})])]),_:1})])]),empty:u(()=>[f(" No filterSubs found. ")]),loading:u(()=>[f(" Loading filterSubs data. Please wait. ")]),default:u(()=>[o(l(v),{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(l(v),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:u(({data:e})=>[n("span",{onClick:s=>ce(e),class:"cursor-pointer hover:underline"},d(e.sales_order_no),9,Ke),e.category==="Subscription"?(c(),O(pe,{key:0,icon:"fa-filter-circle-dollar",class:"ml-2"})):I("",!0)]),_:1}),o(l(v),{field:"",header:"Created on Odoo",style:{"min-width":"10rem"}},{body:u(({data:e})=>[o(l(W),{modelValue:e.created_on_odoo,"onUpdate:modelValue":s=>e.created_on_odoo=s,options:E.value,filter:"",optionLabel:"name",placeholder:"Select Sales Order #",class:"w-full md:w-14rem",onClick:s=>ue(e),onChange:s=>me(e)},{value:u(s=>{var C;return[s.value?(c(),m("div",ze,[e.created_on_odoo&&e.created_on_odoo.value!==null?(c(),m("div",He,d(((C=e.created_on_odoo)==null?void 0:C.name)||e.created_on_odoo),1)):(c(),m("div",We,d(s.placeholder),1))])):(c(),m("span",Je,d(s.placeholder),1))]}),option:u(s=>[n("div",Ye,[n("div",null,d(s.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onClick","onChange"])]),_:1}),t.route().current("confirmDeliveryRequirement")?(c(),O(l(v),{key:0,field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:u(({data:e})=>[o(l(W),{modelValue:e.required_delivery,"onUpdate:modelValue":s=>e.required_delivery=s,options:oe.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:s=>ve(e)},{value:u(s=>{var C;return[s.value?(c(),m("div",et,[e.required_delivery&&e.required_delivery.value!==null?(c(),m("div",tt,d(((C=e.required_delivery)==null?void 0:C.name)||e.required_delivery),1)):(c(),m("div",at,d(s.placeholder),1))])):(c(),m("span",lt,d(s.placeholder),1))]}),option:u(s=>[n("div",ot,[n("div",null,d(s.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1})):I("",!0),o(l(v),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),o(l(v),{field:"address",header:"Address",style:{"min-width":"10rem"}}),o(l(v),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),o(l(v),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:u(({data:e})=>[f(d(Q(e.due_date)),1)]),_:1}),o(l(v),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),o(l(v),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:u(({data:e})=>[f(d(Q(e.invoice_date)),1)]),_:1}),o(l(v),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:u(({data:e})=>{var s;return[f(d((s=R.value[e.state_id-1])==null?void 0:s.name),1)]}),_:1}),o(l(v),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),o(l(v),{field:"email",header:"Email",style:{"min-width":"10rem"}}),o(l(v),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:u(({data:e})=>[e.payment_status==="paid"?(c(),O(l(Ae),{key:0,severity:"success",value:"Paid"})):I("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},nt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},ut={__name:"Dashboard",props:{filterSubs:Object,stateIds:Object,activitySummaries:Object,filterSubIds:Object},setup(_){const h=Ie();return(U,b)=>(c(),O(fe,{title:"Dashboard"},{default:u(()=>[n("div",nt,[o(st,{filterSubs:_.filterSubs,stateIds:_.stateIds,activitySummaries:_.activitySummaries,filterSubIds:_.filterSubIds,currentUser:l(h).props.auth.user},null,8,["filterSubs","stateIds","activitySummaries","filterSubIds","currentUser"])])]),_:1}))}};export{ut as default};
