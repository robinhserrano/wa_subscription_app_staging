import{_ as be}from"./AppLayout-BarFfHJo.js";import{d as ge,s as Y,a as u,b as Z,c as ee,e as Se,f as A,g as we,h as ke,i as Ce,j as De,k as $e,l as Ie}from"./primeicons-FTOeLvjK.js";import{p as Fe,q as xe,d as o,s as qe,x as Ue,y as te,z as I,A as F,B as le,C as je,o as r,e as v,a as i,g as f,t as d,f as y,b as a,w as n,u as s,F as Q,h as G,c as h,l as x,Q as Ve}from"./app-SeORGwS4.js";import{s as Pe}from"./index-67aqIuA2.js";import{s as se}from"./index-Cf2_JBCY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ae={class:"card"},Ne={class:"m-4 my-4"},Oe={key:0},Le=i("i",{class:"pi pi-calendar"},null,-1),Re={key:1},Ee=i("i",{class:"pi pi-map-marker"},null,-1),Be=i("i",{class:"pi pi-user"},null,-1),Te=i("i",{class:"pi pi-map-marker mt-2"},null,-1),Me=i("p",{class:"mt-6"}," Order Lines:",-1),Qe={key:0},Ge=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),Ke=i("i",{class:"pi pi-building-columns"},null,-1),ze=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),He=i("i",{class:"pi pi-building"},null,-1),Je=i("p",{class:"mb-2 text-xl font-bold"},"States",-1),We=["for"],Xe=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),Ye=["for"],Ze=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),et={class:"flex justify-between"},tt=i("i",{class:"pi pi-search"},null,-1),lt={style:{display:"flex","align-items":"center"}},st=["onClick"],at=["onClick"],it={class:"flex items-center"},ot={key:2,class:"pi pi-truck ml-2"},rt=["src"],nt={style:{display:"flex","align-items":"center"}},dt={key:0,class:"flex align-items-center"},ct={key:0},ut={key:1},mt={key:1},vt={class:"flex align-items-center"},ft=["src"],pt={__name:"ConfirmDeliveryFilterSubscriptionDataTable",props:{currentUser:Object,deliverSubIds:Object,filterSubs:Object,stateIds:Object,users:Object},setup(p){const N=Fe(),K=(e,l,m)=>{N.require({message:`Do you want to unlink #${l} from #${e}?`,header:"Unlink Sales Order",icon:"pi pi-info-circle",rejectLabel:"Cancel",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Unlink",severity:"danger"},accept:async()=>{await F.delete(`/api/deliverSub/${m}`),b(),S.add({severity:"info",summary:"Unlinked Successfully",detail:`Unlinked #${l} from #${e}`,life:3e3})},reject:()=>{}})};xe();let g=p;const _=o([]),q=o(!0),C=o(1),U=o(0),O=o(),L=o(!1),R=o(!1),ae=o(),z=o([]),S=qe(),j=o([]),E=o(),H=o(),J=o(),W=o(),ie=o([]);o([{id:1,name:"Subscription"}]);const oe=o([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),re=o([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),w=o([]),V=o(),k=o([]),D=o([]),B=o([]),P=o(100);Ue(()=>{q.value=!1,U.value=g.filterSubs.total,ae.value=g.salesQuotations,j.value=g.stateIds});const ne=e=>{P.value=e.rows,C.value=e.page+1,console.log("page change"),console.log(C.value),b()},de=e=>{O.value=e.target.value,console.log(e.target.value),ce()},b=async()=>{try{console.log("fetch data page"),console.log(C.value);const e=te.get("/confirmDeliveryFilterSubscription",{page:C.value,search:O.value,dates:w.value,stateId:k.value,activitySummary:D.value,categories:B.value,perPage:P.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),U.value=l.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{q.value=!1}},ce=ge(async()=>{try{console.log("fetch data page"),console.log(C.value);const e=await te.get("/confirmDeliveryFilterSubscription",{page:C.value,search:O.value,dates:w.value,stateId:k.value,activitySummary:D.value,categories:B.value,perPage:P.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),U.value=l.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{q.value=!1}},300),T=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,ue=e=>{if(!e||e.length===0)return"";const l=new Date(e[0]),m=e[1]?new Date(e[1]):l;return`${l.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${m.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},me=e=>e.map(l=>{var m;return(m=j.value[l-1])==null?void 0:m.code}).join(", "),ve=()=>{initFilters()},fe=e=>{L.value=!0,E.value=e.sales_order_no,H.value=e.order_line,J.value=e.customer_name,W.value=e.address,ie.value=e.contact_address,V.value=e},pe=async e=>{try{console.log(e.required_delivery.value);const l=await F.put(`/api/updateRequiredDeliveryInDeliverSubs/${e.id}`,{required_delivery:e.required_delivery.value,required_delivery_updated_by_id:g.currentUser.id});e.required_delivery.value=="Confirm"?S.add({severity:"success",summary:`Successfully confirmed #${e.sales_order_no} for delivery`,detail:"",life:3e3}):e.required_delivery.value=="Deny"?S.add({severity:"info",summary:`Successfully denied #${e.sales_order_no}`,detail:"",life:3e3}):S.add({severity:"info",summary:`Updated #${e.sales_order_no}'s require delivery value`,detail:"",life:3e3})}catch(l){console.error("Failed to update required_delivery:",l),S.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};I(E,async e=>{if(e)try{const l=await F.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:e}});z.value=l.data.map(m=>({name:m,value:m})),z.value.push({name:"- Unselect -",value:null})}catch(l){console.error("Error fetching dropdown options:",l)}}),I(k,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),b())}),I(D,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),b())}),I(w,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),b())}),I(B,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),b())});const _e=e=>e,ye=async()=>{var e=_.value.map(m=>m.id);console.log(e);const l=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:g.currentUser.id});await F.post("/api/bulkConfirmDeliverSubs",l,{headers:{"Content-Type":"application/json"}}),S.add({severity:"success",summary:`Successfully confirmed ${e.length} filter subs`,detail:"",life:3e3}),b(),_.value=[]},he=async()=>{var e=_.value.map(m=>m.id);console.log(e);const l=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:g.currentUser.id});await F.post("/api/bulkDenyDeliverSubs",l,{headers:{"Content-Type":"application/json"}}),S.add({severity:"success",summary:`Successfully denied ${e.length} filter subs`,detail:"",life:3e3}),b(),_.value=[]};return(e,l)=>{const m=le("Toast"),M=le("font-awesome-icon"),$=je("tooltip");return r(),v("div",Ae,[i("div",null,[i("div",Ne,[w.value.length?(r(),v("div",Oe,[Le,f(" "+d(ue(w.value)),1)])):y("",!0),k.value.length?(r(),v("div",Re,[Ee,f(" "+d(me(k.value)),1)])):y("",!0)])]),a(m),a(s(Z),{visible:L.value,"onUpdate:visible":l[0]||(l[0]=t=>L.value=t),header:E.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:n(()=>[i("p",null,[Be,f(" "+d(J.value),1)]),i("p",null,[Te,f(" "+d(W.value),1)]),Me,a(s(Y),{value:H.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:n(()=>[a(s(u),{field:"product",header:"Product",style:{"min-width":"10rem"}}),a(s(u),{field:"description",header:"Description",style:{"min-width":"10rem"}}),a(s(u),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),i("div",null,[V.value.contact_address[0].parent?(r(),v("p",Qe,[Ge,Ke,f(" "+d(V.value.contact_address[0].parent.complete_address),1)])):y("",!0)]),i("div",null,[(r(!0),v(Q,null,G(V.value.contact_address[0].children,(t,c)=>(r(),v("p",{key:c},[ze,He,f(" "+d(t.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),a(s(Z),{visible:R.value,"onUpdate:visible":l[4]||(l[4]=t=>R.value=t),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:n(()=>[Je,(r(!0),v(Q,null,G(j.value,t=>(r(),v("div",{key:t.id,class:"flex items-center mb-2"},[a(s(ee),{modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=c=>k.value=c),inputId:t.state_id,name:"stateIds",value:t.state_id},null,8,["modelValue","inputId","value"]),i("label",{for:t.id,class:"ml-2"},d(t.name),9,We)]))),128)),Xe,(r(!0),v(Q,null,G(oe.value,t=>(r(),v("div",{key:t.id,class:"flex items-center mb-2"},[a(s(ee),{modelValue:D.value,"onUpdate:modelValue":l[2]||(l[2]=c=>D.value=c),inputId:t.name,name:"category",value:t.name},null,8,["modelValue","inputId","value"]),i("label",{for:t.id,class:"ml-2"},d(t.name),9,Ye)]))),128)),Ze,a(s(Se),{modelValue:w.value,"onUpdate:modelValue":l[3]||(l[3]=t=>w.value=t),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),_.value.length?(r(),h(s(A),{key:0,label:`Confirm All (${_.value.length})`,onClick:ye,icon:"pi pi-verified",class:"ml-4"},null,8,["label"])):y("",!0),_.value.length?(r(),h(s(A),{key:1,label:`Deny All (${_.value.length})`,onClick:he,icon:"pi pi-times-circle",class:"ml-4"},null,8,["label"])):y("",!0),a(s(we),{rows:P.value,totalRecords:U.value,rowsPerPageOptions:[10,25,50,100],onPage:ne},{start:n(t=>[f(d(p.filterSubs.from)+"-"+d(p.filterSubs.to)+" / "+d(p.filterSubs.total),1)]),_:1},8,["rows","totalRecords"]),a(s(Y),{selection:_.value,"onUpdate:selection":l[7]||(l[7]=t=>_.value=t),value:_e(p.filterSubs.data),lazy:"",loading:q.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:n(()=>[i("div",et,[a(s(A),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:l[5]||(l[5]=t=>ve())}),a(s(ke),null,{default:n(()=>[a(s(Ce),null,{default:n(()=>[tt]),_:1}),i("div",null,[a(s(A),{onClick:l[6]||(l[6]=t=>R.value=!0),label:"Filter",class:"mr-4"}),a(s(De),{placeholder:"Keyword Search",onInput:de})])]),_:1})])]),empty:n(()=>[f(" No filterSubs found. ")]),loading:n(()=>[f(" Loading filterSubs data. Please wait. ")]),default:n(()=>[a(s(u),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(s(u),{field:"root_sales_order.sales_order_no",header:"Root Sales Order #",style:{"min-width":"10rem"}},{body:n(({data:t})=>[i("div",lt,[i("span",null,d(t.root_sales_order.sales_order_no),1),a(s(Pe)),i("div",{onClick:c=>K(t.root_sales_order.sales_order_no,t.sales_order_no,t.id),style:{cursor:"pointer","margin-left":"8px"}},[a(M,{icon:["fas","link-slash"],style:{color:"#800000"}})],8,st)])]),_:1}),a(s(u),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:n(({data:t})=>[i("span",{onClick:c=>fe(t),class:"cursor-pointer hover:underline"},d(t.sales_order_no),9,at),i("div",it,[t.hasCallOutService?x((r(),h(M,{key:0,icon:["fas","toolbox"]},null,512)),[[$,"Filter Sub (Filter + Call Out Service)"]]):x((r(),h(M,{key:1,icon:["fas","faucet"]},null,512)),[[$,"Filter Sub (Filter Only)"]]),t.delivered_or_delivery_booked&&t.delivered_or_delivery_booked.value!==null?x((r(),v("i",ot,null,512)),[[$,"Delivery Booked"]]):y("",!0),t.odoo_created_by_id?x((r(),h(s(se),{key:3,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:n(()=>[i("img",{src:t.odoo_created_by.profile_photo_url,alt:"User Initials"},null,8,rt)]),_:2},1024)),[[$,`Last updated by:
${t.odoo_created_by.name}`]]):y("",!0)])]),_:1}),e.route().current("confirmDeliveryFilterSubscription")?(r(),h(s(u),{key:0,field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:n(({data:t})=>[i("div",nt,[a(s($e),{modelValue:t.required_delivery,"onUpdate:modelValue":c=>t.required_delivery=c,options:re.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:c=>pe(t)},{value:n(c=>{var X;return[c.value?(r(),v("div",dt,[t.required_delivery&&t.required_delivery.value!==null?(r(),v("div",ct,d(((X=t.required_delivery)==null?void 0:X.name)||t.required_delivery),1)):(r(),v("div",ut,d(c.placeholder),1))])):(r(),v("span",mt,d(c.placeholder),1))]}),option:n(c=>[i("div",vt,[i("div",null,d(c.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),t.required_delivery_updated_by_id?x((r(),h(s(se),{key:0,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:n(()=>[i("img",{src:t.required_delivery_updated_by.profile_photo_url,alt:"User Initials"},null,8,ft)]),_:2},1024)),[[$,`Last updated by:
${t.required_delivery_updated_by.name}`]]):y("",!0)])]),_:1})):y("",!0),a(s(u),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),a(s(u),{field:"address",header:"Address",style:{"min-width":"10rem"}}),a(s(u),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),a(s(u),{field:"start_date",header:"Start Date",style:{"min-width":"10rem"}},{body:n(({data:t})=>[f(d(T(t.start_date)),1)]),_:1}),a(s(u),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:n(({data:t})=>[f(d(T(t.due_date)),1)]),_:1}),a(s(u),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),a(s(u),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:n(({data:t})=>[f(d(T(t.invoice_date)),1)]),_:1}),a(s(u),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:n(({data:t})=>{var c;return[f(d((c=j.value[t.state_id-1])==null?void 0:c.name),1)]}),_:1}),a(s(u),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),a(s(u),{field:"email",header:"Email",style:{"min-width":"10rem"}}),a(s(u),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:n(({data:t})=>[t.payment_status==="paid"?(r(),h(s(Ie),{key:0,severity:"success",value:"Paid"})):y("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},_t={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},kt={__name:"ConfirmDeliveryFilterSubscription",props:{filterSubs:Object,filterSubIds:Object,stateIds:Object,users:Object},setup(p){const N=Ve();return(K,g)=>(r(),h(be,{title:"confirmDeliveryFilterSubscription"},{default:n(()=>[i("div",_t,[a(pt,{filterSubs:p.filterSubs,stateIds:p.stateIds,filterSubIds:p.filterSubIds,currentUser:s(N).props.auth.user,users:p.users},null,8,["filterSubs","stateIds","filterSubIds","currentUser","users"])])]),_:1}))}};export{kt as default};
