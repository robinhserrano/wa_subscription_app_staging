import{_ as Ue}from"./AppLayout-BarFfHJo.js";import{d as Fe,s as ie,a as _,b as de,c as ne,e as Oe,f as L,g as Ve,h as je,i as Re,j as Ze,k as ce,l as Te}from"./primeicons-FTOeLvjK.js";import{p as Le,d as c,s as Be,x as ze,y as ue,z as F,A as O,B as ve,C as Pe,o as i,e as v,a as s,g as p,t as n,f,b as a,w as u,u as l,F as K,h as q,c as g,l as V,Q as Ee}from"./app-SeORGwS4.js";import{u as B}from"./xlsx-YQvpTstd.js";import{s as Ne}from"./index-67aqIuA2.js";import{s as H}from"./index-Cf2_JBCY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const We={class:"card"},Me={class:"m-4 my-4"},Qe={key:0},Ge=s("i",{class:"pi pi-calendar"},null,-1),Ke={key:1},qe=s("i",{class:"pi pi-map-marker"},null,-1),He=s("i",{class:"pi pi-user"},null,-1),Je=s("i",{class:"pi pi-map-marker mt-2"},null,-1),Ye=s("p",{class:"mt-6"}," Order Lines:",-1),et={key:0},tt=s("p",{class:"mt-6 mb-2"}," Other Address:",-1),ot=s("i",{class:"pi pi-building-columns"},null,-1),lt=s("p",{class:"mt-6 mb-2"}," Other Address:",-1),st=s("i",{class:"pi pi-building"},null,-1),at=s("p",{class:"mb-2 text-xl font-bold"},"States",-1),rt=["for"],it=s("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),dt=["for"],nt=s("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),ct={class:"flex justify-between"},ut=s("i",{class:"pi pi-search"},null,-1),vt={style:{display:"flex","align-items":"center"}},_t=["onClick"],mt=["onClick"],pt={class:"flex items-center"},ft={key:2,class:"pi pi-truck ml-2"},ht=["src"],yt={class:"flex items-center"},bt={key:0,class:"flex align-items-center"},gt={key:0},kt={key:1},St={key:1},wt={class:"flex align-items-center"},Ct=["src"],At={class:"flex items-center"},Dt={key:0,class:"flex align-items-center"},Xt={key:0},It={key:1},$t={key:0},xt={key:2},Ut={key:0},Ft={key:3},Ot={key:1},Vt={class:"flex align-items-center"},jt={key:0,class:"ml-1"},Rt=["src"],Zt={__name:"SubsToDeliverFilterSubscriptionDataTable",props:{filterSubs:Object,stateIds:Object,filterSubIds:Object,currentUser:Object,users:Object,serviceCodes:Object},setup(h){const z=Le(),J=(t,o,m)=>{z.require({message:`Do you want to unlink #${o} from #${t}?`,header:"Unlink Sales Order",icon:"pi pi-info-circle",rejectLabel:"Cancel",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Unlink",severity:"danger"},accept:async()=>{await O.delete(`/api/deliverSub/${m}`),S(),X.add({severity:"info",summary:"Unlinked Successfully",detail:`Unlinked #${o} from #${t}`,life:3e3})},reject:()=>{}})};let b=h;const k=c([]);c();const j=c(!0),D=c(1),$=c(0),P=c(),E=c(!1),N=c(!1),_e=c(),Y=c([]),X=Be(),R=c([]),W=c(),ee=c(),te=c(),oe=c(),me=c([]),M=c([]);c(),c([{id:1,name:"Subscription"}]);const pe=c([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]);c([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]);const fe=c([{name:"Delivery Booked",value:"Delivery Booked"},{name:"- Unselect -",value:null}]),w=c([]),Z=c(),C=c([]),x=c([]),Q=c([]),T=c(100);ze(()=>{j.value=!1,$.value=b.filterSubs.total,_e.value=b.salesQuotations,R.value=b.stateIds,M.value=b.serviceCodes.map(t=>({name:t.service_code,value:t.id,totalWeight:t.total_weight})),M.value.push({name:"- Unselect -",value:null,totalWeight:null}),console.log("aaaaaaaaa"),console.log(b.serviceCodes),console.log("zzzzzzzzzzz")});const he=t=>{T.value=t.rows,D.value=t.page+1,console.log("page change"),console.log(D.value),S()},ye=t=>{P.value=t.target.value,console.log(t.target.value),be()},S=async()=>{try{console.log("fetch data page"),console.log(D.value);const t=await ue.get("/subscriptionsToDeliver",{page:D.value,search:P.value,dates:w.value,stateId:C.value,activitySummary:x.value,categories:Q.value,perPage:T.value},{preserveState:!0,replace:!1,onSuccess:o=>{console.log(o),console.log(o.props.filterSubs.total),$.value=o.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{j.value=!1}},be=Fe(async()=>{try{console.log("fetch data page"),console.log(D.value);const t=await ue.get("/subscriptionsToDeliver",{page:D.value,search:P.value,dates:w.value,stateId:C.value,activitySummary:x.value,categories:Q.value,perPage:T.value},{preserveState:!0,replace:!1,onSuccess:o=>{console.log(o),console.log(o.props.filterSubs.total),$.value=o.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{j.value=!1}},300),G=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,ge=t=>{if(!t||t.length===0)return"";const o=new Date(t[0]),m=t[1]?new Date(t[1]):o;return`${o.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${m.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},ke=t=>t.map(o=>{var m;return(m=R.value[o-1])==null?void 0:m.code}).join(", "),Se=()=>{initFilters()},we=t=>{E.value=!0,W.value=t.sales_order_no,ee.value=t.order_line,te.value=t.customer_name,oe.value=t.address,me.value=t.contact_address,Z.value=t},Ce=async t=>{try{const o=await O.put(`/api/updateDeliveredOrDeliveryBooked/${t.id}`,{delivered_or_delivery_booked:t.delivered_or_delivery_booked.value,delivered_or_delivery_booked_by_id:b.currentUser.id});X.add({severity:"success",summary:`Updated #${t.sales_order_no} delivered or delivery booked status`,detail:"",life:3e3})}catch(o){console.error("Failed to update delivered_or_delivery_booked:",o),X.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}},Ae=async t=>{try{console.log(t);const o=await O.put(`/api/updateServiceCode/${t.id}`,{service_code_id:t.service_code_id.value,service_code_updated_by_id:b.currentUser.id});X.add({severity:"success",summary:`Updated #${t.sales_order_no}'s service code`,detail:"",life:3e3}),S()}catch(o){console.error("Failed to update delivered_or_delivery_booked:",o),X.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};F(W,async t=>{if(t)try{const o=await O.get("/api/findSalesOrdersBySalesOrderNo",{params:{sales_order_no:t}});console.log("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZZZZZZZZZZZZZZZZZZZZZ"),console.log(o),console.log("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"),Y.value=o.data.map(m=>({name:m.sales_order_no,value:m.sales_order_no})),Y.value.push({name:"- Unselect -",value:null})}catch(o){console.error("Error fetching dropdown options:",o)}}),F(C,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),S())}),F(x,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),S())}),F(w,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),S())}),F(Q,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),S())});const De=t=>t,Xe=()=>{const t={"Record Type":"recordType","Receiver Code":"receiverCode","Receiver Name":"customer_name","Receiver Address 1":"street","Receiver Address 2":"street2","Receiver Address 3":"receiverAddress3","Receiver Suburb":"city","Receiver Postcode":"zip","Receiver Contact":"receiverContact","Receiver Phone":"phone",Email:"email","Reference 1":"sales_order_no","Reference 2":"","Special Instructions":"","Service Code":"serviceCode","Number of Items":"numberOfItems","Total Weight":"totalWeight","Total Cubic Volume":"totalCubicVolume","Authority to Leave":"authorityToLeave"},o=k.value.map(d=>{var le,se,ae,re;console.log(d),console.log(d.contact_address),d.recordType="C",d.receiverCode=null,d.street=d.contact_address[0].street,d.street2=d.contact_address[0].street2,d.receiverAddress3=null,d.city=d.contact_address[0].city,d.zip=d.contact_address[0].zip,d.receiverContact=d.customer_name,d.reference2=null,d.specialInstructions=null,d.serviceCode=(le=d.service_code)==null?void 0:le.service_code,d.numberOfItems=(se=d.service_code)==null?void 0:se.number_of_items,d.totalWeight=(ae=d.service_code)==null?void 0:ae.total_weight,d.totalCubicVolume=(re=d.service_code)==null?void 0:re.total_cubic_volume,d.authorityToLeave="Y";let I={};for(const[$e,xe]of Object.entries(t))I[$e]=d[xe];return console.log(I),I}),m=B.json_to_sheet(o),U=B.book_new();B.book_append_sheet(U,m,"Sheet1");const A=B.sheet_to_csv(m),e=new Blob([A],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(e),y=document.createElement("a");y.href=r,y.setAttribute("download","subs_to_deliver.csv"),document.body.appendChild(y),y.click(),document.body.removeChild(y)},Ie=async()=>{var t=k.value.map(m=>m.id);console.log(t);const o=JSON.stringify({filterSubIds:t,delivered_or_delivery_booked_by_id:b.currentUser.id});await O.post("/api/bulkConfirmDeliveryBooked",o,{headers:{"Content-Type":"application/json"}}),X.add({severity:"success",summary:`Successfully confirmed ${t.length} filter subs`,detail:"",life:3e3}),S(),k.value=[]};return(t,o)=>{const m=ve("Toast"),U=ve("font-awesome-icon"),A=Pe("tooltip");return i(),v("div",We,[s("div",null,[s("div",Me,[w.value.length?(i(),v("div",Qe,[Ge,p(" "+n(ge(w.value)),1)])):f("",!0),C.value.length?(i(),v("div",Ke,[qe,p(" "+n(ke(C.value)),1)])):f("",!0)])]),a(m),a(l(de),{visible:E.value,"onUpdate:visible":o[0]||(o[0]=e=>E.value=e),header:W.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:u(()=>[s("p",null,[He,p(" "+n(te.value),1)]),s("p",null,[Je,p(" "+n(oe.value),1)]),Ye,a(l(ie),{value:ee.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:u(()=>[a(l(_),{field:"product",header:"Product",style:{"min-width":"10rem"}}),a(l(_),{field:"description",header:"Description",style:{"min-width":"10rem"}}),a(l(_),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),s("div",null,[Z.value.contact_address[0].parent?(i(),v("p",et,[tt,ot,p(" "+n(Z.value.contact_address[0].parent.complete_address),1)])):f("",!0)]),s("div",null,[(i(!0),v(K,null,q(Z.value.contact_address[0].children,(e,r)=>(i(),v("p",{key:r},[lt,st,p(" "+n(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),a(l(de),{visible:N.value,"onUpdate:visible":o[4]||(o[4]=e=>N.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:u(()=>[at,(i(!0),v(K,null,q(R.value,e=>(i(),v("div",{key:e.id,class:"flex items-center mb-2"},[a(l(ne),{modelValue:C.value,"onUpdate:modelValue":o[1]||(o[1]=r=>C.value=r),inputId:e.state_id,name:"stateIds",value:e.state_id},null,8,["modelValue","inputId","value"]),s("label",{for:e.id,class:"ml-2"},n(e.name),9,rt)]))),128)),it,(i(!0),v(K,null,q(pe.value,e=>(i(),v("div",{key:e.id,class:"flex items-center mb-2"},[a(l(ne),{modelValue:x.value,"onUpdate:modelValue":o[2]||(o[2]=r=>x.value=r),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),s("label",{for:e.id,class:"ml-2"},n(e.name),9,dt)]))),128)),nt,a(l(Oe),{modelValue:w.value,"onUpdate:modelValue":o[3]||(o[3]=e=>w.value=e),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),k.value.length?(i(),g(l(L),{key:0,label:"Export as Excel",onClick:Xe,class:"ml-4"})):f("",!0),k.value.length?(i(),g(l(L),{key:1,label:`Mark All As Delivery Booked (${k.value.length})`,onClick:Ie,icon:"pi pi-truck",class:"ml-4"},null,8,["label"])):f("",!0),a(l(Ve),{rows:T.value,totalRecords:$.value,rowsPerPageOptions:[10,25,50,100,$.value].sort((e,r)=>e-r),onPage:he},{start:u(e=>[p(n(h.filterSubs.from)+"-"+n(h.filterSubs.to)+" / "+n(h.filterSubs.total),1)]),_:1},8,["rows","totalRecords","rowsPerPageOptions"]),a(l(ie),{selection:k.value,"onUpdate:selection":o[7]||(o[7]=e=>k.value=e),value:De(h.filterSubs.data),lazy:"",loading:j.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:u(()=>[s("div",ct,[a(l(L),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:o[5]||(o[5]=e=>Se())}),a(l(je),null,{default:u(()=>[a(l(Re),null,{default:u(()=>[ut]),_:1}),s("div",null,[a(l(L),{onClick:o[6]||(o[6]=e=>N.value=!0),label:"Filter",class:"mr-4"}),a(l(Ze),{placeholder:"Keyword Search",onInput:ye})])]),_:1})])]),empty:u(()=>[p(" No filterSubs found. ")]),loading:u(()=>[p(" Loading filterSubs data. Please wait. ")]),default:u(()=>[a(l(_),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(l(_),{field:"root_sales_order.sales_order_no",header:"Root Sales Order #",style:{"min-width":"10rem"}},{body:u(({data:e})=>[s("div",vt,[s("span",null,n(e.root_sales_order.sales_order_no),1),a(l(Ne)),s("div",{onClick:r=>J(e.root_sales_order.sales_order_no,e.sales_order_no,e.id),style:{cursor:"pointer","margin-left":"8px"}},[a(U,{icon:["fas","link-slash"],style:{color:"#800000"}})],8,_t)])]),_:1}),a(l(_),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:u(({data:e})=>[s("span",{onClick:r=>we(e),class:"cursor-pointer hover:underline"},n(e.sales_order_no),9,mt),s("div",pt,[e.hasCallOutService?V((i(),g(U,{key:0,icon:["fas","toolbox"]},null,512)),[[A,"Filter Sub (Filter + Call Out Service)"]]):V((i(),g(U,{key:1,icon:["fas","faucet"]},null,512)),[[A,"Filter Sub (Filter Only)"]]),e.delivered_or_delivery_booked&&e.delivered_or_delivery_booked.value!==null?(i(),v("i",ft)):f("",!0),e.odoo_created_by_id?V((i(),g(l(H),{key:3,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:u(()=>[s("img",{src:e.odoo_created_by.profile_photo_url,alt:"User Initials"},null,8,ht)]),_:2},1024)),[[A,`Last updated by:
${e.odoo_created_by.name}`]]):f("",!0)])]),_:1}),a(l(_),{field:"",header:"Delivered or Delivery Booked",style:{"min-width":"10rem"}},{body:u(({data:e})=>[s("div",yt,[a(l(ce),{modelValue:e.delivered_or_delivery_booked,"onUpdate:modelValue":r=>e.delivered_or_delivery_booked=r,options:fe.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:r=>Ce(e)},{value:u(r=>{var y;return[r.value?(i(),v("div",bt,[e.delivered_or_delivery_booked&&e.delivered_or_delivery_booked.value!==null?(i(),v("div",gt,n(((y=e.delivered_or_delivery_booked)==null?void 0:y.name)||e.delivered_or_delivery_booked),1)):(i(),v("div",kt,n(r.placeholder),1))])):(i(),v("span",St,n(r.placeholder),1))]}),option:u(r=>[s("div",wt,[s("div",null,n(r.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),e.delivered_or_delivery_booked_by_id?V((i(),g(l(H),{key:0,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:u(()=>[s("img",{src:e.delivered_or_delivery_booked_by.profile_photo_url,alt:"User Initials"},null,8,Ct)]),_:2},1024)),[[A,`Last updated by:
${e.delivered_or_delivery_booked_by.name}`]]):f("",!0)])]),_:1}),a(l(_),{field:"",header:"Service Code",style:{"min-width":"10rem"}},{body:u(({data:e})=>[s("div",At,[a(l(ce),{modelValue:e.service_code_id,"onUpdate:modelValue":r=>e.service_code_id=r,options:M.value,filter:"",optionLabel:"name",placeholder:"Select Code",class:"w-full md:w-14rem",onChange:r=>Ae(e)},{value:u(r=>{var y,d,I;return[r.value?(i(),v("div",Dt,[e.service_code_id.name=="- Unselect -"&&e.service_code_id.value==null?(i(),v("div",Xt,n(r.placeholder),1)):e.service_code_id&&e.service_code_id.value==null?(i(),v("div",It,[s("div",null,n(e.service_code.service_code),1),e.service_code.total_weight?(i(),v("div",$t,"("+n(e.service_code.total_weight)+"kg) ",1)):f("",!0)])):e.service_code_id.value!==null?(i(),v("div",xt,[s("div",null,n(((y=e.service_code_id)==null?void 0:y.name)||""),1),(d=e.service_code_id)!=null&&d.totalWeight?(i(),v("div",Ut,"("+n((I=e.service_code_id)==null?void 0:I.totalWeight)+"kg) ",1)):f("",!0)])):(i(),v("div",Ft,n(r.placeholder),1))])):(i(),v("span",Ot,n(r.placeholder),1))]}),option:u(r=>[s("div",Vt,[s("div",null,n(r.option.name),1),r.option.totalWeight?(i(),v("div",jt,"("+n(r.option.totalWeight)+"kg) ",1)):f("",!0)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),e.service_code_updated_by_id?V((i(),g(l(H),{key:0,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:u(()=>[s("img",{src:e.service_code_updated_by.profile_photo_url,alt:"User Initials"},null,8,Rt)]),_:2},1024)),[[A,`Last updated by:
${e.service_code_updated_by.name}`]]):f("",!0)])]),_:1}),a(l(_),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),a(l(_),{field:"address",header:"Address",style:{"min-width":"10rem"}}),a(l(_),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),a(l(_),{field:"start_date",header:"Start Date",style:{"min-width":"10rem"}},{body:u(({data:e})=>[p(n(G(e.start_date)),1)]),_:1}),a(l(_),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:u(({data:e})=>[p(n(G(e.due_date)),1)]),_:1}),a(l(_),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),a(l(_),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:u(({data:e})=>[p(n(G(e.invoice_date)),1)]),_:1}),a(l(_),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:u(({data:e})=>{var r;return[p(n((r=R.value[e.state_id-1])==null?void 0:r.name),1)]}),_:1}),a(l(_),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),a(l(_),{field:"email",header:"Email",style:{"min-width":"10rem"}}),a(l(_),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:u(({data:e})=>[e.payment_status==="paid"?(i(),g(l(Te),{key:0,severity:"success",value:"Paid"})):f("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},Tt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},Mt={__name:"SubscriptionsToDeliverFilterSubscription",props:{filterSubs:Object,filterSubIds:Object,stateIds:Object,serviceCodes:Object,users:Object},setup(h){const z=Ee();return(J,b)=>(i(),g(Ue,{title:"SubscriptionsToDeliver"},{default:u(()=>[s("div",Tt,[a(Zt,{filterSubs:h.filterSubs,stateIds:h.stateIds,filterSubIds:h.filterSubIds,currentUser:l(z).props.auth.user,users:h.users,serviceCodes:h.serviceCodes},null,8,["filterSubs","stateIds","filterSubIds","currentUser","users","serviceCodes"])])]),_:1}))}};export{Mt as default};
