import{_ as Fe}from"./AppLayout-Bz8ftTQb.js";import{d as r,q as Ve,s as $e,x as te,y as J,z as Oe,A as Ue,o as u,e as m,a as o,g as _,t as d,f as b,b as s,w as n,u as l,F as T,h as B,c as V,C as ae,D as le,Q as Ae}from"./app-BqipoHyu.js";import{d as Ne,s as se,a as v,b as oe,c as K,e as F,f as je,g as Ee,h as Pe,i as Te,j as Be,k as ie,l as Le}from"./primeicons-J1JNrsQH.js";import{u as z,w as Re}from"./xlsx-YQvpTstd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Me={class:"card"},Qe={class:"m-4 my-4"},qe={key:0},Ge=o("i",{class:"pi pi-calendar"},null,-1),Je={key:1},Ke=o("i",{class:"pi pi-map-marker"},null,-1),ze=o("i",{class:"pi pi-user"},null,-1),He=o("i",{class:"pi pi-map-marker mt-2"},null,-1),We=o("p",{class:"mt-6"}," Order Lines:",-1),Xe={key:0},Ye=o("p",{class:"mt-6 mb-2"}," Other Address:",-1),Ze=o("i",{class:"pi pi-building-columns"},null,-1),et=o("p",{class:"mt-6 mb-2"}," Other Address:",-1),tt=o("i",{class:"pi pi-building"},null,-1),at=o("p",{class:"mb-2 text-xl font-bold"},"States",-1),lt=["for"],st=o("p",{class:"mt-4 mb-2 text-xl font-bold"},"Category",-1),ot=["for"],it=o("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),rt=["for"],nt={class:"font-bold"},dt={class:"flex justify-between"},ut=o("i",{class:"pi pi-search"},null,-1),ct=["onClick"],mt={key:0,class:"pi pi-truck ml-2"},vt={key:0,class:"flex align-items-center"},pt={key:0},_t={key:1},ft={key:1},yt={class:"flex align-items-center"},ht={__name:"SubsToEnterDataTable",props:{currentUser:Object,filterSubs:Object,filterSubIds:Object,stateIds:Object,filters:Object},setup(p){const k=r(1),C=r([]),$=r([]),S=r(),L=r(!0),O=r([]),U=r([]),H=r(),re=r([]),W=r(),y=r([]),R=r(100),A=r(),N=r(),X=r(),w=r([]),I=r([]),D=Ve(),j=r(0),M=r(!1),Q=r(!1),ne=r(),Y=r(),de=r([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),ue=r([{id:1,name:"Subscription"}]);let E=p;$e(()=>{L.value=!1,j.value=E.filterSubs.total,ne.value=E.salesQuotations,I.value=E.stateIds});const Z=()=>{S.value={start_date:{operator:ae.AND,constraints:[{value:null,matchMode:le.DATE_IS}]},due_date:{operator:ae.AND,constraints:[{value:null,matchMode:le.DATE_IS}]}}};Z(),te(N,async t=>{if(t)try{const a=await J.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:t}});$.value=a.data.map(c=>({name:c,value:c})),$.value.push({name:"- Unselect -",value:null})}catch(a){console.error("Error fetching dropdown options:",a)}}),te([()=>C.value,()=>w.value,()=>O.value,()=>U.value,()=>S.value],()=>{q()});const ce=()=>{Z()},me=async(t,a)=>{const c={"Invoice Number":"invoice_number","Sales Order":"sales_order_no","Customer Name":"customer_name","Invoice Date":"invoice_date","Payment Status":"payment_status",Address:"address",State:"state_id","Activity Summary":"activity_summary","Phone Number":"phone",Email:"email","Due Date":"due_date","Created on Odoo":"created_on_odoo"};try{const e=await J.post("/api/getFilterSubByIds",{filterSubIds:t});if(e.status===200){const P=e.data.filterSubs.map(f=>{var h;f.state_id=(h=a[f.state_id-1])==null?void 0:h.name;let g={};for(const[De,xe]of Object.entries(c))g[De]=f[xe];return g}).reduce((f,g)=>{const h=g.State;return f[h]||(f[h]=[]),f[h].push(g),f},{}),ee=z.book_new();for(const[f,g]of Object.entries(P)){const h=z.json_to_sheet(g);z.book_append_sheet(ee,h,f)}const ke=Re(ee,{bookType:"xlsx",type:"binary"}),Ce=new Blob([ge(ke)],{type:"application/octet-stream"}),Ie=URL.createObjectURL(Ce),x=document.createElement("a");x.href=Ie,x.setAttribute("download","subs_to_enter.xlsx"),document.body.appendChild(x),x.click(),document.body.removeChild(x)}else D.add({severity:"error",summary:"Unable to fetch filter subscriptions",detail:"",life:3e3})}catch(e){D.add({severity:"error",summary:"Error: "+e,detail:"",life:3e3})}},q=async()=>{try{const t=Oe.get("/dashboard",{page:k.value,search:Y.value,dates:C.value,stateId:w.value,activitySummary:O.value,categories:U.value,perPage:R.value,filters:JSON.stringify(S.value)},{preserveState:!0,replace:!1,onSuccess:a=>{console.log(a),console.log(a.props.filterSubs.total),j.value=a.props.filterSubs.total;const c=a.props.filters;JSON.stringify(S.value)!==JSON.stringify(c)&&(S.value=c)}})}catch(t){console.error("Error fetching data:",t)}finally{L.value=!1}},ve=Ne(q,300),G=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,pe=t=>{if(!t||t.length===0)return"";const a=new Date(t[0]),c=t[1]?new Date(t[1]):a;return`${a.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${c.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},_e=t=>t.map(a=>{var c;return(c=I.value[a-1])==null?void 0:c.code}).join(", "),fe=t=>{M.value=!0,N.value=t.sales_order_no,X.value=t.order_line,W.value=t.customer_name,H.value=t.address,re.value=t.contact_address,A.value=t},ye=t=>{R.value=t.rows,k.value=t.page+1,console.log("page change"),console.log(k.value),q()},he=t=>{Y.value=t.target.value,console.log(t.target.value),ve()},be=async t=>{var a;try{if((a=t.created_on_odoo)!=null&&a.value){console.log(t);const c=await J.post("/api/createDeliverSub",{filter_sub_id:t.id,created_on_odoo:t.created_on_odoo.value,odoo_created_by_id:E.currentUser.id,due_date:t.due_date.value});D.add({severity:"success",summary:`Moved #${t.sales_order_no} to Confirm Delivery Requirement`,detail:"",life:3e3})}}catch(c){console.error("Failed to update created_on_odoo:",c),c.response.data.error?D.add({severity:"error",summary:c.response.data.error,detail:"",life:3e3}):D.add({severity:"error",summary:"Failed to update created on odoo",detail:"",life:3e3})}},Se=t=>{N.value=t.sales_order_no};function ge(t){const a=new ArrayBuffer(t.length),c=new Uint8Array(a);for(let e=0;e<t.length;e++)c[e]=t.charCodeAt(e)&255;return a}const we=async t=>{y.value=t};return(t,a)=>{const c=Ue("Toast");return u(),m("div",Me,[o("div",null,[o("div",Qe,[C.value.length?(u(),m("div",qe,[Ge,_(" "+d(pe(C.value)),1)])):b("",!0),w.value.length?(u(),m("div",Je,[Ke,_(" "+d(_e(w.value)),1)])):b("",!0)])]),s(c),s(l(oe),{visible:M.value,"onUpdate:visible":a[0]||(a[0]=e=>M.value=e),header:N.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:n(()=>[o("p",null,[ze,_(" "+d(W.value),1)]),o("p",null,[He,_(" "+d(H.value),1)]),We,s(l(se),{value:X.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:n(()=>[s(l(v),{field:"product",header:"Product",style:{"min-width":"10rem"}}),s(l(v),{field:"description",header:"Description",style:{"min-width":"10rem"}}),s(l(v),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),o("div",null,[A.value.contact_address[0].parent?(u(),m("p",Xe,[Ye,Ze,_(" "+d(A.value.contact_address[0].parent.complete_address),1)])):b("",!0)]),o("div",null,[(u(!0),m(T,null,B(A.value.contact_address[0].children,(e,i)=>(u(),m("p",{key:i},[et,tt,_(" "+d(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),s(l(oe),{visible:Q.value,"onUpdate:visible":a[4]||(a[4]=e=>Q.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:n(()=>[at,(u(!0),m(T,null,B(I.value,e=>(u(),m("div",{key:e.id,class:"flex items-center mb-2"},[s(l(K),{modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=i=>w.value=i),inputId:e.state_id,name:"stateIds",value:e.state_id},null,8,["modelValue","inputId","value"]),o("label",{for:e.id,class:"ml-2"},d(e.name),9,lt)]))),128)),st,(u(!0),m(T,null,B(ue.value,e=>(u(),m("div",{key:e.id,class:"flex items-center mb-2"},[s(l(K),{modelValue:U.value,"onUpdate:modelValue":a[2]||(a[2]=i=>U.value=i),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),o("label",{for:e.id,class:"ml-2"},d(e.name),9,ot)]))),128)),it,(u(!0),m(T,null,B(de.value,e=>(u(),m("div",{key:e.id,class:"flex items-center mb-2"},[s(l(K),{modelValue:O.value,"onUpdate:modelValue":a[3]||(a[3]=i=>O.value=i),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),o("label",{for:e.id,class:"ml-2"},d(e.name),9,rt)]))),128))]),_:1},8,["visible"]),y.value.length?(u(),V(l(F),{key:0,class:"ml-4",outlined:""},{default:n(()=>[o("p",nt,d(y.value.length),1),_("selected "),y.value.length<p.filterSubs.total?(u(),V(l(F),{key:0,label:`Select all ${p.filterSubIds.length}`,onClick:a[5]||(a[5]=e=>we(p.filterSubIds)),icon:"pi pi-arrow-right",class:"ml-4",severity:"info"},null,8,["label"])):b("",!0)]),_:1})):b("",!0),y.value.length?(u(),V(l(F),{key:1,label:`Export as Excel (${y.value.length})`,onClick:a[6]||(a[6]=e=>me(y.value,I.value)),class:"ml-4"},null,8,["label"])):b("",!0),s(l(je),{rows:R.value,totalRecords:j.value,rowsPerPageOptions:[10,25,50,100,j.value].sort((e,i)=>e-i),onPage:ye},{start:n(e=>[_(d(p.filterSubs.from)+"-"+d(p.filterSubs.to)+" / "+d(p.filterSubs.total),1)]),_:1},8,["rows","totalRecords","rowsPerPageOptions"]),s(l(se),{selection:y.value,"onUpdate:selection":a[9]||(a[9]=e=>y.value=e),value:p.filterSubs.data,lazy:"",loading:L.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu",filters:S.value,"onUpdate:filters":a[10]||(a[10]=e=>S.value=e)},{header:n(()=>[o("div",dt,[s(l(F),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:a[7]||(a[7]=e=>ce())}),s(l(Ee),null,{default:n(()=>[s(l(Pe),null,{default:n(()=>[ut]),_:1}),o("div",null,[s(l(F),{onClick:a[8]||(a[8]=e=>Q.value=!0),label:"Filter",class:"mr-4"}),s(l(Te),{placeholder:"Keyword Search",onInput:he})])]),_:1})])]),empty:n(()=>[_(" No filterSubs found. ")]),loading:n(()=>[_(" Loading filterSubs data. Please wait. ")]),default:n(()=>[s(l(v),{selectionMode:"multiple",headerStyle:"width: 3rem"}),s(l(v),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:n(({data:e})=>[o("span",{onClick:i=>fe(e),class:"cursor-pointer hover:underline"},d(e.sales_order_no),9,ct),e.delivered_or_delivery_booked&&e.delivered_or_delivery_booked.value!==null?(u(),m("i",mt)):b("",!0)]),_:1}),s(l(v),{field:"",header:"Created on Odoo",style:{"min-width":"10rem"}},{body:n(({data:e})=>[s(l(Be),{modelValue:e.created_on_odoo,"onUpdate:modelValue":i=>e.created_on_odoo=i,options:$.value,filter:"",optionLabel:"name",placeholder:"Select Sales Order #",class:"w-full md:w-14rem",onClick:i=>Se(e),onChange:i=>be(e)},{value:n(i=>{var P;return[i.value?(u(),m("div",vt,[e.created_on_odoo&&e.created_on_odoo.value!==null?(u(),m("div",pt,d(((P=e.created_on_odoo)==null?void 0:P.name)||e.created_on_odoo),1)):(u(),m("div",_t,d(i.placeholder),1))])):(u(),m("span",ft,d(i.placeholder),1))]}),option:n(i=>[o("div",yt,[o("div",null,d(i.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onClick","onChange"])]),_:1}),s(l(v),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),s(l(v),{field:"address",header:"Address",style:{"min-width":"10rem"}}),s(l(v),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),s(l(v),{field:"start_date",header:"Start Date",style:{"min-width":"10rem"},filterField:"start_date",dataType:"date"},{body:n(({data:e})=>[_(d(G(e.start_date)),1)]),filter:n(({filterModel:e})=>[s(l(ie),{modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,dateFormat:"dd/mm/yy",placeholder:"dd/mm/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(l(v),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"},filterField:"due_date",dataType:"date"},{body:n(({data:e})=>[_(d(G(e.due_date)),1)]),filter:n(({filterModel:e})=>[s(l(ie),{modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,dateFormat:"dd/mm/yy",placeholder:"dd/mm/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(l(v),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),s(l(v),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:n(({data:e})=>[_(d(G(e.invoice_date)),1)]),_:1}),s(l(v),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:n(({data:e})=>{var i;return[_(d((i=I.value[e.state_id-1])==null?void 0:i.name),1)]}),_:1}),s(l(v),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),s(l(v),{field:"email",header:"Email",style:{"min-width":"10rem"}}),s(l(v),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:n(({data:e})=>[e.payment_status==="paid"?(u(),V(l(Le),{key:0,severity:"success",value:"Paid"})):b("",!0)]),_:1})]),_:1},8,["selection","value","loading","filters"])])}}},bt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},It={__name:"Dashboard",props:{filterSubs:Object,stateIds:Object,activitySummaries:Object,filterSubIds:Object,filters:Object},setup(p){const k=Ae();return(C,$)=>(u(),V(Fe,{title:"Dashboard"},{default:n(()=>[o("div",bt,[s(ht,{filterSubs:p.filterSubs,stateIds:p.stateIds,activitySummaries:p.activitySummaries,filterSubIds:p.filterSubIds,filters:p.filters,currentUser:l(k).props.auth.user},null,8,["filterSubs","stateIds","activitySummaries","filterSubIds","filters","currentUser"])])]),_:1}))}};export{It as default};
