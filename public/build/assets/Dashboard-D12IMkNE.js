import{_ as xe}from"./AppLayout-DDN4xZiC.js";import{d as Fe,s as ee,a as m,b as te,c as G,e as K,f as Oe,g as Ve,h as $e,i as Ue,j as Ne,k as Ae}from"./primeicons-BqKdTtcn.js";import{s as ae}from"./index-ES5vMCfc.js";import{q as je,d as r,s as Ee,x as Pe,y as le,z as C,A as se,B as Te,o as c,e as v,a as n,g as p,t as i,f as D,b as s,w as d,u as l,F as T,h as B,c as H,D as oe,E as ne,Q as Be}from"./app-8REE4K1P.js";import{u as z,w as Le}from"./xlsx-YQvpTstd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Re={class:"card"},Me={class:"m-4 my-4"},Je={key:0},Qe=n("i",{class:"pi pi-calendar"},null,-1),qe={key:1},Ge=n("i",{class:"pi pi-map-marker"},null,-1),Ke=n("i",{class:"pi pi-user"},null,-1),ze=n("i",{class:"pi pi-map-marker mt-2"},null,-1),He=n("p",{class:"mt-6"}," Order Lines:",-1),We={key:0},Xe=n("p",{class:"mt-6 mb-2"}," Other Address:",-1),Ye=n("i",{class:"pi pi-building-columns"},null,-1),Ze=n("p",{class:"mt-6 mb-2"}," Other Address:",-1),et=n("i",{class:"pi pi-building"},null,-1),tt=n("p",{class:"mb-2 text-xl font-bold"},"States",-1),at=["for"],lt=n("p",{class:"mt-4 mb-2 text-xl font-bold"},"Category",-1),st=["for"],ot=n("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),nt=["for"],rt={class:"flex justify-between"},dt=n("i",{class:"pi pi-search"},null,-1),it=["onClick"],ut={key:0,class:"pi pi-truck ml-2"},ct={key:0,class:"flex align-items-center"},mt={key:0},vt={key:1},pt={key:1},ft={class:"flex align-items-center"},ht={__name:"SubsToEnterDataTable",props:{currentUser:Object,filterSubs:Object,filterSubIds:Object,stateIds:Object,filters:Object},setup(f){je();let S=f;const I=r([]),x=r(!0),w=r(1),F=r(0),L=r(),R=r(!1),M=r(!1),re=r(),J=r([]),Q=Ee(),O=r([]),A=r(),W=r(),X=r(),Y=r(),de=r([]),ie=r([{id:1,name:"Subscription"}]),ue=r([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]);r([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]);const V=r([]),j=r(),b=r([]),$=r([]),U=r([]),E=r(100),_=r();Pe(()=>{x.value=!1,F.value=S.filterSubs.total,re.value=S.salesQuotations,O.value=S.stateIds});const Z=()=>{_.value={start_date:{operator:oe.AND,constraints:[{value:null,matchMode:ne.DATE_IS}]},due_date:{operator:oe.AND,constraints:[{value:null,matchMode:ne.DATE_IS}]}}};Z();const ce=t=>{E.value=t.rows,w.value=t.page+1,console.log("page change"),console.log(w.value),k()},me=t=>{L.value=t.target.value,console.log(t.target.value),ve()},k=async()=>{try{console.log("fetch data page"),console.log(w.value);const t=le.get("/dashboard",{page:w.value,search:L.value,dates:V.value,stateId:b.value,activitySummary:$.value,categories:U.value,perPage:E.value,filters:JSON.stringify(_.value)},{preserveState:!0,replace:!1,onSuccess:a=>{console.log(a),console.log(a.props.filterSubs.total),F.value=a.props.filterSubs.total;const u=a.props.filters;JSON.stringify(_.value)!==JSON.stringify(u)&&(_.value=u)}})}catch(t){console.error("Error fetching data:",t)}finally{x.value=!1}},ve=Fe(async()=>{try{console.log("fetch data page"),console.log(w.value);const t=await le.get("/dashboard",{page:w.value,search:L.value,dates:V.value,stateId:b.value,activitySummary:$.value,categories:U.value,perPage:E.value,filters:JSON.stringify(_.value)},{preserveState:!0,replace:!1,onSuccess:a=>{console.log(a),console.log(a.props.filterSubs.total),F.value=a.props.filterSubs.total}})}catch(t){console.error("Error fetching data:",t)}finally{x.value=!1}},300),q=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,pe=t=>{if(!t||t.length===0)return"";const a=new Date(t[0]),u=t[1]?new Date(t[1]):a;return`${a.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${u.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},fe=t=>t.map(a=>{var u;return(u=O.value[a-1])==null?void 0:u.code}).join(", "),he=()=>{Z()},_e=t=>{R.value=!0,A.value=t.sales_order_no,W.value=t.order_line,X.value=t.customer_name,Y.value=t.address,de.value=t.contact_address,j.value=t},ye=t=>{A.value=t.sales_order_no},be=async t=>{var a;try{if((a=t.created_on_odoo)!=null&&a.value){console.log(t);const u=await se.post("/api/createDeliverSub",{filter_sub_id:t.id,created_on_odoo:t.created_on_odoo.value,odoo_created_by_id:S.currentUser.id,due_date:t.due_date.value});Q.add({severity:"success",summary:`Moved #${t.sales_order_no} to Confirm Delivery Requirement`,detail:"",life:3e3})}}catch(u){console.error("Failed to update created_on_odoo:",u),u.response.data.error?Q.add({severity:"error",summary:u.response.data.error,detail:"",life:3e3}):Q.add({severity:"error",summary:"Failed to update created on odoo",detail:"",life:3e3})}};C(A,async t=>{if(t)try{const a=await se.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:t}});J.value=a.data.map(u=>({name:u,value:u})),J.value.push({name:"- Unselect -",value:null})}catch(a){console.error("Error fetching dropdown options:",a)}}),C(b,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),k())}),C($,async t=>{console.log("changed state, load fetch data 1"),t&&(console.log("changed state, load fetch data 2"),k())}),C(V,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),k())}),C(U,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),k())}),C(_,async t=>{console.log("changed date, load fetch data 1"),t&&(console.log("changed date, load fetch data 2"),k())});const ge=t=>t,Se=t=>{const a={"Invoice Number":"invoice_number","Sales Order":"sales_order_no","Customer Name":"customer_name","Invoice Date":"invoice_date","Payment Status":"payment_status",Address:"address",State:"state_id","Activity Summary":"activity_summary","Phone Number":"phone",Email:"email","Due Date":"due_date","Created on Odoo":"created_on_odoo"},e=I.value.map(h=>{var y;h.state_id=(y=t[h.state_id-1])==null?void 0:y.name;let g={};for(const[De,Ie]of Object.entries(a))g[De]=h[Ie];return g}).reduce((h,g)=>{const y=g.State;return h[y]||(h[y]=[]),h[y].push(g),h},{}),o=z.book_new();for(const[h,g]of Object.entries(e)){const y=z.json_to_sheet(g);z.book_append_sheet(o,y,h)}const P=Le(o,{bookType:"xlsx",type:"binary"}),ke=new Blob([we(P)],{type:"application/octet-stream"}),Ce=URL.createObjectURL(ke),N=document.createElement("a");N.href=Ce,N.setAttribute("download","subs_to_enter.xlsx"),document.body.appendChild(N),N.click(),document.body.removeChild(N)};function we(t){const a=new ArrayBuffer(t.length),u=new Uint8Array(a);for(let e=0;e<t.length;e++)u[e]=t.charCodeAt(e)&255;return a}return(t,a)=>{const u=Te("Toast");return c(),v("div",Re,[n("div",null,[n("div",Me,[V.value.length?(c(),v("div",Je,[Qe,p(" "+i(pe(V.value)),1)])):D("",!0),b.value.length?(c(),v("div",qe,[Ge,p(" "+i(fe(b.value)),1)])):D("",!0)])]),s(u),s(l(te),{visible:R.value,"onUpdate:visible":a[0]||(a[0]=e=>R.value=e),header:A.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:d(()=>[n("p",null,[Ke,p(" "+i(X.value),1)]),n("p",null,[ze,p(" "+i(Y.value),1)]),He,s(l(ee),{value:W.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:d(()=>[s(l(m),{field:"product",header:"Product",style:{"min-width":"10rem"}}),s(l(m),{field:"description",header:"Description",style:{"min-width":"10rem"}}),s(l(m),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),n("div",null,[j.value.contact_address[0].parent?(c(),v("p",We,[Xe,Ye,p(" "+i(j.value.contact_address[0].parent.complete_address),1)])):D("",!0)]),n("div",null,[(c(!0),v(T,null,B(j.value.contact_address[0].children,(e,o)=>(c(),v("p",{key:o},[Ze,et,p(" "+i(e.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),s(l(te),{visible:M.value,"onUpdate:visible":a[4]||(a[4]=e=>M.value=e),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:d(()=>[tt,(c(!0),v(T,null,B(O.value,e=>(c(),v("div",{key:e.id,class:"flex items-center mb-2"},[s(l(G),{modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=o=>b.value=o),inputId:e.state_id,name:"stateIds",value:e.state_id},null,8,["modelValue","inputId","value"]),n("label",{for:e.id,class:"ml-2"},i(e.name),9,at)]))),128)),lt,(c(!0),v(T,null,B(ie.value,e=>(c(),v("div",{key:e.id,class:"flex items-center mb-2"},[s(l(G),{modelValue:U.value,"onUpdate:modelValue":a[2]||(a[2]=o=>U.value=o),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),n("label",{for:e.id,class:"ml-2"},i(e.name),9,st)]))),128)),ot,(c(!0),v(T,null,B(ue.value,e=>(c(),v("div",{key:e.id,class:"flex items-center mb-2"},[s(l(G),{modelValue:$.value,"onUpdate:modelValue":a[3]||(a[3]=o=>$.value=o),inputId:e.name,name:"category",value:e.name},null,8,["modelValue","inputId","value"]),n("label",{for:e.id,class:"ml-2"},i(e.name),9,nt)]))),128))]),_:1},8,["visible"]),I.value.length?(c(),H(l(K),{key:0,label:"Export as Excel",onClick:a[5]||(a[5]=e=>Se(O.value)),class:"ml-4"})):D("",!0),s(l(Oe),{rows:E.value,totalRecords:F.value,rowsPerPageOptions:[10,25,50,100,F.value].sort((e,o)=>e-o),onPage:ce},{start:d(e=>[p(i(f.filterSubs.from)+"-"+i(f.filterSubs.to)+" / "+i(f.filterSubs.total),1)]),_:1},8,["rows","totalRecords","rowsPerPageOptions"]),s(l(ee),{selection:I.value,"onUpdate:selection":a[8]||(a[8]=e=>I.value=e),value:ge(f.filterSubs.data),lazy:"",loading:x.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu",filters:_.value,"onUpdate:filters":a[9]||(a[9]=e=>_.value=e)},{header:d(()=>[n("div",rt,[s(l(K),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:a[6]||(a[6]=e=>he())}),s(l(Ve),null,{default:d(()=>[s(l($e),null,{default:d(()=>[dt]),_:1}),n("div",null,[s(l(K),{onClick:a[7]||(a[7]=e=>M.value=!0),label:"Filter",class:"mr-4"}),s(l(Ue),{placeholder:"Keyword Search",onInput:me})])]),_:1})])]),empty:d(()=>[p(" No filterSubs found. ")]),loading:d(()=>[p(" Loading filterSubs data. Please wait. ")]),default:d(()=>[s(l(m),{selectionMode:"multiple",headerStyle:"width: 3rem"}),s(l(m),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:d(({data:e})=>[n("span",{onClick:o=>_e(e),class:"cursor-pointer hover:underline"},i(e.sales_order_no),9,it),e.delivered_or_delivery_booked&&e.delivered_or_delivery_booked.value!==null?(c(),v("i",ut)):D("",!0)]),_:1}),s(l(m),{field:"",header:"Created on Odoo",style:{"min-width":"10rem"}},{body:d(({data:e})=>[s(l(Ne),{modelValue:e.created_on_odoo,"onUpdate:modelValue":o=>e.created_on_odoo=o,options:J.value,filter:"",optionLabel:"name",placeholder:"Select Sales Order #",class:"w-full md:w-14rem",onClick:o=>ye(e),onChange:o=>be(e)},{value:d(o=>{var P;return[o.value?(c(),v("div",ct,[e.created_on_odoo&&e.created_on_odoo.value!==null?(c(),v("div",mt,i(((P=e.created_on_odoo)==null?void 0:P.name)||e.created_on_odoo),1)):(c(),v("div",vt,i(o.placeholder),1))])):(c(),v("span",pt,i(o.placeholder),1))]}),option:d(o=>[n("div",ft,[n("div",null,i(o.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onClick","onChange"])]),_:1}),s(l(m),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),s(l(m),{field:"address",header:"Address",style:{"min-width":"10rem"}}),s(l(m),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),s(l(m),{field:"start_date",header:"Start Date",style:{"min-width":"10rem"},filterField:"start_date",dataType:"date"},{body:d(({data:e})=>[p(i(q(e.start_date)),1)]),filter:d(({filterModel:e})=>[s(l(ae),{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,dateFormat:"dd/mm/yy",placeholder:"dd/mm/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(l(m),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"},filterField:"due_date",dataType:"date"},{body:d(({data:e})=>[p(i(q(e.due_date)),1)]),filter:d(({filterModel:e})=>[s(l(ae),{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,dateFormat:"dd/mm/yy",placeholder:"dd/mm/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(l(m),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),s(l(m),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:d(({data:e})=>[p(i(q(e.invoice_date)),1)]),_:1}),s(l(m),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:d(({data:e})=>{var o;return[p(i((o=O.value[e.state_id-1])==null?void 0:o.name),1)]}),_:1}),s(l(m),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),s(l(m),{field:"email",header:"Email",style:{"min-width":"10rem"}}),s(l(m),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:d(({data:e})=>[e.payment_status==="paid"?(c(),H(l(Ae),{key:0,severity:"success",value:"Paid"})):D("",!0)]),_:1})]),_:1},8,["selection","value","loading","filters"])])}}},_t={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},Ct={__name:"Dashboard",props:{filterSubs:Object,stateIds:Object,activitySummaries:Object,filterSubIds:Object,filters:Object},setup(f){const S=Be();return(I,x)=>(c(),H(xe,{title:"Dashboard"},{default:d(()=>[n("div",_t,[s(ht,{filterSubs:f.filterSubs,stateIds:f.stateIds,activitySummaries:f.activitySummaries,filterSubIds:f.filterSubIds,filters:f.filters,currentUser:l(S).props.auth.user},null,8,["filterSubs","stateIds","activitySummaries","filterSubIds","filters","currentUser"])])]),_:1}))}};export{Ct as default};
