import{_ as ge}from"./AppLayout-BarFfHJo.js";import{d as be,s as X,a as u,b as Y,c as Z,e as Se,f as V,g as we,h as ke,i as Ce,j as De,k as $e,l as Ie}from"./primeicons-FTOeLvjK.js";import{p as qe,q as xe,d as o,s as Ue,x as Fe,y as ee,z as $,A as I,B as te,C as je,o as n,e as v,a as i,g as f,t as d,f as y,b as a,w as r,u as s,F as T,h as M,c as k,l as Q,Q as Ve}from"./app-SeORGwS4.js";import{s as Re}from"./index-67aqIuA2.js";import{s as le}from"./index-Cf2_JBCY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Pe={class:"card"},Ae={class:"m-4 my-4"},Ne={key:0},Le=i("i",{class:"pi pi-calendar"},null,-1),Ee={key:1},Oe=i("i",{class:"pi pi-map-marker"},null,-1),Be=i("i",{class:"pi pi-user"},null,-1),Te=i("i",{class:"pi pi-map-marker mt-2"},null,-1),Me=i("p",{class:"mt-6"}," Order Lines:",-1),Qe={key:0},Ge=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),Ke=i("i",{class:"pi pi-building-columns"},null,-1),ze=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),He=i("i",{class:"pi pi-building"},null,-1),Je=i("p",{class:"mb-2 text-xl font-bold"},"States",-1),We=["for"],Xe=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),Ye=["for"],Ze=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),et={class:"flex justify-between"},tt=i("i",{class:"pi pi-search"},null,-1),lt={style:{display:"flex","align-items":"center"}},st=["onClick"],at=["onClick"],it={class:"flex items-center"},ot={key:0,class:"pi pi-truck"},rt=["src"],nt={style:{display:"flex","align-items":"center"}},dt={key:0,class:"flex align-items-center"},ct={key:0},ut={key:1},mt={key:1},vt={class:"flex align-items-center"},ft=["src"],pt={__name:"ConfirmDeliveryRequirementDataTable",props:{currentUser:Object,deliverSubIds:Object,filterSubs:Object,stateIds:Object,users:Object},setup(p){const R=qe(),G=(e,l,m)=>{R.require({message:`Do you want to unlink #${l} from #${e}?`,header:"Unlink Sales Order",icon:"pi pi-info-circle",rejectLabel:"Cancel",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Unlink",severity:"danger"},accept:async()=>{await I.delete(`/api/deliverSub/${m}`),h(),b.add({severity:"info",summary:"Unlinked Successfully",detail:`Unlinked #${l} from #${e}`,life:3e3})},reject:()=>{}})};xe();let g=p;const _=o([]),q=o(!0),C=o(1),x=o(0),P=o(),A=o(!1),N=o(!1),se=o(),K=o([]),b=Ue(),U=o([]),L=o(),z=o(),H=o(),J=o(),ae=o([]);o([{id:1,name:"Subscription"}]);const ie=o([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),oe=o([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),S=o([]),F=o(),w=o([]),D=o([]),E=o([]),j=o(100);Fe(()=>{q.value=!1,x.value=g.filterSubs.total,se.value=g.salesQuotations,U.value=g.stateIds});const re=e=>{j.value=e.rows,C.value=e.page+1,console.log("page change"),console.log(C.value),h()},ne=e=>{P.value=e.target.value,console.log(e.target.value),de()},h=async()=>{try{console.log("fetch data page"),console.log(C.value);const e=ee.get("/confirmDeliveryRequirement",{page:C.value,search:P.value,dates:S.value,stateId:w.value,activitySummary:D.value,categories:E.value,perPage:j.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),x.value=l.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{q.value=!1}},de=be(async()=>{try{console.log("fetch data page"),console.log(C.value);const e=await ee.get("/confirmDeliveryRequirement",{page:C.value,search:P.value,dates:S.value,stateId:w.value,activitySummary:D.value,categories:E.value,perPage:j.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),x.value=l.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{q.value=!1}},300),O=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,ce=e=>{if(!e||e.length===0)return"";const l=new Date(e[0]),m=e[1]?new Date(e[1]):l;return`${l.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${m.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},ue=e=>e.map(l=>{var m;return(m=U.value[l-1])==null?void 0:m.code}).join(", "),me=()=>{initFilters()},ve=e=>{A.value=!0,L.value=e.sales_order_no,z.value=e.order_line,H.value=e.customer_name,J.value=e.address,ae.value=e.contact_address,F.value=e},fe=async e=>{try{console.log(e.required_delivery.value);const l=await I.put(`/api/updateRequiredDeliveryInDeliverSubs/${e.id}`,{required_delivery:e.required_delivery.value,required_delivery_updated_by_id:g.currentUser.id});e.required_delivery.value=="Confirm"?b.add({severity:"success",summary:`Successfully confirmed #${e.sales_order_no} for delivery`,detail:"",life:3e3}):e.required_delivery.value=="Deny"?b.add({severity:"info",summary:`Successfully denied #${e.sales_order_no}`,detail:"",life:3e3}):b.add({severity:"info",summary:`Updated #${e.sales_order_no}'s require delivery value`,detail:"",life:3e3})}catch(l){console.error("Failed to update required_delivery:",l),b.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};$(L,async e=>{if(e)try{const l=await I.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:e}});K.value=l.data.map(m=>({name:m,value:m})),K.value.push({name:"- Unselect -",value:null})}catch(l){console.error("Error fetching dropdown options:",l)}}),$(w,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),h())}),$(D,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),h())}),$(S,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),h())}),$(E,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),h())});const pe=e=>e,_e=async()=>{var e=_.value.map(m=>m.id);console.log(e);const l=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:g.currentUser.id});await I.post("/api/bulkConfirmDeliverSubs",l,{headers:{"Content-Type":"application/json"}}),b.add({severity:"success",summary:`Successfully confirmed ${e.length} filter subs`,detail:"",life:3e3}),h(),_.value=[]},ye=async()=>{var e=_.value.map(m=>m.id);console.log(e);const l=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:g.currentUser.id});await I.post("/api/bulkDenyDeliverSubs",l,{headers:{"Content-Type":"application/json"}}),b.add({severity:"success",summary:`Successfully denied ${e.length} filter subs`,detail:"",life:3e3}),h(),_.value=[]};return(e,l)=>{const m=te("Toast"),he=te("font-awesome-icon"),B=je("tooltip");return n(),v("div",Pe,[i("div",null,[i("div",Ae,[S.value.length?(n(),v("div",Ne,[Le,f(" "+d(ce(S.value)),1)])):y("",!0),w.value.length?(n(),v("div",Ee,[Oe,f(" "+d(ue(w.value)),1)])):y("",!0)])]),a(m),a(s(Y),{visible:A.value,"onUpdate:visible":l[0]||(l[0]=t=>A.value=t),header:L.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:r(()=>[i("p",null,[Be,f(" "+d(H.value),1)]),i("p",null,[Te,f(" "+d(J.value),1)]),Me,a(s(X),{value:z.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:r(()=>[a(s(u),{field:"product",header:"Product",style:{"min-width":"10rem"}}),a(s(u),{field:"description",header:"Description",style:{"min-width":"10rem"}}),a(s(u),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),i("div",null,[F.value.contact_address[0].parent?(n(),v("p",Qe,[Ge,Ke,f(" "+d(F.value.contact_address[0].parent.complete_address),1)])):y("",!0)]),i("div",null,[(n(!0),v(T,null,M(F.value.contact_address[0].children,(t,c)=>(n(),v("p",{key:c},[ze,He,f(" "+d(t.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),a(s(Y),{visible:N.value,"onUpdate:visible":l[4]||(l[4]=t=>N.value=t),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:r(()=>[Je,(n(!0),v(T,null,M(U.value,t=>(n(),v("div",{key:t.id,class:"flex items-center mb-2"},[a(s(Z),{modelValue:w.value,"onUpdate:modelValue":l[1]||(l[1]=c=>w.value=c),inputId:t.state_id,name:"stateIds",value:t.state_id},null,8,["modelValue","inputId","value"]),i("label",{for:t.id,class:"ml-2"},d(t.name),9,We)]))),128)),Xe,(n(!0),v(T,null,M(ie.value,t=>(n(),v("div",{key:t.id,class:"flex items-center mb-2"},[a(s(Z),{modelValue:D.value,"onUpdate:modelValue":l[2]||(l[2]=c=>D.value=c),inputId:t.name,name:"category",value:t.name},null,8,["modelValue","inputId","value"]),i("label",{for:t.id,class:"ml-2"},d(t.name),9,Ye)]))),128)),Ze,a(s(Se),{modelValue:S.value,"onUpdate:modelValue":l[3]||(l[3]=t=>S.value=t),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),_.value.length?(n(),k(s(V),{key:0,label:`Confirm All (${_.value.length})`,onClick:_e,icon:"pi pi-verified",class:"ml-4"},null,8,["label"])):y("",!0),_.value.length?(n(),k(s(V),{key:1,label:`Deny All (${_.value.length})`,onClick:ye,icon:"pi pi-times-circle",class:"ml-4"},null,8,["label"])):y("",!0),a(s(we),{rows:j.value,totalRecords:x.value,rowsPerPageOptions:[10,25,50,100],onPage:re},{start:r(t=>[f(d(p.filterSubs.from)+"-"+d(p.filterSubs.to)+" / "+d(p.filterSubs.total),1)]),_:1},8,["rows","totalRecords"]),a(s(X),{selection:_.value,"onUpdate:selection":l[7]||(l[7]=t=>_.value=t),value:pe(p.filterSubs.data),lazy:"",loading:q.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:r(()=>[i("div",et,[a(s(V),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:l[5]||(l[5]=t=>me())}),a(s(ke),null,{default:r(()=>[a(s(Ce),null,{default:r(()=>[tt]),_:1}),i("div",null,[a(s(V),{onClick:l[6]||(l[6]=t=>N.value=!0),label:"Filter",class:"mr-4"}),a(s(De),{placeholder:"Keyword Search",onInput:ne})])]),_:1})])]),empty:r(()=>[f(" No filterSubs found. ")]),loading:r(()=>[f(" Loading filterSubs data. Please wait. ")]),default:r(()=>[a(s(u),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(s(u),{field:"root_sales_order.sales_order_no",header:"Root Sales Order #",style:{"min-width":"10rem"}},{body:r(({data:t})=>[i("div",lt,[i("span",null,d(t.root_sales_order.sales_order_no),1),a(s(Re)),i("div",{onClick:c=>G(t.root_sales_order.sales_order_no,t.sales_order_no,t.id),style:{cursor:"pointer","margin-left":"8px"}},[a(he,{icon:["fas","link-slash"],style:{color:"#800000"}})],8,st)])]),_:1}),a(s(u),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:r(({data:t})=>[i("span",{onClick:c=>ve(t),class:"cursor-pointer hover:underline"},d(t.sales_order_no),9,at),i("div",it,[t.delivered_or_delivery_booked&&t.delivered_or_delivery_booked.value!==null?Q((n(),v("i",ot,null,512)),[[B,"Delivery Booked"]]):y("",!0),t.odoo_created_by_id?Q((n(),k(s(le),{key:1,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:r(()=>[i("img",{src:t.odoo_created_by.profile_photo_url,alt:"User Initials"},null,8,rt)]),_:2},1024)),[[B,`Last updated by:
${t.odoo_created_by.name}`]]):y("",!0)])]),_:1}),e.route().current("confirmDeliveryRequirement")?(n(),k(s(u),{key:0,field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:r(({data:t})=>[i("div",nt,[a(s($e),{modelValue:t.required_delivery,"onUpdate:modelValue":c=>t.required_delivery=c,options:oe.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:c=>fe(t)},{value:r(c=>{var W;return[c.value?(n(),v("div",dt,[t.required_delivery&&t.required_delivery.value!==null?(n(),v("div",ct,d(((W=t.required_delivery)==null?void 0:W.name)||t.required_delivery),1)):(n(),v("div",ut,d(c.placeholder),1))])):(n(),v("span",mt,d(c.placeholder),1))]}),option:r(c=>[i("div",vt,[i("div",null,d(c.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),t.required_delivery_updated_by_id?Q((n(),k(s(le),{key:0,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:r(()=>[i("img",{src:t.required_delivery_updated_by.profile_photo_url,alt:"User Initials"},null,8,ft)]),_:2},1024)),[[B,`Last updated by:
${t.required_delivery_updated_by.name}`]]):y("",!0)])]),_:1})):y("",!0),a(s(u),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),a(s(u),{field:"address",header:"Address",style:{"min-width":"10rem"}}),a(s(u),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),a(s(u),{field:"start_date",header:"Start Date",style:{"min-width":"10rem"}},{body:r(({data:t})=>[f(d(O(t.start_date)),1)]),_:1}),a(s(u),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:r(({data:t})=>[f(d(O(t.due_date)),1)]),_:1}),a(s(u),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),a(s(u),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:r(({data:t})=>[f(d(O(t.invoice_date)),1)]),_:1}),a(s(u),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:r(({data:t})=>{var c;return[f(d((c=U.value[t.state_id-1])==null?void 0:c.name),1)]}),_:1}),a(s(u),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),a(s(u),{field:"email",header:"Email",style:{"min-width":"10rem"}}),a(s(u),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:r(({data:t})=>[t.payment_status==="paid"?(n(),k(s(Ie),{key:0,severity:"success",value:"Paid"})):y("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},_t={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},kt={__name:"ConfirmDeliveryRequirement",props:{filterSubs:Object,filterSubIds:Object,stateIds:Object,users:Object},setup(p){const R=Ve();return(G,g)=>(n(),k(ge,{title:"ConfirmDeliveryRequirement"},{default:r(()=>[i("div",_t,[a(pt,{filterSubs:p.filterSubs,stateIds:p.stateIds,filterSubIds:p.filterSubIds,currentUser:s(R).props.auth.user,users:p.users},null,8,["filterSubs","stateIds","filterSubIds","currentUser","users"])])]),_:1}))}};export{kt as default};
