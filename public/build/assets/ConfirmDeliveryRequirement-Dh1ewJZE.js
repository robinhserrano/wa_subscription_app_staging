import{_ as be}from"./AppLayout-BsYwGUg1.js";import{d as Se,s as X,a as c,b as Y,c as Z,e as we,f as D,g as ke,h as Ce,i as De,j as $e,k as Ie,l as qe}from"./primeicons-BXeiMZlh.js";import{p as xe,q as Ue,d as o,s as Fe,x as je,y as ee,z as I,A as q,B as te,C as Ve,o as r,e as v,a as i,g as y,t as d,f as _,b as a,w as n,u as s,F as T,h as M,c as h,l as Q,Q as Re}from"./app-L6f9-XHl.js";import{s as Ae}from"./index-Biis6575.js";import{s as le}from"./index-CFd9i-YD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Pe={class:"card"},Ne={class:"m-4 my-4"},Le={key:0},Ee=i("i",{class:"pi pi-calendar"},null,-1),Oe={key:1},Be=i("i",{class:"pi pi-map-marker"},null,-1),Te=i("i",{class:"pi pi-user"},null,-1),Me=i("i",{class:"pi pi-map-marker mt-2"},null,-1),Qe=i("p",{class:"mt-6"}," Order Lines:",-1),Ge={key:0},Ke=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),ze=i("i",{class:"pi pi-building-columns"},null,-1),He=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),Je=i("i",{class:"pi pi-building"},null,-1),We=i("p",{class:"mb-2 text-xl font-bold"},"States",-1),Xe=["for"],Ye=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),Ze=["for"],et=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),tt={class:"font-bold"},lt={class:"flex justify-between"},st=i("i",{class:"pi pi-search"},null,-1),at={style:{display:"flex","align-items":"center"}},it=["onClick"],ot=["onClick"],rt={class:"flex items-center"},nt={key:0,class:"pi pi-truck"},dt=["src"],ut={style:{display:"flex","align-items":"center"}},ct={key:0,class:"flex align-items-center"},mt={key:0},vt={key:1},ft={key:1},yt={class:"flex align-items-center"},pt=["src"],_t={__name:"ConfirmDeliveryRequirementDataTable",props:{currentUser:Object,deliverSubIds:Object,filterSubs:Object,stateIds:Object,users:Object},setup(p){const R=xe(),G=(e,l,m)=>{R.require({message:`Do you want to unlink #${l} from #${e}?`,header:"Unlink Sales Order",icon:"pi pi-info-circle",rejectLabel:"Cancel",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Unlink",severity:"danger"},accept:async()=>{await q.delete(`/api/deliverSub/${m}`),g(),S.add({severity:"info",summary:"Unlinked Successfully",detail:`Unlinked #${l} from #${e}`,life:3e3})},reject:()=>{}})};Ue();let b=p;const f=o([]),x=o(!0),C=o(1),U=o(0),A=o(),P=o(!1),N=o(!1),se=o(),K=o([]),S=Fe(),F=o([]),L=o(),z=o(),H=o(),J=o(),ae=o([]);o([{id:1,name:"Subscription"}]);const ie=o([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),oe=o([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),w=o([]),j=o(),k=o([]),$=o([]),E=o([]),V=o(100);je(()=>{x.value=!1,U.value=b.filterSubs.total,se.value=b.salesQuotations,F.value=b.stateIds});const re=e=>{V.value=e.rows,C.value=e.page+1,console.log("page change"),console.log(C.value),g()},ne=e=>{A.value=e.target.value,console.log(e.target.value),de()},g=async()=>{try{console.log("fetch data page"),console.log(C.value);const e=ee.get("/confirmDeliveryRequirement",{page:C.value,search:A.value,dates:w.value,stateId:k.value,activitySummary:$.value,categories:E.value,perPage:V.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),U.value=l.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{x.value=!1}},de=Se(async()=>{try{console.log("fetch data page"),console.log(C.value);const e=await ee.get("/confirmDeliveryRequirement",{page:C.value,search:A.value,dates:w.value,stateId:k.value,activitySummary:$.value,categories:E.value,perPage:V.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),U.value=l.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{x.value=!1}},300),O=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,ue=e=>{if(!e||e.length===0)return"";const l=new Date(e[0]),m=e[1]?new Date(e[1]):l;return`${l.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${m.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},ce=e=>e.map(l=>{var m;return(m=F.value[l-1])==null?void 0:m.code}).join(", "),me=()=>{initFilters()},ve=e=>{P.value=!0,L.value=e.sales_order_no,z.value=e.order_line,H.value=e.customer_name,J.value=e.address,ae.value=e.contact_address,j.value=e},fe=async e=>{try{console.log(e.required_delivery.value);const l=await q.put(`/api/updateRequiredDeliveryInDeliverSubs/${e.id}`,{required_delivery:e.required_delivery.value,required_delivery_updated_by_id:b.currentUser.id});e.required_delivery.value=="Confirm"?S.add({severity:"success",summary:`Successfully confirmed #${e.sales_order_no} for delivery`,detail:"",life:3e3}):e.required_delivery.value=="Deny"?S.add({severity:"info",summary:`Successfully denied #${e.sales_order_no}`,detail:"",life:3e3}):S.add({severity:"info",summary:`Updated #${e.sales_order_no}'s require delivery value`,detail:"",life:3e3})}catch(l){console.error("Failed to update required_delivery:",l),S.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};I(L,async e=>{if(e)try{const l=await q.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:e}});K.value=l.data.map(m=>({name:m,value:m})),K.value.push({name:"- Unselect -",value:null})}catch(l){console.error("Error fetching dropdown options:",l)}}),I(k,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),g())}),I($,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),g())}),I(w,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),g())}),I(E,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),g())});const ye=e=>e,pe=async()=>{var e=f.value.map(m=>m.id);console.log(e);const l=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:b.currentUser.id});await q.post("/api/bulkConfirmDeliverSubs",l,{headers:{"Content-Type":"application/json"}}),S.add({severity:"success",summary:`Successfully confirmed ${e.length} filter subs`,detail:"",life:3e3}),g(),f.value=[]},_e=async e=>{f.value=e},he=async()=>{var e=f.value.map(m=>m.id);console.log(e);const l=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:b.currentUser.id});await q.post("/api/bulkDenyDeliverSubs",l,{headers:{"Content-Type":"application/json"}}),S.add({severity:"success",summary:`Successfully denied ${e.length} filter subs`,detail:"",life:3e3}),g(),f.value=[]};return(e,l)=>{const m=te("Toast"),ge=te("font-awesome-icon"),B=Ve("tooltip");return r(),v("div",Pe,[i("div",null,[i("div",Ne,[w.value.length?(r(),v("div",Le,[Ee,y(" "+d(ue(w.value)),1)])):_("",!0),k.value.length?(r(),v("div",Oe,[Be,y(" "+d(ce(k.value)),1)])):_("",!0)])]),a(m),a(s(Y),{visible:P.value,"onUpdate:visible":l[0]||(l[0]=t=>P.value=t),header:L.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:n(()=>[i("p",null,[Te,y(" "+d(H.value),1)]),i("p",null,[Me,y(" "+d(J.value),1)]),Qe,a(s(X),{value:z.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:n(()=>[a(s(c),{field:"product",header:"Product",style:{"min-width":"10rem"}}),a(s(c),{field:"description",header:"Description",style:{"min-width":"10rem"}}),a(s(c),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),i("div",null,[j.value.contact_address[0].parent?(r(),v("p",Ge,[Ke,ze,y(" "+d(j.value.contact_address[0].parent.complete_address),1)])):_("",!0)]),i("div",null,[(r(!0),v(T,null,M(j.value.contact_address[0].children,(t,u)=>(r(),v("p",{key:u},[He,Je,y(" "+d(t.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),a(s(Y),{visible:N.value,"onUpdate:visible":l[4]||(l[4]=t=>N.value=t),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:n(()=>[We,(r(!0),v(T,null,M(F.value,t=>(r(),v("div",{key:t.id,class:"flex items-center mb-2"},[a(s(Z),{modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=u=>k.value=u),inputId:t.state_id,name:"stateIds",value:t.state_id},null,8,["modelValue","inputId","value"]),i("label",{for:t.id,class:"ml-2"},d(t.name),9,Xe)]))),128)),Ye,(r(!0),v(T,null,M(ie.value,t=>(r(),v("div",{key:t.id,class:"flex items-center mb-2"},[a(s(Z),{modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=u=>$.value=u),inputId:t.name,name:"category",value:t.name},null,8,["modelValue","inputId","value"]),i("label",{for:t.id,class:"ml-2"},d(t.name),9,Ze)]))),128)),et,a(s(we),{modelValue:w.value,"onUpdate:modelValue":l[3]||(l[3]=t=>w.value=t),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),f.value.length?(r(),h(s(D),{key:0,class:"ml-4",outlined:""},{default:n(()=>[i("p",tt,d(f.value.length),1),y("selected "),f.value.length<p.filterSubs.total?(r(),h(s(D),{key:0,label:`Select all ${p.deliverSubIds.length}`,onClick:l[5]||(l[5]=t=>_e(p.deliverSubIds)),icon:"pi pi-arrow-right",class:"ml-4",severity:"info"},null,8,["label"])):_("",!0)]),_:1})):_("",!0),f.value.length?(r(),h(s(D),{key:1,label:`Confirm All (${f.value.length})`,onClick:pe,icon:"pi pi-verified",class:"ml-4"},null,8,["label"])):_("",!0),f.value.length?(r(),h(s(D),{key:2,label:`Deny All (${f.value.length})`,onClick:he,icon:"pi pi-times-circle",class:"ml-4"},null,8,["label"])):_("",!0),a(s(ke),{rows:V.value,totalRecords:U.value,rowsPerPageOptions:[10,25,50,100],onPage:re},{start:n(t=>[y(d(p.filterSubs.from)+"-"+d(p.filterSubs.to)+" / "+d(p.filterSubs.total),1)]),_:1},8,["rows","totalRecords"]),a(s(X),{selection:f.value,"onUpdate:selection":l[8]||(l[8]=t=>f.value=t),value:ye(p.filterSubs.data),lazy:"",loading:x.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:n(()=>[i("div",lt,[a(s(D),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:l[6]||(l[6]=t=>me())}),a(s(Ce),null,{default:n(()=>[a(s(De),null,{default:n(()=>[st]),_:1}),i("div",null,[a(s(D),{onClick:l[7]||(l[7]=t=>N.value=!0),label:"Filter",class:"mr-4"}),a(s($e),{placeholder:"Keyword Search",onInput:ne})])]),_:1})])]),empty:n(()=>[y(" No filterSubs found. ")]),loading:n(()=>[y(" Loading filterSubs data. Please wait. ")]),default:n(()=>[a(s(c),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(s(c),{field:"root_sales_order.sales_order_no",header:"Root Sales Order #",style:{"min-width":"10rem"}},{body:n(({data:t})=>[i("div",at,[i("span",null,d(t.root_sales_order.sales_order_no),1),a(s(Ae)),i("div",{onClick:u=>G(t.root_sales_order.sales_order_no,t.sales_order_no,t.id),style:{cursor:"pointer","margin-left":"8px"}},[a(ge,{icon:["fas","link-slash"],style:{color:"#800000"}})],8,it)])]),_:1}),a(s(c),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:n(({data:t})=>[i("span",{onClick:u=>ve(t),class:"cursor-pointer hover:underline"},d(t.sales_order_no),9,ot),i("div",rt,[t.delivered_or_delivery_booked&&t.delivered_or_delivery_booked.value!==null?Q((r(),v("i",nt,null,512)),[[B,"Delivery Booked"]]):_("",!0),t.odoo_created_by_id?Q((r(),h(s(le),{key:1,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:n(()=>[i("img",{src:t.odoo_created_by.profile_photo_url,alt:"User Initials"},null,8,dt)]),_:2},1024)),[[B,`Last updated by:
${t.odoo_created_by.name}`]]):_("",!0)])]),_:1}),e.route().current("confirmDeliveryRequirement")?(r(),h(s(c),{key:0,field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:n(({data:t})=>[i("div",ut,[a(s(Ie),{modelValue:t.required_delivery,"onUpdate:modelValue":u=>t.required_delivery=u,options:oe.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:u=>fe(t)},{value:n(u=>{var W;return[u.value?(r(),v("div",ct,[t.required_delivery&&t.required_delivery.value!==null?(r(),v("div",mt,d(((W=t.required_delivery)==null?void 0:W.name)||t.required_delivery),1)):(r(),v("div",vt,d(u.placeholder),1))])):(r(),v("span",ft,d(u.placeholder),1))]}),option:n(u=>[i("div",yt,[i("div",null,d(u.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),t.required_delivery_updated_by_id?Q((r(),h(s(le),{key:0,class:"ml-2",style:{"background-color":"#ffffff",color:"#ffffff"}},{default:n(()=>[i("img",{src:t.required_delivery_updated_by.profile_photo_url,alt:"User Initials"},null,8,pt)]),_:2},1024)),[[B,`Last updated by:
${t.required_delivery_updated_by.name}`]]):_("",!0)])]),_:1})):_("",!0),a(s(c),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),a(s(c),{field:"address",header:"Address",style:{"min-width":"10rem"}}),a(s(c),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),a(s(c),{field:"start_date",header:"Start Date",style:{"min-width":"10rem"}},{body:n(({data:t})=>[y(d(O(t.start_date)),1)]),_:1}),a(s(c),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:n(({data:t})=>[y(d(O(t.due_date)),1)]),_:1}),a(s(c),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),a(s(c),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:n(({data:t})=>[y(d(O(t.invoice_date)),1)]),_:1}),a(s(c),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:n(({data:t})=>{var u;return[y(d((u=F.value[t.state_id-1])==null?void 0:u.name),1)]}),_:1}),a(s(c),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),a(s(c),{field:"email",header:"Email",style:{"min-width":"10rem"}}),a(s(c),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:n(({data:t})=>[t.payment_status==="paid"?(r(),h(s(qe),{key:0,severity:"success",value:"Paid"})):_("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},ht={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},Dt={__name:"ConfirmDeliveryRequirement",props:{filterSubs:Object,filterSubIds:Object,stateIds:Object,users:Object},setup(p){const R=Re();return(G,b)=>(r(),h(be,{title:"ConfirmDeliveryRequirement"},{default:n(()=>[i("div",ht,[a(_t,{filterSubs:p.filterSubs,stateIds:p.stateIds,deliverSubIds:p.filterSubIds,currentUser:s(R).props.auth.user,users:p.users},null,8,["filterSubs","stateIds","deliverSubIds","currentUser","users"])])]),_:1}))}};export{Dt as default};
