import{_ as he}from"./AppLayout-CUt1I3Lj.js";import{d as ge,s as X,a as m,b as Y,c as Z,e as be,f as R,g as Se,h as we,i as ke,j as Ce,k as De,l as Ie}from"./primeicons-C3jF3hj7.js";import{p as $e,q as qe,d as r,s as xe,x as Ue,y as ee,z as $,A as q,B as te,o,e as v,a as i,g as y,t as d,f,b as a,w as c,u as s,F as T,h as B,c as g,Q as Fe}from"./app-CvDTkAv4.js";import{s as je}from"./index-BeXTUOxt.js";import{s as le}from"./index-Cvopekoc.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-GJNkQnAb.js";const Ve={class:"card"},Re={class:"m-4 my-4"},Pe={key:0},Ae=i("i",{class:"pi pi-calendar"},null,-1),Ne={key:1},Ee=i("i",{class:"pi pi-map-marker"},null,-1),Le=i("i",{class:"pi pi-user"},null,-1),Oe=i("i",{class:"pi pi-map-marker mt-2"},null,-1),Te=i("p",{class:"mt-6"}," Order Lines:",-1),Be={key:0},Me=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),Qe=i("i",{class:"pi pi-building-columns"},null,-1),Ge=i("p",{class:"mt-6 mb-2"}," Other Address:",-1),Ke=i("i",{class:"pi pi-building"},null,-1),ze=i("p",{class:"mb-2 text-xl font-bold"},"States",-1),He=["for"],Je=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Activity Summary",-1),We=["for"],Xe=i("p",{class:"mt-4 mb-2 text-xl font-bold"},"Date Range",-1),Ye={class:"flex justify-between"},Ze=i("i",{class:"pi pi-search"},null,-1),et={style:{display:"flex","align-items":"center"}},tt=["onClick"],lt=["onClick"],st={key:1,class:"pi pi-truck ml-2"},at={style:{display:"flex","align-items":"center"}},it={key:0,class:"flex align-items-center"},rt={key:0},ot={key:1},nt={key:1},dt={class:"flex align-items-center"},ct={__name:"ConfirmDeliveryRequirementDataTable",props:{currentUser:Object,deliverSubIds:Object,filterSubs:Object,stateIds:Object,users:Object},setup(p){const P=$e(),M=(e,l,u)=>{P.require({message:`Do you want to unlink #${l} from #${e}?`,header:"Unlink Sales Order",icon:"pi pi-info-circle",rejectLabel:"Cancel",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Unlink",severity:"danger"},accept:async()=>{await q.delete(`/api/deliverSub/${u}`),h(),S.add({severity:"info",summary:"Unlinked Successfully",detail:`Unlinked #${l} from #${e}`,life:3e3})},reject:()=>{}})};qe();let b=p;const _=r([]),x=r(!0),D=r(1),U=r(0),A=r(),N=r(!1),E=r(!1),se=r(),Q=r([]),S=xe(),F=r([]),L=r(),G=r(),K=r(),z=r(),ae=r([]);r([{id:1,name:"Subscription"}]);const ie=r([{id:1,name:"Send 1st Stage Filter"},{id:2,name:"Independent 3 + 3 Due for Change"},{id:3,name:"Independent 3 + 3 Expires"},{id:4,name:"3 + 3 Stage Filter"},{id:5,name:"3 Stage Filter"},{id:6,name:"3 + 3 Stage Filter Expires"},{id:7,name:"3 Stage Filter Expires"},{id:8,name:"Final Date to Order Filters for Warranty Extension"}]),re=r([{name:"Confirm",value:"Confirm"},{name:"Deny",value:"Deny"},{name:"- Unselect -",value:null}]),w=r([]),j=r(),k=r([]),I=r([]),O=r([]),V=r(100);Ue(()=>{x.value=!1,U.value=b.filterSubs.total,se.value=b.salesQuotations,F.value=b.stateIds});const oe=e=>{V.value=e.rows,D.value=e.page+1,console.log("page change"),console.log(D.value),h()},ne=e=>{A.value=e.target.value,console.log(e.target.value),de()},h=async()=>{try{console.log("fetch data page"),console.log(D.value);const e=ee.get("/confirmDeliveryRequirement",{page:D.value,search:A.value,dates:w.value,stateId:k.value,activitySummary:I.value,categories:O.value,perPage:V.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),U.value=l.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{x.value=!1}},de=ge(async()=>{try{console.log("fetch data page"),console.log(D.value);const e=await ee.get("/confirmDeliveryRequirement",{page:D.value,search:A.value,dates:w.value,stateId:k.value,activitySummary:I.value,categories:O.value,perPage:V.value},{preserveState:!0,replace:!1,onSuccess:l=>{console.log(l),console.log(l.props.filterSubs.total),U.value=l.props.filterSubs.total}})}catch(e){console.error("Error fetching data:",e)}finally{x.value=!1}},300),H=e=>e?new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):null,ce=e=>{if(!e||e.length===0)return"";const l=new Date(e[0]),u=e[1]?new Date(e[1]):l;return`${l.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})} to ${u.toLocaleDateString("en-PH",{day:"2-digit",month:"2-digit",year:"numeric"})}`},ue=e=>e.map(l=>{var u;return(u=F.value[l-1])==null?void 0:u.code}).join(", "),me=()=>{initFilters()},ve=e=>{N.value=!0,L.value=e.sales_order_no,G.value=e.order_line,K.value=e.customer_name,z.value=e.address,ae.value=e.contact_address,j.value=e},pe=async e=>{try{console.log(e.required_delivery.value);const l=await q.put(`/api/updateRequiredDeliveryInDeliverSubs/${e.id}`,{required_delivery:e.required_delivery.value,required_delivery_updated_by_id:b.currentUser.id});e.required_delivery.value=="Confirm"?S.add({severity:"success",summary:`Successfully confirmed #${e.sales_order_no} for delivery`,detail:"",life:3e3}):e.required_delivery.value=="Deny"?S.add({severity:"info",summary:`Successfully denied #${e.sales_order_no}`,detail:"",life:3e3}):S.add({severity:"info",summary:`Updated #${e.sales_order_no}'s require delivery value`,detail:"",life:3e3})}catch(l){console.error("Failed to update required_delivery:",l),S.add({severity:"error",summary:"Failed Message",detail:"Message Content",life:3e3})}};$(L,async e=>{if(e)try{const l=await q.get("/api/findFilterSubsBySalesOrderNo",{params:{sales_order_no:e}});Q.value=l.data.map(u=>({name:u,value:u})),Q.value.push({name:"- Unselect -",value:null})}catch(l){console.error("Error fetching dropdown options:",l)}}),$(k,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),h())}),$(I,async e=>{console.log("changed state, load fetch data 1"),e&&(console.log("changed state, load fetch data 2"),h())}),$(w,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),h())}),$(O,async e=>{console.log("changed date, load fetch data 1"),e&&(console.log("changed date, load fetch data 2"),h())});const ye=e=>e,fe=async()=>{var e=_.value.map(u=>u.id);console.log(e);const l=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:b.currentUser.id});await q.post("/api/bulkConfirmDeliverSubs",l,{headers:{"Content-Type":"application/json"}}),S.add({severity:"success",summary:`Successfully confirmed ${e.length} filter subs`,detail:"",life:3e3}),h(),_.value=[]},_e=async()=>{var e=_.value.map(u=>u.id);console.log(e);const l=JSON.stringify({deliverSubIds:e,required_delivery_updated_by_id:b.currentUser.id});await q.post("/api/bulkDenyDeliverSubs",l,{headers:{"Content-Type":"application/json"}}),S.add({severity:"success",summary:`Successfully denied ${e.length} filter subs`,detail:"",life:3e3}),h(),_.value=[]},J=(e,l)=>{const u=l.find(C=>C.id===e);if(u){const C=u.name.split(" ").map(n=>n[0]).join("").toUpperCase();return C.substring(0,2)||C}return""};return(e,l)=>{const u=te("Toast"),C=te("font-awesome-icon");return o(),v("div",Ve,[i("div",null,[i("div",Re,[w.value.length?(o(),v("div",Pe,[Ae,y(" "+d(ce(w.value)),1)])):f("",!0),k.value.length?(o(),v("div",Ne,[Ee,y(" "+d(ue(k.value)),1)])):f("",!0)])]),a(u),a(s(Y),{visible:N.value,"onUpdate:visible":l[0]||(l[0]=t=>N.value=t),header:L.value,class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[i("p",null,[Le,y(" "+d(K.value),1)]),i("p",null,[Oe,y(" "+d(z.value),1)]),Te,a(s(X),{value:G.value,dataKey:"id",showGridlines:"",class:"mt-2"},{default:c(()=>[a(s(m),{field:"product",header:"Product",style:{"min-width":"10rem"}}),a(s(m),{field:"description",header:"Description",style:{"min-width":"10rem"}}),a(s(m),{field:"quantity",header:"Quantity",style:{"min-width":"5rem"}})]),_:1},8,["value"]),i("div",null,[j.value.contact_address[0].parent?(o(),v("p",Be,[Me,Qe,y(" "+d(j.value.contact_address[0].parent.complete_address),1)])):f("",!0)]),i("div",null,[(o(!0),v(T,null,B(j.value.contact_address[0].children,(t,n)=>(o(),v("p",{key:n},[Ge,Ke,y(" "+d(t.complete_address),1)]))),128))])]),_:1},8,["visible","header"]),a(s(Y),{visible:E.value,"onUpdate:visible":l[4]||(l[4]=t=>E.value=t),header:"Filters",position:"right",class:"!w-full md:!w-80 lg:!w-[30rem]"},{default:c(()=>[ze,(o(!0),v(T,null,B(F.value,t=>(o(),v("div",{key:t.id,class:"flex items-center mb-2"},[a(s(Z),{modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=n=>k.value=n),inputId:t.state_id,name:"stateIds",value:t.state_id},null,8,["modelValue","inputId","value"]),i("label",{for:t.id,class:"ml-2"},d(t.name),9,He)]))),128)),Je,(o(!0),v(T,null,B(ie.value,t=>(o(),v("div",{key:t.id,class:"flex items-center mb-2"},[a(s(Z),{modelValue:I.value,"onUpdate:modelValue":l[2]||(l[2]=n=>I.value=n),inputId:t.name,name:"category",value:t.name},null,8,["modelValue","inputId","value"]),i("label",{for:t.id,class:"ml-2"},d(t.name),9,We)]))),128)),Xe,a(s(be),{modelValue:w.value,"onUpdate:modelValue":l[3]||(l[3]=t=>w.value=t),selectionMode:"range",manualInput:!1},null,8,["modelValue"])]),_:1},8,["visible"]),_.value.length?(o(),g(s(R),{key:0,label:`Confirm All (${_.value.length})`,onClick:fe,icon:"pi pi-verified",class:"ml-4"},null,8,["label"])):f("",!0),_.value.length?(o(),g(s(R),{key:1,label:`Deny All (${_.value.length})`,onClick:_e,icon:"pi pi-times-circle",class:"ml-4"},null,8,["label"])):f("",!0),a(s(Se),{rows:V.value,totalRecords:U.value,rowsPerPageOptions:[10,25,50,100],onPage:oe},{start:c(t=>[y(d(p.filterSubs.from)+"-"+d(p.filterSubs.to)+" / "+d(p.filterSubs.total),1)]),_:1},8,["rows","totalRecords"]),a(s(X),{selection:_.value,"onUpdate:selection":l[7]||(l[7]=t=>_.value=t),value:ye(p.filterSubs.data),lazy:"",loading:x.value,tableStyle:"min-width: 50rem",showGridlines:"",dataKey:"id",filterDisplay:"menu"},{header:c(()=>[i("div",Ye,[a(s(R),{type:"button",icon:"pi pi-filter-slash",label:"Clear",outlined:"",onClick:l[5]||(l[5]=t=>me())}),a(s(we),null,{default:c(()=>[a(s(ke),null,{default:c(()=>[Ze]),_:1}),i("div",null,[a(s(R),{onClick:l[6]||(l[6]=t=>E.value=!0),label:"Filter",class:"mr-4"}),a(s(Ce),{placeholder:"Keyword Search",onInput:ne})])]),_:1})])]),empty:c(()=>[y(" No filterSubs found. ")]),loading:c(()=>[y(" Loading filterSubs data. Please wait. ")]),default:c(()=>[a(s(m),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(s(m),{field:"root_sales_order.sales_order_no",header:"Root Sales Order #",style:{"min-width":"10rem"}},{body:c(({data:t})=>[i("div",et,[i("span",null,d(t.root_sales_order.sales_order_no),1),a(s(je)),i("div",{onClick:n=>M(t.root_sales_order.sales_order_no,t.sales_order_no,t.id),style:{cursor:"pointer","margin-left":"8px"}},[a(C,{icon:["fas","link-slash"],style:{color:"#800000"}})],8,tt)])]),_:1}),a(s(m),{field:"sales_order_no",header:"Sales Order No.",style:{"min-width":"10rem"}},{body:c(({data:t})=>[i("span",{onClick:n=>ve(t),class:"cursor-pointer hover:underline"},d(t.sales_order_no),9,lt),t.category==="Subscription"?(o(),g(C,{key:0,icon:"fa-filter-circle-dollar",class:"ml-2"})):f("",!0),t.delivered_or_delivery_booked&&t.delivered_or_delivery_booked.value!==null?(o(),v("i",st)):f("",!0),t.odoo_created_by_id?(o(),g(s(le),{key:2,label:J(t.odoo_created_by_id,p.users),class:"ml-2",style:{"background-color":"#dee9fc",color:"#1a2551"}},null,8,["label"])):f("",!0)]),_:1}),e.route().current("confirmDeliveryRequirement")?(o(),g(s(m),{key:0,field:"",header:"Require Delivery",style:{"min-width":"10rem"}},{body:c(({data:t})=>[i("div",at,[a(s(De),{modelValue:t.required_delivery,"onUpdate:modelValue":n=>t.required_delivery=n,options:re.value,filter:"",optionLabel:"name",placeholder:"Select Confirmation",class:"w-full md:w-14rem",onChange:n=>pe(t)},{value:c(n=>{var W;return[n.value?(o(),v("div",it,[t.required_delivery&&t.required_delivery.value!==null?(o(),v("div",rt,d(((W=t.required_delivery)==null?void 0:W.name)||t.required_delivery),1)):(o(),v("div",ot,d(n.placeholder),1))])):(o(),v("span",nt,d(n.placeholder),1))]}),option:c(n=>[i("div",dt,[i("div",null,d(n.option.name),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),t.required_delivery_updated_by_id?(o(),g(s(le),{key:0,label:J(t.required_delivery_updated_by_id,p.users),class:"ml-2",style:{"background-color":"#dee9fc",color:"#1a2551"}},null,8,["label"])):f("",!0)])]),_:1})):f("",!0),a(s(m),{field:"customer_name",header:"Customer Name",style:{"min-width":"10rem"},filterField:"customer_name"}),a(s(m),{field:"address",header:"Address",style:{"min-width":"10rem"}}),a(s(m),{field:"activity_summary",header:"Activity Summary",style:{"min-width":"10rem"}}),a(s(m),{field:"due_date",header:"Due Date",style:{"min-width":"10rem"}},{body:c(({data:t})=>[y(d(H(t.due_date)),1)]),_:1}),a(s(m),{field:"invoice_number",header:"Invoice Number",style:{"min-width":"10rem"}}),a(s(m),{field:"invoice_date",header:"Invoice Date",style:{"min-width":"10rem"}},{body:c(({data:t})=>[y(d(H(t.invoice_date)),1)]),_:1}),a(s(m),{field:"state_id",header:"State",style:{"min-width":"10rem"}},{body:c(({data:t})=>{var n;return[y(d((n=F.value[t.state_id-1])==null?void 0:n.name),1)]}),_:1}),a(s(m),{field:"phone",header:"Phone",style:{"min-width":"10rem"}}),a(s(m),{field:"email",header:"Email",style:{"min-width":"10rem"}}),a(s(m),{field:"payment_status",header:"Payment Status",style:{"min-width":"10rem"}},{body:c(({data:t})=>[t.payment_status==="paid"?(o(),g(s(Ie),{key:0,severity:"success",value:"Paid"})):f("",!0)]),_:1})]),_:1},8,["selection","value","loading"])])}}},ut={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},gt={__name:"ConfirmDeliveryRequirement",props:{filterSubs:Object,filterSubIds:Object,stateIds:Object,users:Object},setup(p){const P=Fe();return(M,b)=>(o(),g(he,{title:"ConfirmDeliveryRequirement"},{default:c(()=>[i("div",ut,[a(ct,{filterSubs:p.filterSubs,stateIds:p.stateIds,filterSubIds:p.filterSubIds,currentUser:s(P).props.auth.user,users:p.users},null,8,["filterSubs","stateIds","filterSubIds","currentUser","users"])])]),_:1}))}};export{gt as default};
